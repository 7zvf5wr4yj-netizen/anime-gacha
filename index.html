<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Anime Gacha Empire</title>
<style>
body{margin:0;font-family:Arial;background:#0f172a;color:white}
button{padding:8px 12px;margin:5px;border:none;border-radius:6px;background:#2563eb;color:white;cursor:pointer}
.card{background:#1e293b;padding:10px;margin:5px;border-radius:8px}
</style>
</head>
<body>
<div id="app"></div>

<script>
const RARITIES={
COMMON:{name:"–û–±—ã—á–Ω–∞—è",chance:6000,mult:1},
RARE:{name:"–†–µ–¥–∫–∞—è",chance:3000,mult:2},
EPIC:{name:"–≠–ø–∏—á–µ—Å–∫–∞—è",chance:800,mult:4},
LEGEND:{name:"–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è",chance:180,mult:7},
DIVINE:{name:"–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è",chance:20,mult:12}
};

const UNIVERSES={
"JUJUTSU KAISEN":["–ì–æ–¥–∑—ë","–ì—ç—Ç–æ","–ò—Ç–∞–¥–æ—Ä–∏","–ù–æ–±–∞—Ä–∞"],
"EVANGELION":["–†—ç–π","–ê—Å–∫–∞","–°–∏–Ω–¥–∑–∏","–ö–∞–≤–æ—Ä—É"],
"NARUTO":["–ù–∞—Ä—É—Ç–æ","–°–∞—Å–∫–µ","–°–∞–∫—É—Ä–∞","–ò—Ç–∞—á–∏"]
};

let state=JSON.parse(localStorage.getItem("gachaState"))||{
view:"main",
rolling:false,
user:{
diamonds:1500,
power:0,
universe:"JUJUTSU KAISEN",
inventory:[],
pvpWins:0,
pvpLosses:0
}
};

function save(){localStorage.setItem("gachaState",JSON.stringify(state))}

function recalcPower(){
state.user.power=state.user.inventory.reduce((s,c)=>s+c.power,0);
}

function rarityRoll(){
let r=Math.floor(Math.random()*10000);
let sum=0;
for(let k in RARITIES){
sum+=RARITIES[k].chance;
if(r<sum) return k;
}
return "COMMON";
}

function makeCard(){
let key=rarityRoll();
let rarity=RARITIES[key];
let names=UNIVERSES[state.user.universe];
let name=names[Math.floor(Math.random()*names.length)];
return{
id:"c_"+Date.now()+"_"+Math.random(),
name,
rarity:rarity.name,
rarityKey:key,
power:Math.floor((Math.random()*80+60)*rarity.mult),
hp:Math.floor((Math.random()*120+100)*rarity.mult)
};
}

function setView(v){state.view=v;render();}

function render(){
const app=document.getElementById("app");
if(state.view==="main"){
app.innerHTML=`
<h1>Anime Gacha Empire</h1>
<p>üíé ${state.user.diamonds}</p>
<p>‚ö° ${state.user.power}</p>
<button onclick="setView('roll')">–ü—Ä–∏–∑—ã–≤</button>
<button onclick="setView('inventory')">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
<button onclick="setView('pvp')">PvP</button>
`;
}

if(state.view==="roll"){
app.innerHTML=`
<h2>–ü—Ä–∏–∑—ã–≤ (100 üíé)</h2>
<select id="uni">${Object.keys(UNIVERSES).map(u=>`<option ${u===state.user.universe?'selected':''}>${u}</option>`).join('')}</select>
<br>
<button onclick="roll()">–ö—Ä—É—Ç–∏—Ç—å</button>
<button onclick="setView('main')">–ù–∞–∑–∞–¥</button>
<div id="result"></div>
`;
}

if(state.view==="inventory"){
app.innerHTML=`
<h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
${state.user.inventory.length===0?"–ü—É—Å—Ç–æ":state.user.inventory.map(c=>`
<div class="card">
<b>${c.name}</b><br>
${c.rarity}<br>
‚ö° ${c.power} | ‚ù§Ô∏è ${c.hp}
</div>`).join("")}
<button onclick="setView('main')">–ù–∞–∑–∞–¥</button>
`;
}

if(state.view==="pvp"){
app.innerHTML=`
<h2>PvP</h2>
<p>–ü–æ–±–µ–¥—ã: ${state.user.pvpWins} | –ü–æ—Ä–∞–∂–µ–Ω–∏—è: ${state.user.pvpLosses}</p>
<button onclick="fight()">–ë–æ–π</button>
<button onclick="setView('main')">–ù–∞–∑–∞–¥</button>
<div id="fightRes"></div>
`;
}
save();
}

function roll(){
if(state.user.diamonds<100){alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–ª–º–∞–∑–æ–≤");return;}
state.user.universe=document.getElementById("uni").value;
state.user.diamonds-=100;

let card=makeCard();
state.user.inventory.push(card);
recalcPower();

document.getElementById("result").innerHTML=
`–í—ã–ø–∞–ª–∞ –∫–∞—Ä—Ç–∞: <b>${card.name}</b> (${card.rarity}) ‚ö°${card.power}`;

save();
}

function fight(){
if(state.user.power<100){alert("–°–ª–∏—à–∫–æ–º –º–∞–ª–æ –º–æ—â–∏");return;}
let enemyPower=Math.floor(Math.random()*2000+500);
let yourPower=state.user.power+Math.floor(Math.random()*300);
let win=yourPower>=enemyPower;

if(win){
state.user.pvpWins++;
state.user.diamonds+=50;
}else{
state.user.pvpLosses++;
}

document.getElementById("fightRes").innerHTML=
win?`–ü–æ–±–µ–¥–∞! (+50üíé)`:`–ü–æ—Ä–∞–∂–µ–Ω–∏–µ`;

save();
}

render();
</script>
</body>
</html>
