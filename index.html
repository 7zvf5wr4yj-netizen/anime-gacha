<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Anime Gacha Empire</title>
  <style>
    :root {
      --bg-gradient: linear-gradient(135deg, #151e3d 0%, #511281 100%);
      --card-gradient: linear-gradient(135deg, #22294e 60%, #161928 100%);
      --neon-blue: #34cbff;
      --neon-purp: #be59ff;
      --neon-gold: #ffd700;
      --neon-orange: #ff9900;
      --neon-rainbow: linear-gradient(90deg, #ff00cc 0%, #3333ff 25%, #13ff62 50%, #ffd700 75%, #ff00cc 100%);
    }
    html, body {
      height: 100%; margin: 0; padding: 0;
    }
    body {
      min-height: 100vh;
      background: var(--bg-gradient);
      font-family: 'Segoe UI', Arial, sans-serif;
      color: #fff;
      overflow-x: hidden;
    }
    .wrap {
      max-width: 420px;
      margin: 30px auto 0 auto;
      background: rgba(21,30,61,0.92);
      box-shadow: 0 6px 32px #0009;
      border-radius: 24px;
      padding: 36px 18px 22px 18px;
      position: relative;
      min-height: 670px;
    }
    h1 {
      letter-spacing: 2px;
      font-weight: 700;
      font-size: 2.5em;
      background: linear-gradient(90deg, #34cbff, #be59ff, #ffd700, #be59ff, #34cbff);
      background-size: 400% 100%;
      color: transparent;
      animation: grad 6s linear infinite;
      -webkit-background-clip: text;
      background-clip: text;
      margin: 0 0 12px 0;
      text-align: center;
      text-shadow: 0 0 28px #43e6f744, 0 0 2px #be59ff;
    }
    @keyframes grad {
      0% {background-position:0%}
      100% {background-position:400%}
    }
    .stat-bar {
      display: flex;
      justify-content: space-around;
      font-size: 1.2em;
      margin-bottom: 8px;
      margin-top: 0;
      user-select: all;
    }
    .stat-bar span {
      filter: drop-shadow(0 0 5px #fff7);
    }
    .nav-btns {
      display: flex;
      justify-content: center;
      gap: 14px;
      margin: 17px 0 18px 0;
    }
    button, .select {
      padding: 10px 22px;
      font-size: 1.04em;
      font-weight: 600;
      border: none;
      border-radius: 16px;
      background: linear-gradient(90deg,#31255e 0,#1b53d6 100%);
      color: #fff;
      margin: 0 4px;
      cursor: pointer;
      box-shadow: 0 2px 12px #2a2e5580;
      transition: .14s;
      outline: none;
      user-select: none;
    }
    button:hover, .select:hover {
      background: linear-gradient(90deg, #1b53d6 0, #31255e 100%);
      color: #ffea70;
      box-shadow: 0 0 18px #5093ff99;
      transform: scale(1.04);
    }
    .select {
      background: #23184e;
      padding: 10px 16px;
    }
    /* Gacha Animation */
    .gacha-roller {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 170px;
      margin-bottom: 16px;
      perspective: 800px;
      position: relative;
    }
    .gacha-card-anim {
      font-size: 2.2em;
      font-weight: 700;
      border-radius: 16px;
      text-align: center;
      width: 220px;
      box-shadow: 0 2px 16px #000a, 0 0 55px #a78cffcc;
      background: #262962;
      border: 3.5px solid #b8b6ff;
      opacity: 1;
      transform-style: preserve-3d;
      animation: popIn .27s cubic-bezier(.27,.7,.34,1.4);
      margin: 0 auto;
      position: relative;
      z-index: 2;
    }
    @keyframes popIn {
      0% { opacity:0; transform: scale(0.4) rotateY(-120deg);}
      70% {opacity:1; transform: scale(1.11) rotateY(12deg);}
      90% {opacity:1;}
      100% { opacity:1; transform: scale(1) rotateY(0);}
    }
    .gacha-anim-rarity-EPIC { border:3.5px solid var(--neon-orange); color: var(--neon-orange);}
    .gacha-anim-rarity-LEGEND { border:3.5px solid var(--neon-gold); color: var(--neon-gold); text-shadow:0 0 16px gold;}
    .gacha-anim-rarity-DIVINE { border-image: var(--neon-rainbow) 1; border-width:4px; border-style:solid; background: #fff; color: transparent; background-clip:text;}
    .gacha-anim-rare-sparkle {
      animation: sparkle-glow 1s infinite alternate;
      text-shadow: 0 0 16px #fff, 0 0 16px var(--neon-gold), 0 0 26px #ffea70;
    }
    @keyframes sparkle-glow {
      to {
        text-shadow: 0 0 24px #fff, 0 0 40px var(--neon-gold), 0 0 70px #ffea708a;
      }
    }
    .card-list {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      justify-content: center;
      max-height: 260px;
      overflow-y: auto;
      margin-bottom: 22px;
    }
    .gacha-card {
      min-width: 105px;
      background: var(--card-gradient);
      border-radius: 12px;
      box-shadow: 0 2px 9px #0007, 0 0 0 1.5px #3e2460b8;
      padding: 10px 7px 8px 7px;
      font-size: 1.15em;
      font-weight: 500;
      margin-bottom: 2px;
      text-align: center;
      position: relative;
      border: 2.5px solid #2d3560;
      margin: 0 0 6px 0;
      user-select: text;
    }
    .rarity-color-COMMON { border-color: #34cbff; }
    .rarity-color-RARE { border-color: #be59ff;}
    .rarity-color-EPIC { border-color: orange; box-shadow: 0 0 18px #ff993327;}
    .rarity-color-LEGEND { border-color: gold; box-shadow: 0 0 22px #ffd7007e; font-weight:700;}
    .rarity-color-DIVINE { border-image: var(--neon-rainbow) 1; border-width: 2.5px 4.5px; background: #fff3eb; color: #9264ff; font-weight:600; box-shadow: 0 0 44px #ff00cc44 inset;}
    .gacha-card .rarity {
      font-size: .95em;
      font-weight: 400;
      opacity:.8;
    }
    .gacha-card .pow {font-size:.98em;}
    .gacha-card .hp {font-size:.99em;}

    /* PvP/Other */
    .pvp-battle {
      background: #22294e;
      border-radius: 10px;
      margin-top: 10px;
      padding: 14px 10px;
      box-shadow: 0 0 22px #582cb320;
      font-size: 1.15em;
      min-height: 38px;
      text-align: center;
      position: relative;
    }
    .pvp-res-win { color: #ffe682; text-shadow:0 0 6px #fff9;}
    .pvp-res-lose { color: #b0adad; }
    /* Confetti animation for Divine/Legenadary drops */
    .confetti {
      pointer-events:none;position:fixed;z-index:10002;top:0;left:0;width:100vw;height:100vh;overflow:hidden; }
    .confetti-piece {
      position: absolute;
      width: 10px; height: 18px;
      border-radius: 4px;
      opacity: 0.82;
      animation: confetti-fall 1.2s cubic-bezier(.37,.76,.29,.96);
    }
    @keyframes confetti-fall {
      to {
        transform: translateY(100vh) rotateZ(480deg) scale(.83);
        opacity: 0.6;
      }
    }
    /* Scroll bar */
    ::-webkit-scrollbar { width: 9px; background: #25184e;}
    ::-webkit-scrollbar-thumb { background: #50309f; border-radius: 4px;}
  </style>
</head>
<body>
<div class="wrap" id="app"></div>
<div class="confetti" id="confetti"></div>
<script>
const RARITIES = {
  COMMON:    {name:"–û–±—ã—á–Ω–∞—è",      chance:6000, mult:1, color:'COMMON'},
  RARE:      {name:"–†–µ–¥–∫–∞—è",       chance:3000, mult:2, color:'RARE'},
  EPIC:      {name:"–≠–ø–∏—á–µ—Å–∫–∞—è",    chance:800,  mult:4, color:'EPIC'},
  LEGEND:    {name:"–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è",  chance:180,  mult:7, color:'LEGEND'},
  DIVINE:    {name:"–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è", chance:20,   mult:12, color:'DIVINE'}
};
const UNIVERSES = {
  "JUJUTSU KAISEN": ["–ì–æ–¥–∑—ë", "–ì—ç—Ç–æ", "–ò—Ç–∞–¥–æ—Ä–∏", "–ù–æ–±–∞—Ä–∞"],
  "EVANGELION":["–†—ç–π","–ê—Å–∫–∞","–°–∏–Ω–¥–∑–∏","–ö–∞–≤–æ—Ä—É"],
  "NARUTO":["–ù–∞—Ä—É—Ç–æ","–°–∞—Å–∫–µ","–°–∞–∫—É—Ä–∞","–ò—Ç–∞—á–∏"]
};

let state = JSON.parse(localStorage.getItem("gachaState")) || {
  view:"main",
  rolling:false,
  user:{
    diamonds:1500,
    power:0,
    universe:"JUJUTSU KAISEN",
    inventory:[],
    pvpWins:0,
    pvpLosses:0
  }
};

function save(){ localStorage.setItem("gachaState",JSON.stringify(state)); }

function recalcPower() {
  state.user.power = state.user.inventory.reduce((s,c) => s+c.power, 0);
}

function rarityRoll() {
  let r = Math.floor(Math.random()*10000); let sum = 0;
  for(let k in RARITIES){ sum += RARITIES[k].chance; if(r<sum) return k; }
  return "COMMON";
}

function makeCard() {
  let key = rarityRoll(), rarity = RARITIES[key];
  let names = UNIVERSES[state.user.universe];
  let name = names[Math.floor(Math.random()*names.length)];
  return {
    id:"c_"+Date.now()+"_"+Math.random(),
    name,
    rarity:rarity.name,
    rarityKey:key,
    power:Math.floor((Math.random()*80+60)*rarity.mult),
    hp:Math.floor((Math.random()*120+100)*rarity.mult)
  };
}

// ---- UI & rendering logic ----
function setView(v){ state.view=v; render(); }

function showConfetti(rarity) {
  const confettiColors = rarity==='DIVINE'
    ? ['#ffd700','#00ffd0','#ff00cc','#3333ff','#13ff62']
    : rarity==='LEGEND'
    ? ['#ffd700','#fff185','#ffb64b','#ffe01e']
    : ['#be59ff','#ffd700','#34cbff'];
  let confetti = document.getElementById('confetti');
  confetti.innerHTML='';
  for(let i=0;i<40+(rarity==='DIVINE'?30:0);++i){
    let d = document.createElement('div');
    d.className='confetti-piece';
    d.style.background = confettiColors[Math.floor(Math.random()*confettiColors.length)];
    d.style.left=(Math.random()*98)+"vw";
    d.style.top = -(Math.random()*30+5)+"px";
    d.style.transform = `rotateZ(${Math.random()*240-60}deg)`;
    d.style.animationDuration= 0.7+Math.random()*0.71+'s';
    confetti.appendChild(d);
  }
  setTimeout(()=>{confetti.innerHTML='';}, 1600);
}

function animateGacha(card) {
  state.rolling=true;
  render();
  let gachaRoller = document.getElementById("gachaRollAnim");
  let viewCard = () => {
    state.rolling = false;
    state.user.inventory.push(card);
    recalcPower();
    render();
    // Confetti for rare
    if(card.rarityKey==='LEGEND' || card.rarityKey==='DIVINE')
      showConfetti(card.rarityKey);
  };

  // Animation sequence
  let rare = card.rarityKey;
  let names = [];
  for(let i=0;i<6;i++) {
    let fakeKey = Object.keys(RARITIES)[Math.floor(Math.random()*Object.keys(RARITIES).length)];
    let name = UNIVERSES[state.user.universe][Math.floor(Math.random()*UNIVERSES[state.user.universe].length)];
    names.push({name, key: fakeKey});
  }
  let cur = 0, interval = 95, times = 0;
  let spin = () => {
    if(!gachaRoller) return;
    if(times<12 || (times<17 && rare!=='COMMON') || (times<28 && rare==='DIVINE')) {
      let show = names[++cur%names.length];
      gachaRoller.innerHTML = `
        <div class="gacha-card-anim gacha-anim-rarity-${show.key}">
          <div>${show.name}</div>
          <div class="rarity">${RARITIES[show.key].name}</div>
        </div>
      `;
      times++; interval += 15;
      setTimeout(spin, interval);
    } else {
      gachaRoller.innerHTML = `
        <div class="gacha-card-anim gacha-anim-rarity-${rare} ${rare==='DIVINE'?'gacha-anim-rare-sparkle':''}">
          <div>${card.name}</div>
          <div class="rarity">${card.rarity}</div>
          <div>‚ö°${card.power} | ‚ù§Ô∏è${card.hp}</div>
        </div>
      `;
      setTimeout(viewCard, 1150);
    }
  };
  spin();
}

function render() {
  const app = document.getElementById("app");
  const { view, rolling, user } = state;

  // ---- MAIN MENU ----
  if(view==="main") {
    app.innerHTML = `
      <h1>Anime Gacha Empire</h1>
      <div class="stat-bar">
        <span>üíé <b>${user.diamonds}</b></span>
        <span>‚ö° <b>${user.power}</b></span>
      </div>
      <div class="nav-btns">
        <button onclick="setView('roll')">üé∞ –ü—Ä–∏–∑—ã–≤</button>
        <button onclick="setView('inventory')">üì¶ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
        <button onclick="setView('pvp')">‚öîÔ∏è PvP</button>
      </div>
      <div style="margin-top:18px;text-align:center;opacity:.83;font-size:1.03em;">
        <b>–í—Å–µ–ª–µ–Ω–Ω–∞—è:</b> <span style="color:#13e7e7">${user.universe}</span>
      </div>
    `;
    return;
  }
  // ---- GACHA PULL ----
  if(view==="roll") {
    app.innerHTML = `
      <button onclick="setView('main')" style="float:right;font-size:.95em;padding:7px 16px;margin-top:-29px;margin-right:-3px;">–ù–∞–∑–∞–¥</button>
      <h1 style="font-size:1.47em;margin-bottom:7px;">–ü—Ä–∏–∑—ã–≤ (100 üíé)</h1>
      <div style="margin:12px auto 16px;text-align:center;">
        <select class="select" id="uni" onchange="state.user.universe=this.value;save();">
          ${Object.keys(UNIVERSES).map(u=>`
            <option value="${u}"${u===user.universe?' selected':''}>${u}</option>
          `).join('')}
        </select>
      </div>
      <div class="gacha-roller" id="gachaRollAnim">
        ${rolling?`
          <div class="gacha-card-anim" style="opacity:.75;background:#231546;border:none;font-size:1.46em;">...</div>
        `:''}
      </div>
      <button ${rolling||user.diamonds<100?'disabled style="opacity:.44;"':''} onclick="roll()">
        ${rolling?'–ö—Ä—É—Ç–∏—Ç—Å—è...':'üé∞ –ö—Ä—É—Ç–∏—Ç—å'}
      </button>
      <div style="text-align:center;opacity:.71;margin-top:19px;">
        –ê–ª–º–∞–∑—ã: <b>${user.diamonds}</b>
      </div>
    `;
    return;
  }

  // ---- INVENTORY ----
  if(view==="inventory") {
    let inv = user.inventory.slice().reverse();
    app.innerHTML = `
      <button onclick="setView('main')" style="float:right;font-size:.95em;padding:7px 16px;margin-top:-29px;margin-right:-3px;">–ù–∞–∑–∞–¥</button>
      <h1 style="font-size:1.36em;">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h1>
      <div class="card-list">
        ${inv.length===0
          ? `<div style="opacity:.7;margin:36px auto;width:100%;font-size:1.15em;">–ü—É—Å—Ç–æ</div>`
          : inv.map(c=>`
            <div class="gacha-card rarity-color-${c.rarityKey}">
              <div><b>${c.name}</b></div>
              <div class="rarity">${RARITIES[c.rarityKey].name}</div>
              <div class="pow">‚ö° ${c.power}</div>
              <div class="hp">‚ù§Ô∏è ${c.hp}</div>
            </div>
          `).join('')}
      </div>
      <button onclick="setView('main')" style="margin-top:15px;">–ù–∞–∑–∞–¥</button>
    `;
    return;
  }

  // ---- PVP ----
  if(view==="pvp") {
    app.innerHTML = `
      <button onclick="setView('main')" style="float:right;font-size:.95em;padding:7px 16px;margin-top:-29px;margin-right:-3px;">–ù–∞–∑–∞–¥</button>
      <h1 style="font-size:1.3em;">PvP</h1>
      <div style="margin-bottom:8px;">
        –ü–æ–±–µ–¥—ã: <span style="color:#71fdff">${user.pvpWins}</span> |
        –ü–æ—Ä–∞–∂–µ–Ω–∏—è: <span style="color:#ffd6bb">${user.pvpLosses}</span>
      </div>
      <button onclick="fight();" style="margin-bottom:19px;">–ë–æ–π!</button>
      <div id="fightRes" class="pvp-battle"></div>
    `;
    save();
    return;
  }
}

function roll() {
  if(state.rolling) return;
  if(state.user.diamonds < 100) { alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–ª–º–∞–∑–æ–≤"); return; }
  state.user.universe = document.getElementById("uni").value;
  state.user.diamonds -= 100;
  let card = makeCard();
  save();
  animateGacha(card);
}

function fight() {
  if(state.user.power<100) { alert("–°–ª–∏—à–∫–æ–º –º–∞–ª–æ –º–æ—â–∏"); return; }
  let enemyPower = Math.floor(Math.random()*2000+500);
  let yourPower = state.user.power+Math.floor(Math.random()*300);
  let win = yourPower>=enemyPower;
  if(win){
    state.user.pvpWins++;
    state.user.diamonds+=50;
  }
  else {
    state.user.pvpLosses++;
  }
  render();
  document.getElementById("fightRes").innerHTML=
    win?`<span class="pvp-res-win">–ü–æ–±–µ–¥–∞! (+50üíé)</span>`:`<span class="pvp-res-lose">–ü–æ—Ä–∞–∂–µ–Ω–∏–µ</span>`;
  save();
}

render();
</script>
</body>
</html>
