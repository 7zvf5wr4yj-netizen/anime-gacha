<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>CR: Deck Roast PRO</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --cr-blue: #1e90ff;
      --cr-dark: #0f172a;
      --cr-gold: #fbbf24;
      --pink: #f0f;
    }

    body {
      background: #0f172a; color: #fff; font-family: 'Rubik', sans-serif;
      margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh;
    }

    .header { padding: 15px; text-align: center; border-bottom: 2px solid #334155; background: #1e293b; }

    /* –°–ï–¢–ö–ê –ö–û–õ–û–î–´ */
    .deck-grid {
      display: grid; grid-template-columns: repeat(4, 2fr);
      gap: 8px; padding: 10px; background: rgba(0,0,0,0.2);
    }

    .slot {
      aspect-ratio: 1/1.2; background: #1e293b; border-radius: 8px;
      border: 2px solid #334155; cursor: pointer; position: relative;
      display: flex; align-items: center; justify-content: center; overflow: hidden;
    }

    .slot img { width: 100%; height: 100%; object-fit: contain; }

    .elixir-badge {
      position: absolute; top: 2px; right: 2px; background: var(--pink);
      color: white; border-radius: 50%; width: 18px; height: 18px;
      font-size: 10px; display: flex; align-items: center; justify-content: center;
      border: 1px solid #fff; z-index: 5; font-weight: 900;
    }

    /* –ü–ê–ù–ï–õ–¨ –í–´–ë–û–†–ê */
    .picker-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.8);
      z-index: 1000; display: none; flex-direction: column;
    }

    .picker-content {
      margin-top: auto; background: #1e293b; height: 70%;
      border-top: 5px solid var(--cr-blue); border-radius: 20px 20px 0 0;
      display: grid; grid-template-columns: repeat(4, 1fr);
      gap: 10px; padding: 15px; overflow-y: auto;
    }

    .card-item { text-align: center; font-size: 10px; }
    .card-item img { width: 100%; border-radius: 5px; }

    /* –ö–ù–û–ü–ö–ê */
    .btn-container { padding: 15px; }
    .rate-btn {
      width: 100%; background: #22c55e; border: none; padding: 18px;
      border-radius: 12px; color: #fff; font-size: 18px; font-weight: 900;
      box-shadow: 0 5px 0 #166534; cursor: pointer;
    }

    /* –†–ï–ó–£–õ–¨–¢–ê–¢ –î–õ–Ø –¢–ò–ö–¢–û–ö–ê */
    .overlay {
      position: fixed; inset: 0; background: #000;
      z-index: 2000; display: none; flex-direction: column;
      align-items: center; justify-content: center; padding: 20px;
    }

    .result-deck-mini {
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px;
      width: 100%; max-width: 300px; margin-bottom: 20px;
    }

    .mini-card { aspect-ratio: 1/1.2; background: #222; border-radius: 4px; border: 1px solid #444; overflow: hidden; }
    .mini-card img { width: 100%; height: 100%; object-fit: cover; }

    .verdict-box {
      background: #1e293b; padding: 20px; border-radius: 15px;
      border: 2px solid var(--cr-gold); text-align: center; width: 90%;
    }
  </style>
</head>
<body>

<div class="header">
  <h2 style="margin:0; font-size: 18px; color: var(--cr-gold);">CLASH DECK ROASTER</h2>
</div>

<div class="deck-grid" id="main-deck">
  <div class="slot" onclick="openPicker(0)" id="s0">‚ûï</div>
  <div class="slot" onclick="openPicker(1)" id="s1">‚ûï</div>
  <div class="slot" onclick="openPicker(2)" id="s2">‚ûï</div>
  <div class="slot" onclick="openPicker(3)" id="s3">‚ûï</div>
  <div class="slot" onclick="openPicker(4)" id="s4">‚ûï</div>
  <div class="slot" onclick="openPicker(5)" id="s5">‚ûï</div>
  <div class="slot" onclick="openPicker(6)" id="s6">‚ûï</div>
  <div class="slot" onclick="openPicker(7)" id="s7">‚ûï</div>
</div>

<div class="btn-container">
  <button class="rate-btn" onclick="analyze()">–û–¶–ï–ù–ò–¢–¨ –ú–û–ô –ü–ò–ö</button>
</div>

<div id="picker" class="picker-overlay" onclick="this.style.display='none'">
  <div class="picker-content" onclick="event.stopPropagation()" id="picker-list"></div>
</div>

<div id="result-screen" class="overlay">
  <div style="font-size: 12px; opacity: 0.6; margin-bottom: 10px;">–ú–û–Ø –ö–û–õ–û–î–ê:</div>
  <div class="result-deck-mini" id="res-mini-grid"></div>
  
  <div class="verdict-box">
    <div id="res-emoji" style="font-size: 50px;">ü§°</div>
    <h1 id="res-title" style="margin: 10px 0; color: var(--cr-gold);">–ö–õ–û–£–ù</h1>
    <p id="res-text" style="font-size: 14px; line-height: 1.5;"></p>
  </div>
  
  <button class="rate-btn" style="background:#444; box-shadow:0 4px 0 #222; margin-top:20px;" onclick="location.reload()">–ó–ê–ù–û–í–û</button>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

// –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç (–Ω–∞–∑–≤–∞–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º ID –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫)
const CARDS = [
  {id: "mega-knight", n: "–ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—å", e: 7, t: "mid"},
  {id: "hog-rider", n: "–•–æ–≥", e: 4, t: "win"},
  {id: "pekka", n: "–ü–ï–ö–ö–ê", e: 7, t: "heavy"},
  {id: "the-log", n: "–ë—Ä–µ–≤–Ω–æ", e: 2, t: "spell"},
  {id: "fireball", n: "–§–∞–π–µ—Ä–±–æ–ª", e: 4, t: "spell"},
  {id: "electro-giant", n: "–≠–ª–µ–∫—Ç—Ä–æ–≥–∏–≥–∞–Ω—Ç", e: 7, t: "mid"},
  {id: "elite-barbarians", n: "–≠–ª–∏—Ç–∫–∏", e: 6, t: "mid"},
  {id: "balloon", n: "–®–∞—Ä", e: 5, t: "win"},
  {id: "goblin-barrel", n: "–ë–æ—á–∫–∞", e: 3, t: "win"},
  {id: "inferno-tower", n: "–ò–Ω—Ñ–µ—Ä–Ω–æ", e: 5, t: "def"},
  {id: "skeletons", n: "–°–∫–µ–ª–µ—Ç—ã", e: 1, t: "cycle"},
  {id: "ice-spirit", n: "–î—É—Ö", e: 1, t: "cycle"},
  {id: "x-bow", n: "–ê—Ä–±–∞–ª–µ—Ç", e: 6, t: "cancer"},
  {id: "mortar", n: "–ú–æ—Ä—Ç–∏—Ä–∞", e: 4, t: "win"},
  {id: "graveyard", n: "–ö–ª–∞–¥–±–∏—â–µ", e: 5, t: "win"},
  {id: "electro-wizard", n: "–≠–ª–µ–∫—Ç—Ä–æ–º–∞–≥", e: 4, t: "sup"}
];

let deck = Array(8).fill(null);
let curIdx = 0;

function openPicker(idx) {
  curIdx = idx;
  const list = document.getElementById('picker-list');
  list.innerHTML = CARDS.map(c => `
    <div class="card-item" onclick="select('${c.id}')">
      <img src="https://royaleapi.github.io/cr-api-assets/cards/${c.id}.png">
      <div>${c.n}</div>
    </div>
  `).join('');
  document.getElementById('picker').style.display = 'flex';
}

function select(id) {
  const card = CARDS.find(c => c.id === id);
  deck[curIdx] = card;
  const slot = document.getElementById(`s${curIdx}`);
  slot.innerHTML = `<div class="elixir-badge">${card.e}</div><img src="https://royaleapi.github.io/cr-api-assets/cards/${id}.png">`;
  document.getElementById('picker').style.display = 'none';
  tg.HapticFeedback.selectionChanged();
}

function analyze() {
  if (deck.includes(null)) return tg.showAlert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ –≤—Å–µ 8 –∫–∞—Ä—Ç, —Ç–æ—Ä–º–æ–∑!");

  const avg = (deck.reduce((a,b) => a+b.e, 0) / 8).toFixed(1);
  const hasMid = deck.some(c => c.t === 'mid' || c.e > 6);
  const hasWin = deck.some(c => c.t === 'win' || c.t === 'cancer');
  const hasSpell = deck.some(c => c.t === 'spell');

  let title, text, emoji;

  if (hasMid && avg > 4.4) {
    emoji = "ü§°";
    title = "–ú–ò–î–õ–ê–î–î–ï–†-–¢–í–ê–†–¨";
    text = `–°—Ä–µ–¥–Ω–∏–π —ç–ª–∏–∫—Å–∏—Ä ${avg}. –¢—ã —Å–µ—Ä—å–µ–∑–Ω–æ? –ù–∞–∫–∏–¥–∞–ª —ç–ª–∏—Ç–æ–∫, –º–µ–≥–∞—Ä—ã—Ü–∞—Ä—è –∏ –¥—É–º–∞–µ—à—å, —á—Ç–æ —Ç—ã —É–º–Ω—ã–π? –¢–≤–æ–π –ø—Ä–µ–¥–µ–ª - 5000 –∫—É–±–∫–æ–≤ –∏ –ø–æ–∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ö–µ–π—Ç. –£–¥–∞–ª—è–π –∏–≥—Ä—É.`;
  } else if (!hasWin) {
    emoji = "ü§®";
    title = "–ë–ï–ó–î–ê–†–¨";
    text = "–í —Ç–≤–æ–µ–π –∫–æ–ª–æ–¥–µ –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–π –∫–∞—Ä—Ç—ã, –∫–æ—Ç–æ—Ä–∞—è –±—å–µ—Ç –±–∞—à–Ω–∏. –¢—ã —Å–æ–±—Ä–∞–ª—Å—è –≤—ã–∏–≥—Ä—ã–≤–∞—Ç—å –Ω–∞ –Ω–∏—á—å—é? –î–æ–±–∞–≤—å –•–æ–≥–∞ –∏–ª–∏ –®–∞—Ä–∞, –Ω–µ –ø–æ–∑–æ—Ä—å—Å—è –≤ –¢–∏–∫–¢–æ–∫–µ.";
  } else if (!hasSpell) {
    emoji = "ü§¨";
    title = "–ñ–ï–†–¢–í–ê –ê–ë–û–†–¢–ê";
    text = "–ù–∏ –æ–¥–Ω–æ–≥–æ —Å–ø–µ–ª–ª–∞. –¢—ã –ø—Ä–æ—Å—Ç–æ –∫–æ—Ä–º –¥–ª—è –ì–æ–±–ª–∏–Ω—Å–∫–æ–π –±–æ—á–∫–∏. –î–∞–∂–µ –ë—Ä–µ–≤–Ω–æ –Ω–µ –≤–∑—è–ª, –≥–µ–Ω–∏–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏.";
  } else if (avg < 3.0) {
    emoji = "üåö";
    title = "–ü–û–¢–ù–´–ô –¶–ò–ö–õ–ï–†";
    text = `–≠–ª–∏–∫—Å–∏—Ä ${avg}. –û–ø—è—Ç—å –•–æ–≥ 2.6 –∏–ª–∏ –ø–æ–¥–æ–±–Ω–∞—è –¥–∏—á—å? –¢—ã –ª–∏–±–æ –∫–∏–±–µ—Ä–∫–æ—Ç–ª–µ—Ç–∞, –ª–∏–±–æ –∑–∞–¥—Ä–æ—Ç, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ—Ç –ª–∏—á–Ω–æ–π –∂–∏–∑–Ω–∏. –ù–æ –∑–∞ —Å–∫–∏–ª–ª —É–≤–∞–∂–µ–Ω–∏–µ.`;
  } else {
    emoji = "üî•";
    title = "–ì–ò–ì–ê–ß–ê–î";
    text = `–°—Ä–µ–¥–Ω–∏–π —ç–ª–∏–∫—Å–∏—Ä ${avg}. –£–¥–∏–≤–∏—Ç–µ–ª—å–Ω–æ, –Ω–æ —ç—Ç–æ –∞–¥–µ–∫–≤–∞—Ç–Ω–∞—è –∫–æ–ª–æ–¥–∞. –ë–∞–ª–∞–Ω—Å, —Å–ø–µ–ª–ª—ã, –≤–∏–Ω–∫–æ–Ω ‚Äî –≤—Å—ë –Ω–∞ –º–µ—Å—Ç–µ. –° —ç—Ç–∏–º –º–æ–∂–Ω–æ –∏ –≤ –∫–∏–±–µ—Ä—Å–ø–æ—Ä—Ç.`;
  }

  // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  document.getElementById('res-emoji').innerText = emoji;
  document.getElementById('res-title').innerText = title;
  document.getElementById('res-text').innerText = text;
  
  const mini = document.getElementById('res-mini-grid');
  mini.innerHTML = deck.map(c => `<div class="mini-card"><img src="https://royaleapi.github.io/cr-api-assets/cards/${c.id}.png"></div>`).join('');
  
  document.getElementById('result-screen').style.display = 'flex';
  tg.HapticFeedback.notificationOccurred('warning');
}
</script>
</body>
</html>
