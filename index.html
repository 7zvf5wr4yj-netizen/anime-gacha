<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>DECK ROASTER AI - TOTAL EDITION</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root { --red: #ff003c; --cyan: #00f2ff; --bg: #000; }
    body { background: var(--bg); color: #fff; font-family: 'Outfit', sans-serif; margin: 0; padding: 0; overflow: hidden; }
    .app { display: flex; flex-direction: column; height: 100vh; max-width: 500px; margin: 0 auto; }
    .header { padding: 15px; text-align: center; border-bottom: 2px solid var(--red); background: #050505; }
    .glitch { font-family: 'Orbitron'; font-size: 18px; text-shadow: 2px 2px var(--red); text-transform: uppercase; letter-spacing: 1px; }
    .deck-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; padding: 15px; background: #080808; }
    .slot { aspect-ratio: 1/1.2; background: #111; border: 1px solid #222; border-radius: 8px; display: flex; align-items: center; justify-content: center; position: relative; overflow: hidden; }
    .slot.filled { border-color: var(--cyan); box-shadow: 0 0 10px rgba(0,242,255,0.2); }
    .slot img { width: 100%; height: 100%; object-fit: contain; }
    .stats { padding: 10px 20px; flex-grow: 1; background: #000; }
    .stat-row { margin-bottom: 10px; }
    .stat-label { display: flex; justify-content: space-between; font-family: 'Orbitron'; font-size: 9px; color: #666; }
    .bar-bg { background: #1a1a1a; height: 6px; border-radius: 3px; margin-top: 4px; }
    .bar-fill { height: 100%; width: 0%; background: var(--cyan); transition: 1s ease; box-shadow: 0 0 10px var(--cyan); }
    .btn-main { margin: 10px 15px; padding: 18px; border: none; border-radius: 12px; background: var(--red); color: #fff; font-family: 'Orbitron'; font-weight: 900; cursor: pointer; box-shadow: 0 4px 0 #80001e; }
    .modal { position: fixed; inset: 0; background: #000; z-index: 1000; display: none; flex-direction: column; }
    .search-area { padding: 15px; background: #0a0a0a; border-bottom: 1px solid #222; }
    #search { width: 100%; padding: 12px; background: #111; border: 1px solid var(--red); border-radius: 8px; color: #fff; outline: none; box-sizing: border-box; }
    .card-list { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 15px; overflow-y: auto; flex-grow: 1; }
    .card-item { background: #0a0a0a; border: 1px solid #222; border-radius: 10px; padding: 5px; text-align: center; }
    .card-item img { width: 100%; border-radius: 5px; background: #111; min-height: 80px; }
    .card-item div { font-size: 8px; color: #888; margin-top: 5px; white-space: nowrap; overflow: hidden; }
    .result-view { position: fixed; inset: 0; background: #000; z-index: 2000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
    .result-card { background: #0a0a0a; border: 3px solid var(--red); border-radius: 20px; padding: 20px; text-align: center; width: 100%; box-sizing: border-box; }
    #res-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-top: 15px; }
    #res-grid img { width: 100%; border-radius: 4px; }
  </style>
</head>
<body>

<div class="app">
  <div class="header"><div class="glitch">DECK ROASTER AI</div></div>
  <div class="deck-grid" id="main-grid">
    <script>
      for(let i=0; i<8; i++) document.write(`<div class="slot" id="s${i}" onclick="openModal(${i})"><img id="img${i}" style="display:none"><span id="p${i}" style="opacity:0.2">+</span></div>`);
    </script>
  </div>
  <div class="stats">
    <div class="stat-row"><div class="stat-label"><span>TOXICITY</span><span id="v-tox">0%</span></div><div class="bar-bg"><div class="bar-fill" id="b-tox"></div></div></div>
    <div class="stat-row"><div class="stat-label"><span>SKILL ISSUE</span><span id="v-skill">0%</span></div><div class="bar-bg"><div class="bar-fill" id="b-skill"></div></div></div>
    <div class="stat-row"><div class="stat-label"><span style="color:var(--red)">GIRLFRIEND CHANCE</span><span id="v-love">100%</span></div><div class="bar-bg"><div class="bar-fill" id="b-love" style="background:var(--red); width:100%"></div></div></div>
  </div>
  <button class="btn-main" onclick="startRoast()">–ü–†–û–ñ–ê–†–ò–¢–¨ –î–ï–ö–£</button>
</div>

<div id="modal" class="modal">
  <div class="search-area">
    <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ –∫–∞—Ä—Ç—ã..." oninput="renderCards()">
    <button onclick="closeModal()" style="background:none; border:none; color:var(--red); margin-top:10px; width:100%; font-weight:bold; cursor:pointer;">–ó–ê–ö–†–´–¢–¨</button>
  </div>
  <div class="card-list" id="card-list"></div>
</div>

<div id="result" class="result-view">
  <div id="capture-area" class="result-card">
    <div id="res-emoji" style="font-size: 50px;"></div>
    <h2 id="res-title" style="color:var(--red); font-family:'Orbitron'; margin: 10px 0;"></h2>
    <p id="res-text" style="font-size: 13px; line-height: 1.4; color: #ccc; min-height: 60px;"></p>
    <div id="res-grid"></div>
  </div>
  <button class="btn-main" style="width:100%" onclick="saveResult()">–°–û–•–†–ê–ù–ò–¢–¨ –†–ï–ó–£–õ–¨–¢–ê–¢</button>
  <button onclick="location.reload()" style="background:none; border:none; color:#555; margin-top:10px; cursor:pointer;">–ó–ê–ù–û–í–û</button>
</div>

<script>
const tg = window.Telegram.WebApp; tg.expand();

// –ü–û–õ–ù–´–ô –°–ü–ò–°–û–ö –° –ü–†–ê–í–ò–õ–¨–ù–´–ú–ò ID –î–õ–Ø –°–ï–†–í–ï–†–ê
const RAW_DATA = [
    {n: "–ê–¥—Å–∫–∞—è –±–∞—à–Ω—è", id: "inferno-tower"}, {n: "–ê–¥—Å–∫–∞—è –≥–æ–Ω—á–∞—è", id: "lava-hound"}, {n: "–ê—Ä–±–∞–ª–µ—Ç", id: "x-bow", t: 1}, 
    {n: "–ê—Ä–º–∏—è —Å–∫–µ–ª–µ—Ç–æ–≤", id: "skeleton-army"}, {n: "–ë–∞–Ω–¥–∞ –≥–æ–±–ª–∏–Ω–æ–≤", id: "goblin-gang"}, {n: "–ë–∞–Ω–¥–∏—Ç–∫–∞", id: "bandit"}, 
    {n: "–ë–∞—à–Ω—è-–±–æ–º–±—ë–∂–∫–∞", id: "bomb-tower"}, {n: "–ë–µ–∑–¥–Ω–∞", id: "void"}, {n: "–ë–µ—Ä—Å–µ—Ä–∫—à–∞", id: "valkyrie"}, 
    {n: "–ë–æ–µ–≤–æ–π —Ç–∞—Ä–∞–Ω", id: "battle-ram"}, {n: "–ë–æ—á–∫–∞ —Å–æ —Å–∫–µ–ª–µ—Ç–∞–º–∏", id: "skeleton-barrel"}, {n: "–ë—Ä–µ–≤–Ω–æ", id: "the-log"}, 
    {n: "–í–∞–ª—å–∫–∏—Ä–∏—è", id: "valkyrie"}, {n: "–í–∞—Ä–≤–∞—Ä—Å–∫–∞—è –±–æ—á–∫–∞", id: "barbarian-barrel"}, {n: "–í–∞—Ä–≤–∞—Ä—Å–∫–∞—è –ø—É—Å–∫–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞", id: "barbarian-launcher"}, 
    {n: "–í–∞—Ä–≤–∞—Ä—ã", id: "barbarians", nb: 1}, {n: "–í–µ–¥—å–º–∞", id: "witch", nb: 1}, {n: "–í–µ–¥—å–º–∏–Ω–∞ –±–∞–±—É—à–∫–∞", id: "mother-witch"}, 
    {n: "–í—Å–∞–¥–Ω–∏–∫ –Ω–∞ –∫–∞–±–∞–Ω–µ", id: "hog-rider"}, {n: "–í—Å–∞–¥–Ω–∏—Ü–∞ –Ω–∞ –±–∞—Ä–∞–Ω–µ", id: "ram-rider"}, {n: "–í—ã—à–∏–±–∞–ª–∞", id: "bowler"}, 
    {n: "–ì–∏–≥–∞–Ω—Ç", id: "giant"}, {n: "–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π —Å–∫–µ–ª–µ—Ç", id: "giant-skeleton", nb: 1}, {n: "–ì–∏–≥–∞–Ω—Ç—Å–∫–∏–π —Å–Ω–µ–∂–æ–∫", id: "giant-snowball"}, 
    {n: "–ì–ª–∞–≤–Ω–∞—è –±–∞–Ω–¥–∏—Ç–∫–∞", id: "bandit"}, {n: "–ì–æ–±–ª–∏–Ω —Å –¥—Ä–æ—Ç–∏–∫–∞–º–∏", id: "dart-goblin"}, {n: "–ì–æ–±–ª–∏–Ω-–≥–∏–≥–∞–Ω—Ç", id: "goblin-giant"}, 
    {n: "–ì–æ–±–ª–∏–Ω-–ø–æ–¥—Ä—ã–≤–Ω–∏–∫", id: "bomber"}, {n: "–ì–æ–±–ª–∏–Ω—Å–∫–∞—è –±–æ—á–∫–∞", id: "goblin-barrel", t: 1}, {n: "–ì–æ–±–ª–∏–Ω—Å–∫–∏–π –±—É—Ä", id: "goblin-drill"}, 
    {n: "–ì–æ–±–ª–∏–Ω—à—Ç–µ–π–Ω", id: "goblinstein"}, {n: "–ì–æ–±–ª–∏–Ω—ã", id: "goblins"}, {n: "–ì–æ–±–ª–∏–Ω—ã-–∫–æ–ø–µ–π—â–∏–∫–∏", id: "spear-goblins"}, 
    {n: "–ì–æ–±–ª–∏–Ω—è—Ç–∞", id: "bush"}, {n: "–ì–æ–ª–µ–º", id: "golem"}, {n: "–ì—Ä–∞—Ñ–∏–Ω—è —Å –∫–∏–Ω–∂–∞–ª–∞–º–∏", id: "dagger-duchess"}, 
    {n: "–ì—Ä–æ–º–æ–≤–µ—Ä–∂–µ—Ü", id: "electro-wizard"}, {n: "–î—Ä–∞–∫–æ–Ω—á–∏–∫", id: "baby-dragon"}, {n: "–î—Ä–æ–≤–æ—Å–µ–∫", id: "lumberjack"}, 
    {n: "–î—É—Ö –∏—Å—Ü–µ–ª–µ–Ω–∏—è", id: "heal-spirit"}, {n: "–ó–∞–º–æ—Ä–æ–∑–∫–∞", id: "freeze", t: 1}, {n: "–ó–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–µ", id: "earthquake"}, 
    {n: "–ó–µ—Ä–∫–∞–ª–æ", id: "mirror", t: 1}, {n: "–ó–æ–ª–æ—Ç–æ–π —Ä—ã—Ü–∞—Ä—å", id: "golden-knight"}, {n: "–ò–º–ø–µ—Ä–∞—Ç—Ä–∏—Ü–∞ –¥—É—Ö–æ–≤", id: "mother-witch"}, 
    {n: "–ò—Å—Ü–µ–ª–µ–Ω–∏–µ", id: "heal"}, {n: "–ö–∞–Ω–æ–Ω–∏—Ä", id: "cannoneer"}, {n: "–ö–ª–∞–¥–±–∏—â–µ", id: "graveyard"}, 
    {n: "–ö–ª–µ—Ç–∫–∞ —Å –≥–æ–±–ª–∏–Ω–æ–º", id: "goblin-cage"}, {n: "–ö–ª–æ–Ω", id: "clone", t: 1}, {n: "–ö–æ–ª–¥—É–Ω", id: "wizard", nb: 1}, 
    {n: "–ö–æ—Ä–æ–ª–µ–≤–∞ –ª—É—á–Ω–∏—Ü", id: "archer-queen"}, {n: "–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∞—è –ø–æ—á—Ç–∞", id: "royal-delivery"}, {n: "–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–µ –∫–∞–±–∞–Ω—ã", id: "royal-hogs"}, 
    {n: "–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–µ —Ä–µ–∫—Ä—É—Ç—ã", id: "royal-recruits"}, {n: "–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –≥–∏–≥–∞–Ω—Ç", id: "royal-giant"}, {n: "–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –ø–æ–≤–∞—Ä", id: "executioner"}, 
    {n: "–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –ø—Ä–∏–∑—Ä–∞–∫", id: "royal-ghost"}, {n: "–ö–æ—Ä–æ–ª—å Royale", id: "king"}, {n: "–ö–æ—Ä–æ–ª—å —Å–∫–µ–ª–µ—Ç–æ–≤", id: "skeleton-king"}, 
    {n: "–ö–æ—Å—Ç—è–Ω—ã–µ –¥—Ä–∞–∫–æ–Ω—ã", id: "skeleton-dragons"}, {n: "–õ–µ–¥—è–Ω–æ–π –≥–æ–ª–µ–º", id: "ice-golem"}, {n: "–õ–µ–¥—è–Ω–æ–π –¥—É—Ö", id: "ice-spirit"}, 
    {n: "–õ–µ–¥—è–Ω–æ–π –∫–æ–ª–¥—É–Ω", id: "ice-wizard"}, {n: "–õ–µ–¥—è–Ω–æ–π —Å—É–ø–µ—Ä–≥–æ–ª–µ–º", id: "ice-golem"}, {n: "–õ–µ—Ç—É—á–∏–µ –º—ã—à–∏", id: "bats"}, 
    {n: "–õ–µ—Ç—É—á–∫–∞", id: "flying-machine"}, {n: "–õ–æ–∑–∞", id: "poison"}, {n: "–õ—É—á–Ω–∏—Ü—ã", id: "archers"}, 
    {n: "–ú–∞–≥–∏—á–µ—Å–∫–∏–π –ª—É—á–Ω–∏–∫", id: "magic-archer"}, {n: "–ú–∞–ª–µ–Ω—å–∫–∏–π –ü—Ä–∏–Ω—Ü", id: "little-prince"}, {n: "–ú–µ–≥–∞–º–∏–Ω—å–æ–Ω", id: "mega-minion"}, 
    {n: "–ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—å", id: "mega-knight", nb: 1}, {n: "–ú–∏–Ω–∏-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã", id: "zappies"}, {n: "–ú–∏–Ω–∏-–ü.–ï.–ö.–ö.–ê.", id: "mini-pekka"}, 
    {n: "–ú–∏–Ω—å–æ–Ω—ã", id: "minions"}, {n: "–ú–æ–ª–Ω–∏—è", id: "lightning"}, {n: "–ú–æ–Ω–∞—Ö", id: "monk"}, 
    {n: "–ú–æ—Ä—Ç–∏—Ä–∞", id: "mortar", t: 1}, {n: "–ú—É—à–∫–µ—Ç—ë—Ä", id: "musketeer"}, {n: "–ù–∞–¥–≥—Ä–æ–±–∏–µ", id: "tombstone"}, 
    {n: "–ù–æ—á–Ω–∞—è –≤–µ–¥—å–º–∞", id: "night-witch"}, {n: "–û–≥–Ω–µ–Ω–Ω–∞—è –ª—É—á–Ω–∏—Ü–∞", id: "firecracker"}, {n: "–û–≥–Ω–µ–Ω–Ω—ã–π –¥—É—Ö", id: "fire-spirit"}, 
    {n: "–û–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä", id: "fireball"}, {n: "–û—Ä–¥–∞ –º–∏–Ω—å–æ–Ω–æ–≤", id: "minion-horde", nb: 1}, {n: "–û—Ö–æ—Ç–Ω–∏–∫", id: "hunter"}, 
    {n: "–ü.–ï.–ö.–ö.–ê.", id: "pekka"}, {n: "–ü–∞–ª–∞—á", id: "executioner"}, {n: "–ü–µ—á—å", id: "furnace", nb: 1}, 
    {n: "–ü–ª–∞–º–µ–Ω–Ω—ã–π –¥—Ä–∞–∫–æ–Ω", id: "inferno-dragon"}, {n: "–ü–æ–≤–æ–∑–∫–∞ —Å –ø—É—à–∫–æ–π", id: "cannon-cart"}, {n: "–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π –∫—É—Å—Ç", id: "suspicious-bush"}, 
    {n: "–ü–æ–¥—Ä—ã–≤–Ω–∏–∫", id: "bomber"}, {n: "–ü—Ä–∞–∑–¥–Ω–∏—á–Ω–∞—è —Ä–∞–∫–µ—Ç–∞", id: "rocket"}, {n: "–ü—Ä–∞–∑–¥–Ω–∏—á–Ω–∞—è —Ö–∏–∂–∏–Ω–∞", id: "goblin-hut"}, 
    {n: "–ü—Ä–∏–Ω—Ü", id: "prince"}, {n: "–ü—Ä–∏–Ω—Ü–µ—Å—Å–∞", id: "princess"}, {n: "–ü—Ä–∏–Ω—Ü–µ—Å—Å–∞ –∏–∑ –±–∞—à–Ω–∏", id: "tower-princess"}, 
    {n: "–ü—É—à–∫–∞", id: "cannon"}, {n: "–†–∞–∑–±–æ–π–Ω–∏–∫–∏", id: "rascals"}, {n: "–†–∞–∑—Ä—è–¥", id: "zap"}, 
    {n: "–†–∞–∫–µ—Ç–∞", id: "rocket", t: 1}, {n: "–†—É–Ω–∏—á–µ—Å–∫–∞—è –≥–∏–≥–∞–Ω—Ç—à–∞", id: "giant"}, {n: "–†—ã–±–∞–∫", id: "fisherman"}, 
    {n: "–†—ã—Ü–∞—Ä—å", id: "knight"}, {n: "–°–∞–Ω—Ç–∞ –Ω–∞ –∫–∞–±–∞–Ω–µ", id: "hog-rider"}, {n: "–°–±–æ—Ä—â–∏–∫ —ç–ª–∏–∫—Å–∏—Ä–∞", id: "elixir-collector"}, 
    {n: "–°–∫–µ–ª–µ—Ç—ã", id: "skeletons"}, {n: "–°–ø–∞—Ä–∫–∏", id: "sparky", t: 1}, {n: "–°—Ç–µ–Ω–æ–±–æ–∏", id: "wall-breakers"}, 
    {n: "–°—Ç—Ä–∞–∂–∏", id: "guards"}, {n: "–°—Ç—Ä–µ–ª—ã", id: "arrows"}, {n: "–°—É–ø–µ—Ä-–∞–¥—Å–∫–∞—è –≥–æ–Ω—á–∞—è", id: "lava-hound"}, 
    {n: "–°—É–ø–µ—Ä–≤–µ–¥—å–º–∞", id: "witch"}, {n: "–°—É–ø–µ—Ä–º–∞–≥–∏—á–µ—Å–∫–∏–π –ª—É—á–Ω–∏–∫", id: "magic-archer"}, {n: "–°—É–ø–µ—Ä–º–∏–Ω–∏-–ü.–ï.–ö.–ö.–ê.", id: "mini-pekka"}, 
    {n: "–¢—ë–º–Ω—ã–π –ø—Ä–∏–Ω—Ü", id: "dark-prince"}, {n: "–¢–µ—Ä—Ä–∏", id: "ram-rider"}, {n: "–¢–µ—Å–ª–∞", id: "tesla"}, 
    {n: "–¢–æ—Ä–Ω–∞–¥–æ", id: "tornado", t: 1}, {n: "–¢—Ä–∏ –º—É—à–∫–µ—Ç—ë—Ä–∞", id: "three-musketeers"}, {n: "–¢—Ä–∏–æ –∫–æ–ª–¥—É–Ω–æ–≤", id: "wizard"}, 
    {n: "–§–µ–Ω–∏–∫—Å", id: "phoenix"}, {n: "–•–∏–∂–∏–Ω–∞ –≤–∞—Ä–≤–∞—Ä–æ–≤", id: "barbarian-hut", nb: 1}, {n: "–•–∏–∂–∏–Ω–∞ –≥–æ–±–ª–∏–Ω–æ–≤", id: "goblin-hut", nb: 1}, 
    {n: "–¶–µ–ª–∏—Ç–µ–ª—å–Ω–∏—Ü–∞-–≤–æ–∏–Ω", id: "battle-healer"}, {n: "–®–∞—Ä", id: "balloon"}, {n: "–®–∞—Ö—Ç—ë—Ä", id: "miner"}, 
    {n: "–®—É—Å—Ç—Ä—ã–π —à–∞—Ö—Ç—ë—Ä", id: "mighty-miner"}, {n: "–≠–≤–æ–ª—é—Ü–∏—è", id: "firecracker"}, {n: "–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∏–π –¥—É—Ö", id: "electro-spirit"}, 
    {n: "–≠–ª–µ–∫—Ç—Ä–æ–≥–∏–≥–∞–Ω—Ç", id: "electro-giant", t: 1}, {n: "–≠–ª–µ–∫—Ç—Ä–æ–¥—Ä–∞–∫–æ–Ω", id: "electro-dragon"}, {n: "–≠–ª–∏–∫—Å–∏—Ä–Ω—ã–π –≥–æ–ª–µ–º", id: "elixir-golem"}, 
    {n: "–≠–ª–∏—Ç–Ω—ã–µ –≤–∞—Ä–≤–∞—Ä—ã", id: "elite-barbarians", t: 1}, {n: "–Ø–¥", id: "poison"}, {n: "–Ø—Ä–æ—Å—Ç—å", id: "rage", t: 1}
];

const ALL_CARDS = RAW_DATA.map(c => ({
    name: c.n,
    url: `https://royaleapi.com/static/img/cards-150/${c.id}.png`,
    tox: c.t || 0,
    noob: c.nb || 0
}));

let deck = Array(8).fill(null);
let currentSlotIdx = 0;

function openModal(i) {
    currentSlotIdx = i;
    document.getElementById('modal').style.display = 'flex';
    renderCards();
}

function closeModal() { document.getElementById('modal').style.display = 'none'; }

function renderCards() {
    const q = document.getElementById('search').value.toLowerCase();
    const list = document.getElementById('card-list');
    list.innerHTML = ALL_CARDS.filter(c => c.name.toLowerCase().includes(q)).map(c => `
        <div class="card-item" onclick="selectCard('${c.name}')">
            <img src="${c.url}" loading="lazy" onerror="this.src='https://placehold.co/100x130?text=CARD'">
            <div>${c.name}</div>
        </div>
    `).join('');
}

function selectCard(name) {
    // –ü–†–û–í–ï–†–ö–ê –ù–ê –û–î–ò–ù–ê–ö–û–í–´–ï –ö–ê–†–¢–´
    if (deck.some(c => c && c.name === name)) {
        tg.showAlert("–≠—Ç–∞ –∫–∞—Ä—Ç–∞ —É–∂–µ –µ—Å—Ç—å –≤ –¥–µ–∫–µ! –í—ã–±–µ—Ä–∏ –¥—Ä—É–≥—É—é.");
        return;
    }

    const card = ALL_CARDS.find(x => x.name === name);
    deck[currentSlotIdx] = card;
    
    const img = document.getElementById(`img${currentSlotIdx}`);
    img.src = card.url;
    img.style.display = 'block';
    document.getElementById(`p${currentSlotIdx}`).style.display = 'none';
    document.getElementById(`s${currentSlotIdx}`).classList.add('filled');
    
    closeModal();
    updateStats();
}

function updateStats() {
    const d = deck.filter(x => x);
    const t = (d.filter(x => x.tox).length / 3) * 100;
    const n = (d.filter(x => x.noob).length / 3) * 100;
    
    document.getElementById('b-tox').style.width = Math.min(100, t) + '%';
    document.getElementById('v-tox').innerText = Math.round(t) + '%';
    document.getElementById('b-skill').style.width = Math.min(100, n) + '%';
    document.getElementById('v-skill').innerText = Math.round(n) + '%';
    
    const love = Math.max(0, 100 - (t + n));
    document.getElementById('b-love').style.width = love + '%';
    document.getElementById('v-love').innerText = Math.round(love) + '%';
}

function startRoast() {
    if (deck.includes(null)) return tg.showAlert("–°–æ–±–µ—Ä–∏ –≤—Å–µ 8 –∫–∞—Ä—Ç!");
    
    const tCount = deck.filter(x => x.tox).length;
    const nCount = deck.filter(x => x.noob).length;
    
    let title, emoji, text;

    if (tCount >= 3) {
        title = "–¢–û–ö–°–ò–ß–ù–ê–Ø –ü–û–ú–û–ô–ö–ê";
        emoji = "‚ò£Ô∏è";
        text = "–ê—Ä–±–∞–ª–µ—Ç, –ó–µ—Ä–∫–∞–ª–æ, –ó–∞–º–æ—Ä–æ–∑–∫–∞... –¢–≤–æ–π –±–∞—Ç—è —É—à–µ–ª –∑–∞ —Ö–ª–µ–±–æ–º, –∫–æ–≥–¥–∞ —É–≤–∏–¥–µ–ª, —á–µ–º —Ç—ã –∏–≥—Ä–∞–µ—à—å. –° —Ç–æ–±–æ–π –Ω–∏–∫—Ç–æ –Ω–µ —Ö–æ—á–µ—Ç –¥—Ä—É–∂–∏—Ç—å, –¥–∞–∂–µ –±–æ—Ç—ã.";
    } else if (nCount >= 3) {
        title = "–ú–ê–°–¢–ï–† –ú–ò–î–õ–ê–î–î–ï–†–ê";
        emoji = "ü§°";
        text = "–ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—å –∏ –≠–ª–∏—Ç–∫–∏. –¢–∏–ø–∏—á–Ω—ã–π –æ–±–∏—Ç–∞—Ç–µ–ª—å 5000 –∫—É–±–∫–æ–≤. –¢—ã –ø—Ä–æ—Å—Ç–æ –∫–∏–¥–∞–µ—à—å –≤—Å—ë –Ω–∞ –º–æ—Å—Ç –∏ –Ω–∞–¥–µ–µ—à—å—Å—è, —á—Ç–æ —É –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ –≤—ã–ª–µ—Ç–∏—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç.";
    } else {
        title = "–ú–ï–¢–ê-–†–ê–ë –ë–ï–ó –ú–û–ó–ì–ê";
        emoji = "ü§ñ";
        text = "–û, –æ—á–µ—Ä–µ–¥–Ω–∞—è –¥–µ–∫–∞ –∏–∑ —Ç–æ–ø–∞. –°–≤–æ–µ–≥–æ —É–º–∞ –Ω–µ —Ö–≤–∞—Ç–∏–ª–æ? –¢—ã –∫–∞–∫ —Ä–æ–±–æ—Ç ‚Äî –ø—Ä–æ—Å—Ç–æ –∫–æ–ø–∏—Ä—É–µ—à—å —á—É–∂–∏–µ –±–∏–ª–¥—ã, –Ω–æ —Å–∫–∏–ª–ª–∞ —ç—Ç–æ –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç.";
    }

    document.getElementById('res-title').innerText = title;
    document.getElementById('res-emoji').innerText = emoji;
    document.getElementById('res-text').innerText = text;
    document.getElementById('res-grid').innerHTML = deck.map(x => `<img src="${x.url}">`).join('');
    document.getElementById('result').style.display = 'flex';
    tg.HapticFeedback.notificationOccurred('error');
}

function saveResult() {
    html2canvas(document.getElementById('capture-area')).then(canvas => {
        const a = document.createElement('a');
        a.download = 'roast.png';
        a.href = canvas.toDataURL();
        a.click();
        tg.showAlert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!");
    });
}
</script>
</body>
</html>
