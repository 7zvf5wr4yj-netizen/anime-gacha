<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>CR: Analytics Elite</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #080a0f;
      --accent: #00d2ff;
      --pink: #ff00ff;
      --glass: rgba(255, 255, 255, 0.05);
      --border: rgba(255, 255, 255, 0.1);
    }

    body {
      background: var(--bg);
      background-image: radial-gradient(circle at 50% 0%, #1c2d4d 0%, #080a0f 100%);
      color: #fff; font-family: 'Montserrat', sans-serif;
      margin: 0; padding: 0; height: 100vh; overflow: hidden;
    }

    /* –ê–ù–ò–ú–ê–¶–ò–ò */
    @keyframes cardJump {
      0% { transform: scale(0); opacity: 0; }
      60% { transform: scale(1.15); }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes slideUp {
      from { transform: translateY(100%); }
      to { transform: translateY(0); }
    }

    @keyframes shine {
      from { left: -100%; }
      to { left: 100%; }
    }

    .app { display: flex; flex-direction: column; height: 100%; max-width: 450px; margin: 0 auto; }

    .header { padding: 25px 20px; text-align: center; }
    .header h1 { 
      margin: 0; font-size: 20px; font-weight: 900; letter-spacing: 2px;
      background: linear-gradient(90deg, var(--accent), #fff);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }

    /* –°–ï–¢–ö–ê –°–õ–û–¢–û–í */
    .deck-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 10px 20px; }

    .slot {
      aspect-ratio: 1/1.25; background: var(--glass);
      border: 1px solid var(--border); border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      position: relative; transition: 0.3s; overflow: visible;
    }
    .slot.active-glow { border-color: var(--accent); box-shadow: 0 0 15px rgba(0, 210, 255, 0.3); }

    .slot img { width: 90%; height: 90%; object-fit: contain; display: none; }
    .slot.filled img { display: block; animation: cardJump 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards; }
    
    .plus-icon { font-size: 24px; color: var(--border); transition: 0.3s; }
    .slot.filled .plus-icon { display: none; }

    .elixir-tag {
      position: absolute; top: -5px; right: -5px;
      background: linear-gradient(135deg, #ff00ff, #aa00ff);
      color: white; border-radius: 50%; width: 20px; height: 20px;
      font-size: 10px; font-weight: 900; display: none;
      align-items: center; justify-content: center; border: 2px solid var(--bg); z-index: 5;
    }
    .slot.filled .elixir-tag { display: flex; }

    /* –ú–û–î–ê–õ–ö–ê –í–´–ë–û–†–ê */
    .picker-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.8);
      backdrop-filter: blur(10px); z-index: 100; display: none;
      flex-direction: column;
    }

    .picker-sheet {
      margin-top: auto; background: #12161f; border-top: 2px solid var(--accent);
      border-radius: 25px 25px 0 0; height: 80vh; overflow-y: auto;
      animation: slideUp 0.3s ease-out;
    }

    .search-box {
      position: sticky; top: 0; background: #12161f; padding: 20px;
      z-index: 10; border-bottom: 1px solid var(--border);
    }
    #search {
      width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--border);
      padding: 12px; border-radius: 10px; color: #fff; outline: none; box-sizing: border-box;
    }

    .cards-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 20px; }
    
    .card-btn { transition: 0.2s; position: relative; }
    .card-btn img { width: 100%; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.4); }
    .card-btn:active { transform: scale(0.9); }
    .card-btn.in-deck { opacity: 0.15; pointer-events: none; filter: grayscale(1); }

    /* –ö–ù–û–ü–ö–ê –ê–ù–ê–õ–ò–ó–ê */
    .footer { padding: 30px 20px; }
    .btn-main {
      width: 100%; padding: 20px; border-radius: 15px; border: none;
      background: linear-gradient(90deg, #1e3a8a, #3b82f6);
      color: #fff; font-weight: 900; text-transform: uppercase; letter-spacing: 1px;
      cursor: pointer; box-shadow: 0 5px 20px rgba(59, 130, 246, 0.3);
    }

    /* –†–ï–ó–£–õ–¨–¢–ê–¢ */
    .result-screen {
      position: fixed; inset: 0; background: var(--bg); z-index: 200;
      display: none; flex-direction: column; align-items: center; justify-content: center;
      padding: 25px; animation: slideUp 0.4s ease;
    }
    .result-box {
      background: var(--glass); border: 1px solid var(--border);
      padding: 40px 20px; border-radius: 25px; width: 100%; box-sizing: border-box;
    }
  </style>
</head>
<body>

<div class="app">
  <div class="header">
    <h1>STRATEGY ANALYST</h1>
    <p style="font-size: 9px; opacity: 0.4; letter-spacing: 2px;">NEURAL DECK EVALUATION</p>
  </div>

  <div class="deck-grid">
    <script>
      for(let i=0; i<8; i++) {
        document.write(`
          <div class="slot" id="s${i}" onclick="openPicker(${i})">
            <div class="plus-icon">Ôºã</div>
            <div class="elixir-tag" id="e${i}"></div>
            <img id="img${i}" src="">
          </div>
        `);
      }
    </script>
  </div>

  <div class="footer">
    <button class="btn-main" onclick="analyze()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∏–ª–¥</button>
  </div>
</div>

<div id="picker-modal" class="picker-overlay" onclick="closePicker()">
  <div class="picker-sheet" onclick="event.stopPropagation()">
    <div class="search-box">
      <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ –∫–∞—Ä—Ç—ã..." oninput="renderCards()">
    </div>
    <div class="cards-grid" id="cards-list"></div>
  </div>
</div>

<div id="result-screen" class="result-screen">
  <div id="mini-deck" style="display:grid; grid-template-columns: repeat(8, 1fr); gap:5px; width:100%; margin-bottom:20px;"></div>
  <div class="result-box">
    <div id="v-emoji" style="font-size: 60px; margin-bottom: 15px;">üßê</div>
    <h2 id="v-title" style="color:var(--accent); margin: 0 0 15px 0; font-size: 24px;"></h2>
    <p id="v-text" style="line-height: 1.6; opacity: 0.8; font-size: 14px;"></p>
  </div>
  <button class="btn-main" style="margin-top: 30px; background: rgba(255,255,255,0.05);" onclick="location.reload()">–ò–∑–º–µ–Ω–∏—Ç—å –±–∏–ª–¥</button>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

// –ë–ê–ó–ê –ö–ê–†–¢
const CARDS = [
  {id:"mega-knight",n:"–ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—å",e:7,t:"mid"},{id:"hog-rider",n:"–•–æ–≥",e:4,t:"win"},
  {id:"pekka",n:"–ü–ï–ö–ö–ê",e:7,t:"heavy"},{id:"the-log",n:"–ë—Ä–µ–≤–Ω–æ",e:2,t:"spell"},
  {id:"fireball",n:"–§–∞–π–µ—Ä–±–æ–ª",e:4,t:"spell"},{id:"elite-barbarians",n:"–≠–ª–∏—Ç–∫–∏",e:6,t:"mid"},
  {id:"balloon",n:"–®–∞—Ä",e:5,t:"win"},{id:"goblin-barrel",n:"–ë–æ—á–∫–∞",e:3,t:"win"},
  {id:"electro-giant",n:"–≠–ª–µ–∫—Ç—Ä–æ–≥–∏–≥–∞–Ω—Ç",e:7,t:"mid"},{id:"x-bow",n:"–ê—Ä–±–∞–ª–µ—Ç",e:6,t:"cancer"},
  {id:"graveyard",n:"–ö–ª–∞–¥–±–∏—â–µ",e:5,t:"win"},{id:"golem",n:"–ì–æ–ª–µ–º",e:8,t:"heavy"},
  {id:"miner",n:"–®–∞—Ö—Ç–µ—Ä",e:3,t:"win"},{id:"poison",n:"–Ø–¥",e:4,t:"spell"},
  {id:"skeletons",n:"–°–∫–µ–ª–µ—Ç—ã",e:1,t:"cycle"},{id:"ice-spirit",n:"–õ–µ–¥—è–Ω–æ–π –¥—É—Ö",e:1,t:"cycle"},
  {id:"valkyrie",n:"–í–∞–ª—å–∫–∏—Ä–∏—è",e:4,t:"def"},{id:"executioner",n:"–ü–∞–ª–∞—á",e:5,t:"def"},
  {id:"zap",n:"–†–∞–∑—Ä—è–¥",e:2,t:"spell"},{id:"tornado",n:"–¢–æ—Ä–Ω–∞–¥–æ",e:3,t:"spell"},
  {id:"arrows",n:"–°—Ç—Ä–µ–ª—ã",e:3,t:"spell"},{id:"princess",n:"–ü—Ä–∏–Ω—Ü–µ—Å—Å–∞",e:3,t:"win"},
  {id:"baby-dragon",n:"–î—Ä–∞–∫–æ–Ω—á–∏–∫",e:4,t:"sup"},{id:"witch",n:"–í–µ–¥—å–º–∞",e:5,t:"mid"}
];

let deck = Array(8).fill(null);
let activeSlot = null;

function openPicker(idx) {
  activeSlot = idx;
  document.getElementById('picker-modal').style.display = 'flex';
  renderCards();
  tg.HapticFeedback.impactOccurred('medium');
}

function closePicker() {
  document.getElementById('picker-modal').style.display = 'none';
}

function renderCards() {
  const query = document.getElementById('search').value.toLowerCase();
  const list = document.getElementById('cards-list');
  const usedIds = deck.filter(c => c).map(c => c.id);

  list.innerHTML = CARDS.filter(c => c.n.toLowerCase().includes(query)).map(c => `
    <div class="card-btn ${usedIds.includes(c.id) ? 'in-deck' : ''}" onclick="selectCard('${c.id}')">
      <img src="https://royaleapi.github.io/cr-api-assets/cards/${c.id}.png">
    </div>
  `).join('');
}

function selectCard(id) {
  const card = CARDS.find(c => c.id === id);
  deck[activeSlot] = card;

  const slot = document.getElementById(`s${activeSlot}`);
  const img = document.getElementById(`img${activeSlot}`);
  const elixir = document.getElementById(`e${activeSlot}`);

  // –°–ë–†–û–° –ê–ù–ò–ú–ê–¶–ò–ò (—á—Ç–æ–±—ã —Å—Ä–∞–±–æ—Ç–∞–ª–∞ –∑–∞–Ω–æ–≤–æ)
  slot.classList.remove('filled');
  void slot.offsetWidth; // –ú–∞–≥–∏—è –¥–ª—è —Ä–µ—Å—Ç–∞—Ä—Ç–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
  
  img.src = `https://royaleapi.github.io/cr-api-assets/cards/${id}.png`;
  elixir.innerText = card.e;
  slot.classList.add('filled');

  closePicker();
  tg.HapticFeedback.notificationOccurred('success');
}

function analyze() {
  if (deck.includes(null)) return tg.showAlert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ 8 —Å–ª–æ—Ç–æ–≤, —Å—Ç—Ä–∞—Ç–µ–≥!");

  const avg = (deck.reduce((a,b) => a+b.e, 0) / 8).toFixed(1);
  const midCount = deck.filter(c => c.t === 'mid' || c.e >= 7).length;
  const spellCount = deck.filter(c => c.t === 'spell').length;
  const winCount = deck.filter(c => c.t === 'win' || c.t === 'cancer').length;

  let emoji, title, text;

  if (midCount >= 3 && avg > 4.2) {
    emoji = "ü§°"; title = "–ú–ê–°–¢–ï–† –ú–ò–î–õ–ê–î–î–ï–†–ê";
    text = `–°—Ä–µ–¥–Ω–∏–π —ç–ª–∏–∫—Å–∏—Ä ${avg}. –ù–∞–±—Ä–∞–ª —Ç—è–∂–µ–ª–æ–≥–æ –º—É—Å–æ—Ä–∞ –∏ –¥–æ–≤–æ–ª–µ–Ω? –¢–≤–æ–π –º–∞–∫—Å–∏–º—É–º ‚Äî —ç—Ç–æ —Å–ø–∞–º–∏—Ç—å —Å–º–∞–π–ª–∏–∫–∞–º–∏, –∫–æ–≥–¥–∞ –ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—å –ø—Ä—ã–≥–∞–µ—Ç –Ω–∞ –º—É—à–∫–µ—Ç–µ—Ä–∞. –£—á–∏ –º–∞—Ç—á–∞—Å—Ç—å.`;
  } else if (spellCount >= 2 && winCount >= 1 && avg >= 3.0 && avg <= 3.9) {
    emoji = "üî•"; title = "–≠–õ–ò–¢–ù–´–ô –ü–ò–ö";
    text = `–°–ª—É—à–∞–π, –∞ —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –≥—Ä–∞–º–æ—Ç–Ω–æ. –ë–∞–ª–∞–Ω—Å –µ—Å—Ç—å, –≤–∏–Ω-–∫–æ–Ω –Ω–∞ –º–µ—Å—Ç–µ. –ü—Ä–∏–∑–Ω–∞–≤–∞–π—Å—è, —É–∫—Ä–∞–ª –¥–µ–∫—É —É —Ç–æ–ø–∞ –∏–ª–∏ —Å–∞–º –¥–æ–¥—É–º–∞–ª—Å—è? –ï—Å–ª–∏ —Å–∞–º ‚Äî —Å–Ω–∏–º–∞—é —à–ª—è–ø—É, –∏–¥–∏ –ª–æ–º–∞–π –∫–∞–±–∏–Ω—ã.`;
  } else if (winCount === 0) {
    emoji = "üß±"; title = "–ì–õ–£–•–ê–Ø –û–ë–û–†–û–ù–ê";
    text = "–í –¥–µ–∫–µ –Ω–µ—Ç –≤–∏–Ω-–∫–æ–Ω–∞. –¢—ã –∫–∞–∫ –±–∞—à–Ω–∏ –ª–æ–º–∞—Ç—å —Å–æ–±—Ä–∞–ª—Å—è? –ú–æ–ª–∏—Ç–≤–∞–º–∏? –î–æ–±–∞–≤—å –•–æ–≥–∞ –∏–ª–∏ –®–∞—Ä–∞, –Ω–µ –ø–æ–∑–æ—Ä—å—Å—è –≤ –¢–∏–∫–¢–æ–∫–µ.";
  } else {
    emoji = "ü§î"; title = "–°–û–ô–î–ï–¢ –î–õ–Ø –°–ï–õ–¨–°–ö–û–ô –ú–ï–°–¢–ù–û–°–¢–ò";
    text = `–ë–∏–ª–¥ (Avg: ${avg}) –∏–≥—Ä–∞–±–µ–ª—å–Ω—ã–π, –Ω–æ –±–µ–∑ –∏—Å–∫—Ä—ã. –í—Ä–æ–¥–µ –≤—Å—ë –µ—Å—Ç—å, –∞ –≤—Ä–æ–¥–µ –∏ —Å–∫—É—á–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π –¥–æ–±–∞–≤–∏—Ç—å —á—Ç–æ-—Ç–æ –±–æ–ª–µ–µ –¥–µ—Ä–∑–∫–æ–µ.`;
  }

  document.getElementById('v-emoji').innerText = emoji;
  document.getElementById('v-title').innerText = title;
  document.getElementById('v-text').innerText = text;
  document.getElementById('mini-deck').innerHTML = deck.map(c => `<img src="https://royaleapi.github.io/cr-api-assets/cards/${c.id}.png" style="width:100%; border-radius:2px;">`).join('');
  
  document.getElementById('result-screen').style.display = 'flex';
  tg.HapticFeedback.notificationOccurred('warning');
}
</script>
</body>
</html>
