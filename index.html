<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Deck Roaster AI</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #05070a;
      --accent: #00f2ff;
      --glass: rgba(255, 255, 255, 0.05);
      --border: rgba(255, 255, 255, 0.1);
    }

    body {
      background: var(--bg); color: #fff; font-family: 'Outfit', sans-serif;
      margin: 0; padding: 0; height: 100vh; overflow: hidden;
      background: radial-gradient(circle at 50% 0%, #111827 0%, #05070a 100%);
    }

    .app { display: flex; flex-direction: column; height: 100%; max-width: 500px; margin: 0 auto; }

    .header { padding: 20px; text-align: center; }
    .header h1 { margin: 0; font-size: 24px; font-weight: 900; background: linear-gradient(90deg, var(--accent), #fff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .header p { font-size: 10px; opacity: 0.5; letter-spacing: 2px; }

    /* –°–ï–¢–ö–ê –°–õ–û–¢–û–í */
    .deck-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 10px 15px; }
    .slot {
      aspect-ratio: 1/1.25; background: var(--glass); border: 1px solid var(--border);
      border-radius: 14px; display: flex; align-items: center; justify-content: center;
      position: relative; transition: 0.2s; cursor: pointer; backdrop-filter: blur(5px);
    }
    .slot.filled { border-color: var(--accent); box-shadow: 0 0 15px rgba(0, 242, 255, 0.2); }
    .slot img { width: 90%; height: 90%; object-fit: contain; display: none; }
    .slot.filled img { display: block; animation: popIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }

    @keyframes popIn { from { transform: scale(0.4); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    .elixir-badge {
      position: absolute; top: -5px; right: -5px; background: linear-gradient(135deg, #f0f, #80f);
      color: #fff; border-radius: 6px; width: 20px; height: 20px; font-size: 10px;
      font-weight: 900; display: none; align-items: center; justify-content: center; border: 1px solid #fff;
    }
    .slot.filled .elixir-badge { display: flex; }

    /* –ú–û–î–ê–õ–ö–ê –í–´–ë–û–†–ê */
    .modal {
      position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 1000;
      display: none; flex-direction: column; backdrop-filter: blur(15px);
    }
    .modal-content {
      margin-top: auto; background: #0f172a; border-top: 2px solid var(--accent);
      border-radius: 30px 30px 0 0; height: 85vh; display: flex; flex-direction: column;
    }
    .modal-header { padding: 20px; display: flex; gap: 10px; border-bottom: 1px solid var(--border); }
    #search { flex: 1; background: #1e293b; border: 1px solid var(--border); padding: 12px; border-radius: 12px; color: #fff; outline: none; }

    .cards-list { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 20px; overflow-y: auto; }
    .card-item { transition: 0.2s; position: relative; }
    .card-item img { width: 100%; border-radius: 10px; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.5)); }
    .card-item.selected { opacity: 0.2; filter: grayscale(1); pointer-events: none; }

    /* –ú–ï–ù–Æ –£–î–ê–õ–ï–ù–ò–Ø (ACTION SHEET) */
    .sheet { position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 2000; display: none; align-items: flex-end; }
    .sheet-body { background: #1e293b; width: 100%; border-radius: 25px 25px 0 0; padding: 25px; box-sizing: border-box; }
    .sheet-btn { width: 100%; padding: 18px; border-radius: 15px; border: none; font-weight: 800; margin-bottom: 12px; font-family: 'Outfit'; font-size: 16px; }

    .footer { padding: 30px 20px; }
    .btn-analyze {
      width: 100%; padding: 20px; border-radius: 18px; border: none;
      background: linear-gradient(90deg, #3b82f6, var(--accent));
      color: #fff; font-weight: 900; font-size: 16px; text-transform: uppercase;
      box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
    }

    /* –†–ï–ó–£–õ–¨–¢–ê–¢ */
    .result-view { position: fixed; inset: 0; background: var(--bg); z-index: 3000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 25px; text-align: center; }
    .res-card { background: var(--glass); border: 1px solid var(--border); border-radius: 25px; padding: 35px 20px; width: 100%; box-sizing: border-box; backdrop-filter: blur(10px); }
  </style>
</head>
<body>

<div class="app">
  <div class="header">
    <h1>DECK ROASTER AI</h1>
    <p>–¢–í–û–Ø –î–ï–ö–ê ‚Äî –ú–û–ô –Æ–ú–û–†</p>
  </div>

  <div class="deck-grid">
    <script>
      for(let i=0; i<8; i++) {
        document.write(`
          <div class="slot" id="s${i}" onclick="handleSlotClick(${i})">
            <span style="opacity:0.1" id="p${i}">Ôºã</span>
            <div class="elixir-badge" id="e${i}"></div>
            <img id="img${i}" src="">
          </div>
        `);
      }
    </script>
  </div>

  <div class="footer">
    <button class="btn-analyze" onclick="analyze()">–ü—Ä–æ–∂–∞—Ä–∏—Ç—å –±–∏–ª–¥</button>
  </div>
</div>

<div id="modal" class="modal" onclick="closeModal()">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-header">
      <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ –∫–∞—Ä—Ç—ã..." oninput="renderCards()">
      <button onclick="closeModal()" style="background:none; border:none; color:#fff; font-size:24px;">‚úï</button>
    </div>
    <div class="cards-list" id="card-list"></div>
  </div>
</div>

<div id="sheet" class="sheet" onclick="closeSheet()">
  <div class="sheet-body" onclick="event.stopPropagation()">
    <button class="sheet-btn" style="background:var(--accent); color:#000;" onclick="openPicker(lastIdx)">–ó–∞–º–µ–Ω–∏—Ç—å –∫–∞—Ä—Ç—É</button>
    <button class="sheet-btn" style="background:#ef4444; color:#fff;" onclick="removeCard()">–£–¥–∞–ª–∏—Ç—å –∏–∑ –∫–æ–ª–æ–¥—ã</button>
    <button class="sheet-btn" style="background:#334155; color:#fff;" onclick="closeSheet()">–û—Ç–º–µ–Ω–∞</button>
  </div>
</div>

<div id="result" class="result-view">
  <div id="res-grid" style="display:grid; grid-template-columns: repeat(8, 1fr); gap:4px; width:100%; margin-bottom:30px;"></div>
  <div class="res-card">
    <div id="v-emoji" style="font-size:70px; margin-bottom:10px;"></div>
    <h2 id="v-title" style="color:var(--accent); margin: 10px 0;"></h2>
    <p id="v-text" style="line-height:1.6; opacity:0.9;"></p>
  </div>
  <button class="btn-analyze" style="margin-top:40px; background:#334155;" onclick="location.reload()">–°–æ–±—Ä–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

// –ë–ê–ó–ê –ö–ê–†–¢ (–ê–±—Å–æ–ª—é—Ç–Ω–æ –≤—Å–µ)
const ALL_CARDS = [
  {id:"hog-rider",n:"–•–æ–≥",e:4,t:"win"},{id:"balloon",n:"–®–∞—Ä",e:5,t:"win"},{id:"goblin-barrel",n:"–ë–æ—á–∫–∞",e:3,t:"win"},
  {id:"mega-knight",n:"–ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—å",e:7,t:"mid"},{id:"pekka",n:"–ü–ï–ö–ö–ê",e:7,t:"heavy"},{id:"mini-pekka",n:"–ú–∏–Ω–∏ –ü–ï–ö–ö–ê",e:4,t:"heavy"},
  {id:"the-log",n:"–ë—Ä–µ–≤–Ω–æ",e:2,t:"spell"},{id:"fireball",n:"–§–∞–π–µ—Ä–±–æ–ª",e:4,t:"spell"},{id:"arrows",n:"–°—Ç—Ä–µ–ª—ã",e:3,t:"spell"},
  {id:"zap",n:"–†–∞–∑—Ä—è–¥",e:2,t:"spell"},{id:"poison",n:"–Ø–¥",e:4,t:"spell"},{id:"rocket",n:"–†–∞–∫–µ—Ç–∞",e:6,t:"spell"},
  {id:"valkyrie",n:"–í–∞–ª—å–∫–∏—Ä–∏—è",e:4,t:"def"},{id:"knight",n:"–†—ã—Ü–∞—Ä—å",e:3,t:"def"},{id:"giant",n:"–ì–∏–≥–∞–Ω—Ç",e:5,t:"win"},
  {id:"royal-giant",n:"–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –≥–∏–≥–∞–Ω—Ç",e:6,t:"win"},{id:"golem",n:"–ì–æ–ª–µ–º",e:8,t:"win"},
  {id:"electro-giant",n:"–≠–ª–µ–∫—Ç—Ä–æ–≥–∏–≥–∞–Ω—Ç",e:7,t:"win"},{id:"x-bow",n:"–ê—Ä–±–∞–ª–µ—Ç",e:6,t:"cancer"},{id:"mortar",n:"–ú–æ—Ä—Ç–∏—Ä–∞",e:4,t:"win"},
  {id:"wizard",n:"–ú–∞–≥",e:5,t:"mid"},{id:"electro-wizard",n:"–≠–ª–µ–∫—Ç—Ä–æ–º–∞–≥",e:4,t:"sup"},{id:"musketeer",n:"–ú—É—à–∫–µ—Ç–µ—Ä",e:4,t:"sup"},
  {id:"witch",n:"–í–µ–¥—å–º–∞",e:5,t:"mid"},{id:"miner",n:"–®–∞—Ö—Ç–µ—Ä",e:3,t:"win"},{id:"princess",n:"–ü—Ä–∏–Ω—Ü–µ—Å—Å–∞",e:3,t:"win"},
  {id:"little-prince",n:"–ú–∞–ª–µ–Ω—å–∫–∏–π –ø—Ä–∏–Ω—Ü",e:3,t:"sup"},{id:"monk",n:"–ú–æ–Ω–∞—Ö",e:5,t:"sup"},{id:"archer-queen",n:"–ö–æ—Ä–æ–ª–µ–≤–∞",e:5,t:"sup"},
  {id:"skeletons",n:"–°–∫–µ–ª–µ—Ç—ã",e:1,t:"cycle"},{id:"ice-spirit",n:"–õ–µ–¥—è–Ω–æ–π –¥—É—Ö",e:1,t:"cycle"},{id:"inferno-tower",n:"–ò–Ω—Ñ–µ—Ä–Ω–æ",e:5,t:"def"}
];

let deck = Array(8).fill(null);
let lastIdx = 0;

function handleSlotClick(i) {
  lastIdx = i;
  if(deck[i]) document.getElementById('sheet').style.display = 'flex';
  else openPicker(i);
}

function openPicker(i) {
  lastIdx = i; closeSheet();
  document.getElementById('modal').style.display = 'flex';
  renderCards();
}

function closeModal() { document.getElementById('modal').style.display = 'none'; }
function closeSheet() { document.getElementById('sheet').style.display = 'none'; }

function removeCard() {
  deck[lastIdx] = null;
  const s = document.getElementById(`s${lastIdx}`);
  s.classList.remove('filled');
  document.getElementById(`img${lastIdx}`).src = "";
  document.getElementById(`p${lastIdx}`).style.display = "block";
  closeSheet();
  tg.HapticFeedback.impactOccurred('light');
}

function renderCards() {
  const q = document.getElementById('search').value.toLowerCase();
  const list = document.getElementById('card-list');
  const used = deck.filter(c => c).map(c => c.id);

  list.innerHTML = ALL_CARDS.filter(c => c.n.toLowerCase().includes(q)).map(c => `
    <div class="card-item ${used.includes(c.id) ? 'selected' : ''}" onclick="selectCard('${c.id}')">
      <img src="https://royaleapi.github.io/cr-api-assets/cards/${c.id}.png">
    </div>
  `).join('');
}

function selectCard(id) {
  const card = ALL_CARDS.find(c => c.id === id);
  deck[lastIdx] = card;
  const s = document.getElementById(`s${lastIdx}`);
  document.getElementById(`img${lastIdx}`).src = `https://royaleapi.github.io/cr-api-assets/cards/${id}.png`;
  document.getElementById(`e${lastIdx}`).innerText = card.e;
  document.getElementById(`p${lastIdx}`).style.display = "none";
  s.classList.add('filled');
  closeModal();
  tg.HapticFeedback.notificationOccurred('success');
}

function analyze() {
  if(deck.includes(null)) return tg.showAlert("–°–æ–±–µ—Ä–∏ –≤—Å–µ 8 –∫–∞—Ä—Ç, –∏–Ω–∞—á–µ –º–∞–≥–∏–∏ –Ω–µ –±—É–¥–µ—Ç!");

  const avg = (deck.reduce((a,b)=>a+b.e,0)/8).toFixed(1);
  const spells = deck.filter(c => c.t==='spell').length;
  const wins = deck.filter(c => c.t==='win' || c.t==='cancer').length;
  const mid = deck.filter(c => c.t==='mid' || c.e >= 7).length;
  const cancer = deck.filter(c => c.t==='cancer').length;
  const cycle = deck.filter(c => c.e <= 2).length;

  const random = (arr) => arr[Math.floor(Math.random() * arr.length)];
  let emoji, title, text;

  if (cancer > 0) {
    emoji = "‚ò£Ô∏è"; title = "–¢–û–ö–°–ò–ß–ù–ê–Ø –ü–û–ú–û–ô–ö–ê";
    text = random(["–ê—Ä–±–∞–ª–µ—Ç –∏–ª–∏ –ú–æ—Ä—Ç–∏—Ä–∞? –¢—ã –∏–∑ —Ç–µ—Ö –ª—é–¥–µ–π, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–∞–≤—è—Ç –∑–¥–∞–Ω–∏–µ –∏ –Ω–∞–¥–µ—é—Ç—Å—è, —á—Ç–æ —É –≤—Ä–∞–≥–∞ —Å–¥–∞–¥—É—Ç –Ω–µ—Ä–≤—ã. –°—Ö–æ–¥–∏ –ø–æ–º–æ–π—Å—è.","–¢–≤–æ—è –∫–æ–ª–æ–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç –∂–µ–ª–∞–Ω–∏–µ —É–¥–∞–ª–∏—Ç—å –∏–≥—Ä—É –¥–∞–∂–µ —É —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤. –£–∂–∞—Å–Ω–æ.","–ù–∞–¥–µ—é—Å—å, —Ç—ã —Å—Ç–∞–≤–∏—à—å —ç—Ç–æ —Ç–æ–ª—å–∫–æ –æ—Ç –±–µ–∑—ã—Å—Ö–æ–¥–Ω–æ—Å—Ç–∏. –ü—Ä–æ—Ç–∏–≤–Ω–æ —Å–º–æ—Ç—Ä–µ—Ç—å."]);
  } else if (mid >= 3 && avg > 4.4) {
    emoji = "ü§°"; title = "–ú–ï–ì–ê–†–´–¶–ê–†–¨ MOMENT";
    text = random([`–°—Ä. —ç–ª–∏–∫—Å–∏—Ä ${avg}? –¢–≤–æ–π IQ —è–≤–Ω–æ –Ω–∏–∂–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ —Ç–≤–æ–µ–π —Å–∞–º–æ–π —Ç—è–∂–µ–ª–æ–π –∫–∞—Ä—Ç—ã.`, `–ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—å –∏ –ü–ï–ö–ö–ê? –í —Ü–∏—Ä–∫–µ —Å–µ–≥–æ–¥–Ω—è –≤—ã—Ö–æ–¥–Ω–æ–π, —Ä–∞–∑ —Ç—ã —Ç—É—Ç –¥–µ–∫–∏ —Å–æ–±–∏—Ä–∞–µ—à—å?`, `–ï—Å–ª–∏ —Ç—ã –≤—ã–∏–≥—Ä–∞–µ—à—å —ç—Ç–∏–º, —Ç–æ —Ç–æ–ª—å–∫–æ –ø–æ—Ç–æ–º—É, —á—Ç–æ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫ —É–º–µ—Ä –æ—Ç —Å–º–µ—Ö–∞.`]);
  } else if (cycle >= 4 && avg < 2.9) {
    emoji = "üí¶"; title = "–ü–û–¢–ù–´–ô –ó–ê–î–†–û–¢";
    text = random(["2.6 –∏–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—Ö–æ–∂–µ–µ? –°–ø–æ—Ä–∏–º, —Ç—ã –Ω–∞–∂–∏–º–∞–µ—à—å –Ω–∞ —ç–∫—Ä–∞–Ω —á–∞—â–µ, —á–µ–º –¥—ã—à–∏—à—å? –†–∞—Å—Å–ª–∞–±—å—Å—è, —ç—Ç–æ –∏–≥—Ä–∞, –∞ –Ω–µ —Ñ–∏–Ω–∞–ª –ß–ú.","–°–∫–µ–ª–µ—Ç–∏–∫–∏, –¥—É—Ö–∏... –ö–∞–∫ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ (–Ω–µ—Ç). –¢–≤–æ–π —Å—Ç–∏–ª—å –∏–≥—Ä—ã –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º –∫–∞–∫ —É—Ç—Ä–æ.","–ü–æ–ø–µ–π –≤–æ–¥—ã, —Ç—ã —Å–ª–∏—à–∫–æ–º –ø–µ—Ä–µ–ø–æ—Ç–µ–ª, –ø–æ–∫–∞ —Å—Ç–∞–≤–∏–ª –ª–µ–¥—è–Ω–æ–≥–æ –¥—É—Ö–∞."]);
  } else if (wins === 0) {
    emoji = "üß±"; title = "–ë–ï–ó–î–ê–†–ù–´–ô –î–ï–§";
    text = "–í –¥–µ–∫–µ –Ω–æ–ª—å –≤–∏–Ω-–∫–æ–Ω–æ–≤. –ö–∞–∫ —Ç—ã —Å–æ–±—Ä–∞–ª—Å—è –ø–æ–±–µ–∂–¥–∞—Ç—å? –ú–æ–ª–∏—Ç–≤–∞–º–∏? –î–æ–±–∞–≤—å –•–æ–≥–∞, –Ω–µ –ø–æ–∑–æ—Ä—å—Å—è.";
  } else if (spells >= 2 && avg >= 3.0 && avg <= 3.9) {
    emoji = "üî•"; title = "–°–õ–ò–®–ö–û–ú –•–û–†–û–®–û";
    text = random(["–ò–¥–µ–∞–ª—å–Ω—ã–π –±–∏–ª–¥. –ü—Ä–∏–∑–Ω–∞–≤–∞–π—Å—è, —É –∫–æ–≥–æ —Å–ª–∏–∑–∞–ª? –°–∞–º –±—ã —Ç—ã –¥–æ —Ç–∞–∫–æ–≥–æ –Ω–µ –¥–æ–¥—É–º–∞–ª—Å—è.","–•–æ—Ä–æ—à–∞—è –¥–µ–∫–∞. –ù–∞—Å—Ç–æ–ª—å–∫–æ —Ö–æ—Ä–æ—à–∞—è, —á—Ç–æ —è —É–≤–µ—Ä–µ–Ω ‚Äî —Ç—ã –∫–æ–ø–∏–ø–∞—Å—Ç–µ—Ä —Å–æ —Å—Ç–∞–∂–µ–º.","–î–∞–∂–µ –ø—Ä–∏–¥—Ä–∞—Ç—å—Å—è —Å–ª–æ–∂–Ω–æ. –ò–¥–∏ –ª–æ–º–∞–π –±–∞—à–Ω–∏, –∫–∏–±–µ—Ä–∫–æ—Ç–ª–µ—Ç–∞."]);
  } else {
    emoji = "üßê"; title = "–ù–ò –†–´–ë–ê –ù–ò –ú–Ø–°–û";
    text = "–í—Ä–æ–¥–µ –∏ –Ω–µ –º—É—Å–æ—Ä, –Ω–æ –∏ –Ω–µ –∏–º–±–∞. –¢–∞–∫–∞—è –¥–µ–∫–∞ –æ–±—ã—á–Ω–æ –±—ã–≤–∞–µ—Ç —É —Ç–µ—Ö, –∫—Ç–æ –∑–∞—Å—Ç—Ä—è–ª –Ω–∞ 5000 –∫—É–±–∫–æ–≤ –∏ –≤–∏–Ω–∏—Ç –≤–æ –≤—Å–µ–º –ª–∞–≥–∏.";
  }

  document.getElementById('v-emoji').innerText = emoji;
  document.getElementById('v-title').innerText = title;
  document.getElementById('v-text').innerText = text;
  document.getElementById('res-grid').innerHTML = deck.map(c => `<img src="https://royaleapi.github.io/cr-api-assets/cards/${c.id}.png" style="width:100%">`).join('');
  document.getElementById('result').style.display = 'flex';
  tg.HapticFeedback.notificationOccurred('warning');
}
</script>
</body>
</html>
