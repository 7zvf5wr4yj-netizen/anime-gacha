<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>DECK ROASTER AI v3.0</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Inter:wght@300;600;800&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #00f2ff; --pink: #ff007a; --purple: #bc13fe; --gold: #ffcf00; --bg: #050505; }
    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; margin: 0; overflow: hidden; }
    
    .screen { height: 100vh; display: flex; flex-direction: column; background: radial-gradient(circle at top right, #1a0033, #050505); }
    
    /* Header */
    .header { padding: 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(10px); }
    .header h1 { font-family: 'Orbitron'; font-size: 18px; margin: 0; letter-spacing: 4px; color: var(--accent); text-shadow: 0 0 10px var(--accent); }

    /* Grid */
    .deck-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 20px; }
    .slot { aspect-ratio: 1/1.25; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; position: relative; display: flex; align-items: center; justify-content: center; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); overflow: hidden; }
    .slot.filled { border-color: var(--accent); background: rgba(0, 242, 255, 0.05); }
    .slot.evo { border-color: var(--purple); box-shadow: inset 0 0 15px rgba(188, 19, 254, 0.3); border-width: 2px; }
    .slot.evo::after { content: 'EVO'; position: absolute; top: 4px; right: 4px; font-size: 8px; font-weight: 900; background: var(--purple); padding: 2px 4px; border-radius: 4px; font-family: 'Orbitron'; }
    .slot img { width: 90%; height: 90%; object-fit: contain; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.5)); }
    .slot .plus { font-size: 30px; color: rgba(255,255,255,0.1); font-weight: 100; }

    /* Stats Pane */
    .stats-pane { padding: 0 25px; flex-grow: 1; }
    .stat-card { margin-bottom: 15px; }
    .stat-header { display: flex; justify-content: space-between; margin-bottom: 6px; font-size: 10px; font-family: 'Orbitron'; letter-spacing: 1px; color: #888; }
    .progress-track { height: 4px; background: rgba(255,255,255,0.05); border-radius: 10px; overflow: hidden; }
    .progress-fill { height: 100%; width: 0%; transition: width 1s ease-out; }

    /* Buttons */
    .btn-fire { margin: 20px; padding: 20px; border: none; border-radius: 16px; background: linear-gradient(90deg, var(--pink), #ff4d00); color: #fff; font-family: 'Orbitron'; font-weight: 900; font-size: 14px; cursor: pointer; box-shadow: 0 10px 20px rgba(255,0,122,0.3); transition: 0.3s; }
    .btn-fire:active { transform: scale(0.95); box-shadow: none; }

    /* Selection Modal */
    .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; display: none; flex-direction: column; animation: fadeIn 0.3s; }
    .search-bar { padding: 20px; background: #0a0a0a; }
    #search { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #333; background: #111; color: #fff; font-size: 16px; outline: none; }
    .card-list { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 15px; overflow-y: auto; }
    .card-thumb { background: rgba(255,255,255,0.03); border-radius: 12px; padding: 8px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
    .card-thumb img { width: 100%; border-radius: 8px; }
    .card-thumb span { display: block; font-size: 9px; margin-top: 5px; color: #aaa; white-space: nowrap; overflow: hidden; }

    /* Choice Overlay */
    .choice-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 2000; display: none; align-items: center; justify-content: center; flex-direction: column; padding: 30px; text-align: center; }
    .choice-card { width: 100%; max-width: 300px; background: #111; border: 1px solid #333; border-radius: 24px; padding: 25px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
    .choice-btn { width: 100%; padding: 18px; margin: 10px 0; border-radius: 14px; border: none; font-family: 'Orbitron'; font-weight: 900; cursor: pointer; transition: 0.2s; }

    /* Result */
    .result-screen { position: fixed; inset: 0; background: #000; z-index: 3000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 25px; }
    .roast-card { background: #0a0a0a; border: 1px solid var(--pink); border-radius: 30px; padding: 30px; width: 100%; text-align: center; position: relative; box-shadow: 0 0 40px rgba(255,0,122,0.15); }
    
    @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>

<div class="screen">
  <div class="header"><h1>DECK ROASTER AI</h1></div>
  
  <div class="deck-grid">
    <script>
      for(let i=0; i<8; i++) document.write(`<div class="slot" id="s${i}" onclick="openPicker(${i})"><div class="plus" id="p${i}">+</div><img id="img${i}" style="display:none"></div>`);
    </script>
  </div>

  <div class="stats-pane">
    <div class="stat-card">
      <div class="stat-header"><span>TOXIC LEVEL</span><span id="v-tox" style="color:var(--pink)">0%</span></div>
      <div class="progress-track"><div class="progress-fill" id="b-tox" style="background:var(--pink)"></div></div>
    </div>
    <div class="stat-card">
      <div class="stat-header"><span>SKILL DEFICIT</span><span id="v-skill" style="color:var(--accent)">0%</span></div>
      <div class="progress-track"><div class="progress-fill" id="b-skill" style="background:var(--accent)"></div></div>
    </div>
    <div class="stat-card">
      <div class="stat-header"><span>GIRLFRIEND PROBABILITY</span><span id="v-love">100%</span></div>
      <div class="progress-track"><div class="progress-fill" id="b-love" style="background:#fff; width:100%"></div></div>
    </div>
  </div>

  <button class="btn-fire" onclick="generateRoast()">–ü–†–û–í–ï–†–ò–¢–¨ –ö–û–õ–û–î–£</button>
</div>

<div id="choice-overlay" class="choice-overlay">
  <div class="choice-card">
    <h3 style="font-family:'Orbitron'; margin-bottom:20px;">–í–´–ë–ï–†–ò –°–¢–ê–¢–£–°</h3>
    <button class="choice-btn" style="background:#222; color:#fff;" onclick="finishSelection('norm')">–û–ë–´–ß–ù–ê–Ø</button>
    <button id="evo-btn" class="choice-btn" style="background:var(--purple); color:#fff; display:none;" onclick="finishSelection('evo')">–≠–í–û–õ–Æ–¶–ò–Ø</button>
    <button id="champ-btn" class="choice-btn" style="background:var(--gold); color:#000; display:none;" onclick="finishSelection('champ')">–ß–ï–ú–ü–ò–û–ù</button>
    <button style="background:none; border:none; color:#555; margin-top:15px;" onclick="document.getElementById('choice-overlay').style.display='none'">–û–¢–ú–ï–ù–ê</button>
  </div>
</div>

<div id="modal" class="modal">
  <div class="search-bar">
    <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ –∫–∞—Ä—Ç—ã..." oninput="drawCards()">
  </div>
  <div class="card-list" id="card-list"></div>
  <button style="padding:20px; background:none; border:none; color:var(--pink); font-family:'Orbitron';" onclick="closePicker()">–ó–ê–ö–†–´–¢–¨</button>
</div>

<div id="result" class="result-screen">
  <div id="capture-area" class="roast-card">
    <div id="res-emoji" style="font-size: 50px;"></div>
    <h2 id="res-title" style="font-family:'Orbitron'; color:var(--pink); margin: 15px 0;"></h2>
    <p id="res-text" style="font-size: 14px; line-height: 1.6; color: #ccc;"></p>
    <div id="res-grid" style="display:grid; grid-template-columns:repeat(4,1fr); gap:5px; margin-top:20px;"></div>
  </div>
  <button class="btn-fire" style="width:100%" onclick="save()">–°–û–•–†–ê–ù–ò–¢–¨ –†–ï–ó–£–õ–¨–¢–ê–¢</button>
  <button onclick="location.reload()" style="background:none; border:none; color:#555; margin-top:10px;">–ó–ê–ù–û–í–û</button>
</div>

<script>
const tg = window.Telegram.WebApp; tg.expand();

// –ë–ê–ó–ê –í–°–ï–• –ö–ê–†–¢ + –≠–í–û–õ–Æ–¶–ò–ô
const DB = [
  {n:"–ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—å",id:"mega-knight",evo:true,tox:40,sk:60},
  {n:"–ü.–ï.–ö.–ö.–ê.",id:"pekka",evo:true,tox:15,sk:15},
  {n:"–í—Å–∞–¥–Ω–∏–∫ –Ω–∞ –∫–∞–±–∞–Ω–µ",id:"hog-rider",evo:true,tox:30,sk:10},
  {n:"–≠–ª–∏—Ç–Ω—ã–µ –≤–∞—Ä–≤–∞—Ä—ã",id:"elite-barbarians",evo:true,tox:80,sk:70},
  {n:"–û–≥–Ω–µ–Ω–Ω–∞—è –ª—É—á–Ω–∏—Ü–∞",id:"firecracker",evo:true,tox:40,sk:10},
  {n:"–ì–æ–±–ª–∏–Ω—Å–∫–∞—è –±–æ—á–∫–∞",id:"goblin-barrel",evo:true,tox:45,sk:10},
  {n:"–ì–æ–±–ª–∏–Ω-–≥–∏–≥–∞–Ω—Ç",id:"goblin-giant",evo:true,tox:35,sk:15},
  {n:"–í–∞–ª—å–∫–∏—Ä–∏—è",id:"valkyrie",evo:true,tox:10,sk:10},
  {n:"–ö–æ–ª–¥—É–Ω",id:"wizard",evo:true,tox:10,sk:50},
  {n:"–¢–µ—Å–ª–∞",id:"tesla",evo:true,tox:25,sk:10},
  {n:"–ë–æ–µ–≤–æ–π —Ç–∞—Ä–∞–Ω",id:"battle-ram",evo:true,tox:10,sk:15},
  {n:"–ú–æ—Ä—Ç–∏—Ä–∞",id:"mortar",evo:true,tox:40,sk:25},
  {n:"–°–∫–µ–ª–µ—Ç—ã",id:"skeletons",evo:true,tox:5,sk:5},
  {n:"–ó–∞–ø–æ–∑–¥–∞–ª–∞—è –∫–ª–µ—Ç–∫–∞",id:"goblin-cage",evo:true,tox:15,sk:15},
  {n:"–í–∞—Ä–≤–∞—Ä—ã",id:"barbarians",evo:true,tox:10,sk:20},
  {n:"–ú—É—à–∫–µ—Ç—ë—Ä",id:"musketeer",evo:true,tox:5,sk:10},
  {n:"–ú–∞–ª–µ–Ω—å–∫–∏–π –ü—Ä–∏–Ω—Ü",id:"little-prince",champ:true,tox:30,sk:15},
  {n:"–ö–æ—Ä–æ–ª–µ–≤–∞ –ª—É—á–Ω–∏—Ü",id:"archer-queen",champ:true,tox:20,sk:20},
  {n:"–ì–æ–±–ª–∏–Ω—à—Ç–µ–π–Ω",id:"goblinstein",tox:40,sk:20},
  {n:"–ê—Ä–±–∞–ª–µ—Ç",id:"x-bow",tox:60,sk:40},
  {n:"–ó–∞–º–æ—Ä–æ–∑–∫–∞",id:"freeze",tox:90,sk:80},
  {n:"–°–ø–∞—Ä–∫–∏",id:"sparky",tox:60,sk:30},
  {n:"–®–∞—Ö—Ç—ë—Ä",id:"miner",tox:15,sk:30},
  {n:"–®–∞—Ä",id:"balloon",tox:35,sk:25},
  {n:"–≠–ª–µ–∫—Ç—Ä–æ–≥–∏–≥–∞–Ω—Ç",id:"electro-giant",tox:70,sk:40}
];

let deck = Array(8).fill(null);
let slotIdx = 0;
let temp = null;

function openPicker(i) { slotIdx = i; document.getElementById('modal').style.display = 'flex'; drawCards(); }
function closePicker() { document.getElementById('modal').style.display = 'none'; }

function drawCards() {
  const q = document.getElementById('search').value.toLowerCase();
  const list = document.getElementById('card-list');
  list.innerHTML = DB.filter(c => c.n.toLowerCase().includes(q)).map(c => `
    <div class="card-thumb" onclick="pickCard('${c.n}')">
      <img src="https://royaleapi.com/static/img/cards-150/${c.id}.png">
      <span>${c.n}</span>
    </div>
  `).join('');
}

function pickCard(name) {
  if(deck.some(d => d && d.n === name)) return tg.showAlert("–≠—Ç–∞ –∫–∞—Ä—Ç–∞ —É–∂–µ –≤ –¥–µ–∫–µ!");
  temp = DB.find(x => x.n === name);
  document.getElementById('modal').style.display = 'none';
  document.getElementById('choice-overlay').style.display = 'flex';
  document.getElementById('evo-btn').style.display = temp.evo ? 'block' : 'none';
  document.getElementById('champ-btn').style.display = temp.champ ? 'block' : 'none';
}

function finishSelection(type) {
  let card = {...temp, mode: type};
  deck[slotIdx] = card;
  
  const s = document.getElementById(`s${slotIdx}`);
  const img = document.getElementById(`img${slotIdx}`);
  
  s.className = `slot filled ${type}`;
  img.src = `https://royaleapi.com/static/img/cards-150/${card.id}${type==='evo'?'-ev1':''}.png`;
  img.style.display = 'block';
  document.getElementById(`p${slotIdx}`).style.display = 'none';
  
  document.getElementById('choice-overlay').style.display = 'none';
  updateBars();
}

function updateBars() {
  const d = deck.filter(x => x);
  const tox = d.reduce((a,b) => a + (b.mode==='evo'?b.tox+25:b.tox), 0) / 2;
  const sk = d.reduce((a,b) => a + b.sk, 0) / 2;
  
  document.getElementById('b-tox').style.width = Math.min(100, tox) + '%';
  document.getElementById('v-tox').innerText = Math.round(tox) + '%';
  document.getElementById('b-skill').style.width = Math.min(100, sk) + '%';
  document.getElementById('v-skill').innerText = Math.round(sk) + '%';
  document.getElementById('b-love').style.width = Math.max(0, 100 - (tox+sk)/2.5) + '%';
}

function generateRoast() {
  if(deck.includes(null)) return tg.showAlert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ 8 —Å–ª–æ—Ç–æ–≤!");
  
  const names = deck.map(d => d.n);
  const modes = deck.map(d => d.mode);
  let t, e, txt;

  if(modes.filter(m => m === 'evo').length >= 2) {
    t = "–î–í–û–ô–ù–û–ô –ö–ê–ë–õ–£–ö"; e = "ü§°ü§°";
    txt = "–î–≤–µ —ç–≤–æ–ª—é—Ü–∏–∏? –¢—ã –±—É–∫–≤–∞–ª—å–Ω–æ –∫—Ä–∏—á–∏—à—å: '–£ –ú–ï–ù–Ø –ù–ï–¢ –†–£–ö, –ù–û –ï–°–¢–¨ –ú–ê–ú–ò–ù–ê –ö–ê–†–¢–ê!'. –¢–≤–æ–π –≥–µ–π–º–ø–ª–µ–π –Ω–∞—Å—Ç–æ–ª—å–∫–æ –∑–∞–≤–∏—Å–∏–º –æ—Ç —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã—Ö –∫–Ω–æ–ø–æ–∫, —á—Ç–æ –±–µ–∑ –Ω–∏—Ö —Ç—ã –Ω–µ —Å–º–æ–∂–µ—à—å –ø–æ–±–µ–¥–∏—Ç—å –¥–∞–∂–µ –±–æ—Ç–∞.";
  } else if(names.includes("–ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—å") && modes.includes("evo")) {
    t = "–≠–í–û-–®–ò–ó–û–§–†–ï–ù–ò–ö"; e = "ü¶†";
    txt = "–≠–≤–æ–ª—é—Ü–∏—è –ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—è? –°–µ—Ä—å–µ–∑–Ω–æ? –¢—ã –≤–∑—è–ª —Å–∞–º—É—é –≥–µ–π—Å–∫—É—é –∫–∞—Ä—Ç—É –≤ –∏–≥—Ä–µ –∏ —Å–¥–µ–ª–∞–ª –µ—ë –µ—â–µ –±–æ–ª–µ–µ –≥–µ–π—Å–∫–æ–π. –¢–≤–æ–π –±–∞—Ç—è —É—à–µ–ª –∑–∞ —Ö–ª–µ–±–æ–º —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ —É–≤–∏–¥–µ–ª —Ç–≤–æ–π —Ä–µ–ø–ª–µ–π.";
  } else if(names.includes("–ê—Ä–±–∞–ª–µ—Ç") || names.includes("–ú–æ—Ä—Ç–∏—Ä–∞")) {
    t = "–û–ë–ò–ñ–ï–ù–ù–´–ô –û–°–ê–î–ù–ò–ö"; e = "üè∞";
    txt = "–°—Ç–∞–≤–∏—à—å –ø–∞–ª–∫—É —É —Ä–µ–∫–∏ –∏ –∑–∞—â–∏—â–∞–µ—à—å –µ—ë –≤—Å–µ–π –∂–∏–∑–Ω—å—é? –¢—ã –∏ –≤ –∂–∏–∑–Ω–∏ —Ç–∞–∫–æ–π –∂–µ ‚Äî —Å–∏–¥–∏—à—å –≤ —É–≥–ª—É –∏ –±–æ–∏—à—å—Å—è —á–µ—Å—Ç–Ω–æ–≥–æ –±–æ—è. –ù–∏–∫—Ç–æ –Ω–µ –ª—é–±–∏—Ç —Ç–µ–±—è, –¥–∞–∂–µ —Ç–≤–æ—è —Å–æ–±–∞–∫–∞.";
  } else if(names.includes("–≠–ª–∏—Ç–Ω—ã–µ –≤–∞—Ä–≤–∞—Ä—ã") && names.includes("–Ø—Ä–æ—Å—Ç—å")) {
    t = "–ü–û–ú–û–ô–ù–´–ô –°–ü–ê–ú–ï–†"; e = "ü§Æ";
    txt = "–≠–ª–∏—Ç–∫–∏ –ø–æ–¥ —Ä–µ–π–¥–∂–µ–º –Ω–∞ –º–æ—Å—Ç. –¢–≤–æ–π IQ —Ä–∞–≤–µ–Ω –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Ç–≤–æ–∏—Ö –∏–∑–≤–∏–ª–∏–Ω (–æ–¥–Ω–∞, –∏ —Ç–∞ –æ—Ç –∫–µ–ø–∫–∏). –≠—Ç–æ –Ω–µ –∫–æ–ª–æ–¥–∞, —ç—Ç–æ –∫—Ä–∏–∫ –æ –ø–æ–º–æ—â–∏.";
  } else {
    t = "–¢–ò–ü–ò–ß–ù–´–ô –ù–£–ë"; e = "üí©";
    txt = "–ù–∏–∫–∞–∫–æ–π —Å–∏–Ω–µ—Ä–≥–∏–∏. –ü—Ä–æ—Å—Ç–æ –Ω–∞–∫–∏–¥–∞–ª –∫–∞—Ä—Ç, –∫–æ—Ç–æ—Ä—ã–µ –±–ª–µ—Å—Ç—è—Ç. –¢–≤–æ–π –º–æ–∑–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ä–µ–∂–∏–º–µ —ç–Ω–µ—Ä–≥–æ—Å–±–µ—Ä–µ–∂–µ–Ω–∏—è, –∫–æ–≥–¥–∞ —Ç—ã –∑–∞—Ö–æ–¥–∏—à—å –≤ –∏–≥—Ä—É.";
  }

  document.getElementById('res-title').innerText = t;
  document.getElementById('res-emoji').innerText = e;
  document.getElementById('res-text').innerText = txt;
  document.getElementById('res-grid').innerHTML = deck.map(x => `<img src="https://royaleapi.com/static/img/cards-150/${x.id}${x.mode==='evo'?'-ev1':''}.png" class="${x.mode}">`).join('');
  document.getElementById('result').style.display = 'flex';
  tg.HapticFeedback.notificationOccurred('success');
}

function save() {
  html2canvas(document.getElementById('capture-area')).then(canvas => {
    const a = document.createElement('a'); a.download='roast.png'; a.href=canvas.toDataURL(); a.click();
    tg.showAlert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!");
  });
}
</script>
</body>
</html>
