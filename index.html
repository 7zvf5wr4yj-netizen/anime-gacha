<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Clash RNG: Deck rater</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --cr-blue: #0072ff;
      --cr-dark-blue: #003c8b;
      --cr-gold: #ffcc00;
      --cr-rarity-legendary: linear-gradient(135deg, #00f3ff, #bc13fe);
    }

    body {
      background: #1a1a1a;
      background-image: radial-gradient(circle at center, #2a2a2a 0%, #1a1a1a 100%);
      color: #fff; font-family: 'Rubik', sans-serif;
      margin: 0; padding: 0; height: 100vh; overflow: hidden;
    }

    /* –®–ê–ü–ö–ê */
    .header {
      background: linear-gradient(180deg, var(--cr-blue) 0%, var(--cr-dark-blue) 100%);
      padding: 15px; text-align: center; border-bottom: 4px solid #000;
      box-shadow: 0 4px 10px rgba(0,0,0,0.5);
    }

    /* –°–ï–¢–ö–ê –ö–û–õ–û–î–´ (8 –°–õ–û–¢–û–í) */
    .deck-grid {
      display: grid; grid-template-columns: repeat(4, 1fr);
      gap: 8px; padding: 15px; background: rgba(0,0,0,0.3);
      margin: 10px; border-radius: 12px; border: 2px solid #444;
    }

    .slot {
      aspect-ratio: 3/4; background: #333; border-radius: 8px;
      border: 2px dashed #555; display: flex; align-items: center;
      justify-content: center; font-size: 24px; position: relative;
      overflow: hidden;
    }

    .slot.filled { border: 2px solid #fff; background: #444; }

    .card-img { width: 100%; height: 100%; object-fit: cover; }
    
    .elixir-tag {
      position: absolute; top: 2px; left: 2px;
      background: #ff00ff; border-radius: 50%; width: 18px; height: 18px;
      font-size: 10px; display: flex; align-items: center; justify-content: center;
      border: 1px solid #fff; z-index: 2;
    }

    /* –ü–ê–ù–ï–õ–¨ –ü–†–ò–ó–´–í–ê */
    .summon-zone {
      flex-grow: 1; display: flex; flex-direction: column;
      align-items: center; justify-content: center;
    }

    .roll-btn {
      background: #ff8000;
      background: linear-gradient(180deg, #ffb347 0%, #ff8c00 100%);
      border: none; border-bottom: 5px solid #b36200;
      color: #fff; padding: 15px 40px; border-radius: 12px;
      font-size: 24px; font-weight: 900; cursor: pointer;
      text-shadow: 2px 2px #000;
    }

    .rate-btn {
      background: #4caf50; border: none; border-bottom: 5px solid #2e7d32;
      color: #fff; padding: 10px 20px; border-radius: 8px;
      margin-top: 10px; font-weight: bold;
    }

    /* –ü–û–ü–ê–ü –û–¶–ï–ù–ö–ò */
    .rating-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(0,0,0,0.9); display: none;
      flex-direction: column; align-items: center; justify-content: center;
      z-index: 100; text-align: center; padding: 20px; box-sizing: border-box;
    }

    .score { font-size: 80px; color: var(--cr-gold); margin: 0; }
  </style>
</head>
<body>

  <div class="header">
    <div style="font-size: 20px; text-transform: uppercase;">–û—Ü–µ–Ω–∏ –ö–æ–ª–æ–¥—É</div>
    <div style="font-size: 12px; opacity: 0.8;">–°—Ä–µ–¥–Ω–∏–π —ç–ª–∏–∫—Å–∏—Ä: <span id="avg-elixir">0.0</span> üíß</div>
  </div>

  <div class="deck-grid" id="deck">
    <div class="slot" id="s0"></div>
    <div class="slot" id="s1"></div>
    <div class="slot" id="s2"></div>
    <div class="slot" id="s3"></div>
    <div class="slot" id="s4"></div>
    <div class="slot" id="s5"></div>
    <div class="slot" id="s6"></div>
    <div class="slot" id="s7"></div>
  </div>

  <div class="summon-zone">
    <div id="last-rolled" style="margin-bottom: 20px; font-size: 18px; height: 30px;"></div>
    <button class="roll-btn" onclick="rollCard()">–ö–†–£–¢–ò–¢–¨ –ö–ê–†–¢–£</button>
    <button class="rate-btn" onclick="rateDeck()">–û–¶–ï–ù–ò–¢–¨ –ú–û–ô –ü–ò–ö</button>
  </div>

  <div id="rating-screen" class="rating-overlay">
    <h2 id="rating-verdict">–ê–ù–ê–õ–ò–ó...</h2>
    <p class="score" id="rating-score">A+</p>
    <p id="rating-comment" style="font-style: italic; color: #ccc;"></p>
    <button class="roll-btn" style="margin-top: 30px;" onclick="closeRating()">OK</button>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const CARDS = [
      { n: "–°–∫–µ–ª–µ—Ç—ã", e: 1, r: "Common", t: "Swarms" },
      { n: "–í—Å–∞–¥–Ω–∏–∫ –Ω–∞ –∫–∞–±–∞–Ω–µ", e: 4, r: "Rare", t: "WinCon" },
      { n: "–ü.–ï.–ö.–ö.–ê", e: 7, r: "Epic", t: "Tank" },
      { n: "–ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—å", e: 7, r: "Legendary", t: "Splash" },
      { n: "–ë—Ä–µ–≤–Ω–æ–º", e: 2, r: "Legendary", t: "Spell" },
      { n: "–û–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä", e: 4, r: "Rare", t: "Spell" },
      { n: "–ü—Ä–∏–Ω—Ü–µ—Å—Å–∞", e: 3, r: "Legendary", t: "Ranged" },
      { n: "–ê–¥—Å–∫–∞—è –±–∞—à–Ω—è", e: 5, r: "Rare", t: "Building" },
      { n: "–ú–∞–ª–µ–Ω—å–∫–∏–π –¥—Ä–∞–∫–æ–Ω", e: 4, r: "Epic", t: "Splash" },
      { n: "–ì–æ–±–ª–∏–Ω—Å–∫–∞—è –±–æ—á–∫–∞", e: 3, r: "Epic", t: "WinCon" }
    ];

    let myDeck = [null, null, null, null, null, null, null, null];
    let slotIndex = 0;

    function rollCard() {
      const card = CARDS[Math.floor(Math.random() * CARDS.length)];
      document.getElementById('last-rolled').innerText = `–í—ã–ø–∞–ª: ${card.n} (${card.e}üíß)`;
      
      // –ó–∞–ø–æ–ª–Ω—è–µ–º —Å–ª–æ—Ç—ã –ø–æ –æ—á–µ—Ä–µ–¥–∏
      myDeck[slotIndex] = card;
      const slot = document.getElementById(`s${slotIndex}`);
      slot.innerHTML = `<div class="elixir-tag">${card.e}</div><div style="font-size:10px; padding:5px; text-align:center">${card.n}</div>`;
      slot.className = "slot filled";
      
      slotIndex = (slotIndex + 1) % 8;
      
      tg.HapticFeedback.impactOccurred('medium');
      calcElixir();
    }

    function calcElixir() {
      const filled = myDeck.filter(c => c !== null);
      if(filled.length === 0) return;
      const sum = filled.reduce((a, b) => a + b.e, 0);
      document.getElementById('avg-elixir').innerText = (sum / filled.length).toFixed(1);
    }

    function rateDeck() {
      if(myDeck.includes(null)) return tg.showAlert("–°–æ–±–µ—Ä–∏ –ø–æ–ª–Ω—É—é –∫–æ–ª–æ–¥—É (8 –∫–∞—Ä—Ç)!");

      const filled = myDeck;
      let score = "B";
      let comment = "";

      const hasSpell = filled.some(c => c.t === "Spell");
      const hasTank = filled.some(c => c.t === "Tank" || c.e >= 6);
      const hasWinCon = filled.some(c => c.t === "WinCon");
      const avg = filled.reduce((a,b) => a+b.e,0) / 8;

      if (hasSpell && hasWinCon && hasTank) { score = "S"; comment = "–ò–¥–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å! –° —ç—Ç–æ–π –∫–æ–ª–æ–¥–æ–π –º–æ–∂–Ω–æ –±—Ä–∞—Ç—å –¢–æ–ø-1 –º–∏—Ä–∞."; }
      else if (hasSpell && hasWinCon) { score = "A"; comment = "–•–æ—Ä–æ—à–∞—è –∫–æ–ª–æ–¥–∞, –Ω–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –∂–∏—Ä–Ω–æ–≥–æ —Ç–∞–Ω–∫–∞."; }
      else if (avg > 4.5) { score = "D"; comment = "–°–ª–∏—à–∫–æ–º –¥–æ—Ä–æ–≥–æ! –¢—ã –Ω–µ —É—Å–ø–µ–µ—à—å –≤—ã—Å—Ç–∞–≤–∏—Ç—å –∫–∞—Ä—Ç—ã, –∫–∞–∫ —Ç–µ–±—è —Å–Ω–µ—Å—É—Ç."; }
      else { score = "C"; comment = "–ö–æ–ª–æ–¥–∞ —Å—Ç—Ä–∞–Ω–Ω–∞—è. –ù–µ—Ç —É—Å–ª–æ–≤–∏–π –¥–ª—è –ø–æ–±–µ–¥—ã –∏–ª–∏ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏–π."; }

      document.getElementById('rating-score').innerText = score;
      document.getElementById('rating-comment').innerText = comment;
      document.getElementById('rating-screen').style.display = "flex";
      tg.HapticFeedback.notificationOccurred('success');
    }

    function closeRating() {
      document.getElementById('rating-screen').style.display = "none";
    }
  </script>
</body>
</html>
