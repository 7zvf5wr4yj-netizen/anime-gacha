<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Anime RNG: Evolution</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #05050a;
      --cyber-purple: #7000ff;
      --cyber-pink: #ff007a;
      --cyber-cyan: #00f3ff;
      --glass: rgba(20, 20, 35, 0.95);
    }

    body {
      background: #000; color: #fff; font-family: 'Rajdhani', sans-serif;
      margin: 0; padding: 0; height: 100vh; overflow: hidden;
    }

    /* –§–û–ù–û–í–ê–Ø –°–ï–¢–ö–ê */
    .grid-bg {
      position: fixed; width: 200%; height: 200%;
      background-image: linear-gradient(rgba(112, 0, 255, 0.1) 1px, transparent 1px),
                        linear-gradient(90deg, rgba(112, 0, 255, 0.1) 1px, transparent 1px);
      background-size: 50px 50px; transform: perspective(500px) rotateX(60deg);
      top: -50%; left: -50%; z-index: -1; animation: move 20s linear infinite;
    }
    @keyframes move { from { transform: perspective(500px) rotateX(60deg) translateY(0); } to { transform: perspective(500px) rotateX(60deg) translateY(50px); } }

    /* –≠–ö–†–ê–ù–´ */
    .screen {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: var(--bg); display: none; flex-direction: column;
      padding: 20px; box-sizing: border-box; overflow-y: auto; z-index: 10;
    }
    .screen.active { display: flex; }
    .screen-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .back-btn { background: var(--cyber-pink); border: none; color: #fff; padding: 5px 15px; border-radius: 5px; font-family: 'Orbitron'; cursor: pointer; }

    /* –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ */
    .main-menu {
      display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;
    }
    .menu-card {
      background: var(--glass); border: 1px solid var(--cyber-purple);
      padding: 20px; border-radius: 15px; text-align: center;
      box-shadow: 0 0 10px rgba(112, 0, 255, 0.2);
      cursor: pointer; transition: 0.3s;
    }
    .menu-card:active { transform: scale(0.95); background: var(--cyber-purple); }
    .menu-card i { display: block; font-size: 24px; margin-bottom: 10px; }
    .menu-card span { font-family: 'Orbitron'; font-size: 12px; letter-spacing: 1px; }
    .full-width { grid-column: span 2; background: linear-gradient(90deg, var(--cyber-purple), var(--cyber-pink)); }

    /* –ü–†–û–§–ò–õ–¨ */
    .profile-img { width: 80px; height: 80px; border-radius: 50%; border: 2px solid var(--cyber-cyan); margin-bottom: 10px; }
    .input-field { background: #111; border: 1px solid #333; color: #fff; padding: 10px; width: 100%; margin: 5px 0; border-radius: 5px; }

    /* –ò–ù–í–ï–ù–¢–ê–†–¨ */
    .inv-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .inv-item { background: #111; padding: 10px; border-radius: 5px; font-size: 10px; text-align: center; border: 1px solid #333; }

    /* –¶–í–ï–¢–ê –†–ï–î–ö–û–°–¢–ï–ô */
    .rare-COMMON { color: #888; }
    .rare-EPIC { color: var(--cyber-cyan); text-shadow: 0 0 5px var(--cyber-cyan); }
    .rare-GODLY { color: var(--cyber-pink); text-shadow: 0 0 10px var(--cyber-pink); animation: pulse 1s infinite alternate; }
    @keyframes pulse { from { opacity: 0.5; } to { opacity: 1; } }

    /* –ü–†–ò–ó–´–í (–¢–í–û–ô –°–¢–ò–õ–¨) */
    .roll-display { flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; }
    .hero-name { font-family: 'Orbitron'; font-size: 32px; text-align: center; margin: 20px 0; }
    .shake { animation: shake 0.1s infinite; }
    @keyframes shake { 0% { transform: translate(2px, 2px); } 50% { transform: translate(-2px, -2px); } 100% { transform: translate(2px, -2px); } }
  </style>
</head>
<body>
  <div class="grid-bg"></div>

  <div id="screen-main" class="screen active" style="background: transparent;">
    <div class="screen-header">
      <div style="font-family: 'Orbitron';">üíé <span id="m-dmd">0</span></div>
      <div style="font-family: 'Orbitron';">‚ö° <span id="m-pwr">0</span></div>
    </div>
    
    <div style="text-align: center; margin: 20px 0;">
      <h1 style="font-family: 'Orbitron'; margin: 0; color: var(--cyber-cyan);">ANIME RNG</h1>
      <p style="font-size: 12px; color: #888;">EVOLUTION v3.0</p>
    </div>

    <div class="main-menu">
      <div class="menu-card full-width" onclick="showScreen('screen-roll')"><span>üîÆ –ü–†–ò–ó–´–í</span></div>
      <div class="menu-card" onclick="showScreen('screen-inv')"><span>üéí –ò–ù–í–ï–ù–¢–ê–†–¨</span></div>
      <div class="menu-card" onclick="showScreen('screen-pvp')"><span>‚öîÔ∏è –ü–í–ü –ê–†–ï–ù–ê</span></div>
      <div class="menu-card" onclick="showScreen('screen-profile')"><span>üë§ –ü–†–û–§–ò–õ–¨</span></div>
      <div class="menu-card" onclick="showScreen('screen-fusion')"><span>üß¨ –°–õ–ò–Ø–ù–ò–ï</span></div>
      <div class="menu-card" onclick="showScreen('screen-clan')"><span>üõ°Ô∏è –ö–õ–ê–ù</span></div>
      <div class="menu-card" onclick="showScreen('screen-shop')"><span>üõçÔ∏è –ú–ê–ì–ê–ó–ò–ù</span></div>
      <div class="menu-card" onclick="tg.showAlert('–†–µ–π—Ç–∏–Ω–≥ –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ 2 —á–∞—Å–∞')"><span>üèÜ –†–ï–ô–¢–ò–ù–ì</span></div>
    </div>
  </div>

  <div id="screen-roll" class="screen">
    <div class="screen-header">
      <button class="back-btn" onclick="showScreen('screen-main')">‚Üê –ú–ï–ù–Æ</button>
      <div id="roll-diamonds">1000</div>
    </div>
    <div class="roll-display">
      <div id="roll-status" style="color: var(--cyber-pink); font-family: 'Orbitron';">READY</div>
      <div id="roll-name" class="hero-name">? ? ?</div>
      <button class="menu-card full-width" style="border:none;" onclick="startRoll()">SUMMON (10 üíé)</button>
    </div>
  </div>

  <div id="screen-profile" class="screen">
    <div class="screen-header"><button class="back-btn" onclick="showScreen('screen-main')">‚Üê</button></div>
    <center>
      <div class="profile-img"></div>
      <h2 id="p-name" style="font-family:'Orbitron';">Player</h2>
      <p id="p-rank" style="color: var(--cyber-cyan);">–ù–æ–≤–∏—á–æ–∫</p>
    </center>
    <div style="margin-top: 20px;">
      <label>–ù–ò–ö–ù–ï–ô–ú</label>
      <input id="edit-name" class="input-field" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è..." onchange="updateProfile()">
      <label>–û –°–ï–ë–ï</label>
      <input id="edit-bio" class="input-field" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ..." onchange="updateProfile()">
    </div>
    <div style="margin-top: 20px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
      <p>–í—Å–µ–≥–æ –ø—Ä–∏–∑—ã–≤–æ–≤: <span id="stat-rolls">0</span></p>
      <p>–ü–æ–±–µ–¥ –≤ –ü–í–ü: <span id="stat-wins">0</span></p>
    </div>
  </div>

  <div id="screen-inv" class="screen">
    <div class="screen-header"><button class="back-btn" onclick="showScreen('screen-main')">‚Üê</button> –ò–ù–í–ï–ù–¢–ê–†–¨</div>
    <div class="inv-grid" id="inv-container"></div>
  </div>

  <div id="screen-shop" class="screen">
    <div class="screen-header"><button class="back-btn" onclick="showScreen('screen-main')">‚Üê</button> –ú–ê–ì–ê–ó–ò–ù</div>
    <div class="menu-card full-width" onclick="buyTix()">5 –¢–ò–ö–ï–¢–û–í –ü–í–ü = 500 üíé</div>
    <div class="menu-card full-width" onclick="tg.showAlert('–î–æ–Ω–∞—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω')">–ö–£–ü–ò–¢–¨ 10,000 üíé</div>
  </div>

  <div id="screen-fusion" class="screen">
    <div class="screen-header"><button class="back-btn" onclick="showScreen('screen-main')">‚Üê</button> –°–õ–ò–Ø–ù–ò–ï</div>
    <p style="font-size: 12px; color: #888;">–°–∂–µ—á—å –≤—Å–µ—Ö COMMON –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å +5% –∫ –æ–±—â–µ–π —Å–∏–ª–µ?</p>
    <button class="menu-card full-width" onclick="doFusion()">–í–´–ü–û–õ–ù–ò–¢–¨ –°–õ–ò–Ø–ù–ò–ï</button>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // –ë–ê–ó–ê
    const ROSTER = [
      { n: "–Æ–∫–∏—Ö–∏—Ä–∞ –°–æ–º–∞", s: "Food Wars", c: 5, r: "COMMON", p: 50 },
      { n: "–ö—É—Ä–æ—Å–∞–∫–∏ –ò—á–∏–≥–æ", s: "Bleach", c: 50, r: "EPIC", p: 500 },
      { n: "–°–∏–Ω–¥–∑–∏ –ò–∫–∞—Ä–∏", s: "Evangelion", c: 200, r: "EPIC", p: 1200 },
      { n: "–ó–∞—Ä–∞–∫–∏ –ö–µ–Ω–ø–∞—á–∏", s: "Bleach", c: 1000, r: "EPIC", p: 4000 },
      { n: "–ï–≤–∞-01", s: "Evangelion", c: 50000, r: "GODLY", p: 25000 }
    ];

    let state = JSON.parse(localStorage.getItem('anime_v7')) || {
      dmd: 1000, pwr: 0, tix: 5, inv: [], name: "User", bio: "Bio", rolls: 0, wins: 0
    };

    function save() { localStorage.setItem('anime_v7', JSON.stringify(state)); updateUI(); }

    function updateUI() {
      document.getElementById('m-dmd').innerText = state.dmd.toLocaleString();
      document.getElementById('m-pwr').innerText = state.pwr.toLocaleString();
      document.getElementById('roll-diamonds').innerText = state.dmd;
      document.getElementById('p-name').innerText = state.name;
      document.getElementById('stat-rolls').innerText = state.rolls;
      document.getElementById('stat-wins').innerText = state.wins;
      
      // –ó–≤–∞–Ω–∏—è
      let rank = "–ù–æ–≤–∏—á–æ–∫";
      if(state.pwr > 5000) rank = "–û–ø—ã—Ç–Ω—ã–π";
      if(state.pwr > 50000) rank = "–ú–∞—Å—Ç–µ—Ä";
      if(state.pwr > 500000) rank = "–õ–ï–ì–ï–ù–î–ê";
      document.getElementById('p-rank').innerText = rank;

      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
      const invCont = document.getElementById('inv-container');
      invCont.innerHTML = '';
      state.inv.slice(-12).forEach(item => {
        const div = document.createElement('div');
        div.className = 'inv-item';
        div.innerHTML = `<span class="rare-${item.r}">${item.n}</span><br>+${item.p}`;
        invCont.appendChild(div);
      });
    }

    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    async function startRoll() {
      if(state.dmd < 10) return tg.showAlert("–ù—É–∂–Ω–æ 10 üíé");
      state.dmd -= 10; state.rolls++;
      
      const nameEl = document.getElementById('roll-name');
      const statusEl = document.getElementById('roll-status');
      
      document.getElementById('screen-roll').classList.add('shake');
      
      let rolled = ROSTER[0];
      for(let i=0; i<15; i++) {
        nameEl.innerText = "1 : " + Math.floor(Math.random()*1000);
        await new Promise(r => setTimeout(r, 70));
        tg.HapticFeedback.impactOccurred('light');
      }

      for(let h of [...ROSTER].reverse()) {
        if(Math.random() < (1/h.c)) { rolled = h; break; }
      }

      document.getElementById('screen-roll').classList.remove('shake');
      nameEl.innerText = rolled.n;
      nameEl.className = `hero-name rare-${rolled.r}`;
      statusEl.innerText = `LUCK 1:${rolled.c}`;
      
      state.inv.push(rolled);
      state.pwr += rolled.p;
      save();
    }

    function updateProfile() {
      state.name = document.getElementById('edit-name').value || state.name;
      state.bio = document.getElementById('edit-bio').value || state.bio;
      save();
    }

    function buyTix() {
      if(state.dmd >= 500) { state.dmd -= 500; state.tix += 5; save(); tg.showAlert("–ö—É–ø–ª–µ–Ω–æ!"); }
    }

    function doFusion() {
      const startCount = state.inv.length;
      state.inv = state.inv.filter(h => h.r !== 'COMMON');
      if(state.inv.length < startCount) {
        state.pwr = Math.floor(state.pwr * 1.05);
        save();
        tg.showAlert("–°–ª–∏—è–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ! –°–∏–ª–∞ +5%");
      } else {
        tg.showAlert("–ù–µ—Ç –æ–±—ã—á–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –¥–ª—è —Å–∂–∏–≥–∞–Ω–∏—è.");
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.getElementById('edit-name').value = state.name;
    document.getElementById('edit-bio').value = state.bio;
    updateUI();
  </script>
</body>
</html>
