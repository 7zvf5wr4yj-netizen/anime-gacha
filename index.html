diff --git a/index.html b/index.html
index 988791cd3ae21a6d7ddf17b58c515421c5e8c7dc..6d92c50c58fe8f4d37cb01858a826fcc2b41c342 100644
--- a/index.html
+++ b/index.html
@@ -1,182 +1,385 @@
 <!DOCTYPE html>
 <html lang="ru">
 <head>
-<meta charset="UTF-8">
-<meta name="viewport" content="width=device-width, initial-scale=1.0">
-<title>Anime Gacha Empire</title>
-
-<script src="https://telegram.org/js/telegram-web-app.js"></script>
-
-<style>
-body {
-  margin: 0;
-  font-family: Arial, sans-serif;
-  background: #0f172a;
-  color: white;
-  text-align: center;
-}
-
-button {
-  padding: 10px 20px;
-  margin: 10px;
-  border: none;
-  border-radius: 8px;
-  cursor: pointer;
-  font-weight: bold;
-  background: #2563eb;
-  color: white;
-}
-.card {
-  background: #1e293b;
-  padding: 15px;
-  margin: 10px;
-  border-radius: 10px;
-}
-</style>
+  <meta charset="UTF-8" />
+  <meta name="viewport" content="width=device-width,initial-scale=1" />
+  <title>Anime Gacha Empire</title>
+  <style>
+    :root {
+      --bg:#070b1f;
+      --panel:#121a3dcc;
+      --panel2:#1b2757e0;
+      --text:#eef3ff;
+      --muted:#9cb0e4;
+      --line:#9fb5ff33;
+      --primary:#5b6cff;
+      --primary2:#00b8ff;
+      --ok:#19c37d;
+      --warn:#ffb020;
+      --bad:#ff5a7a;
+    }
+    *{box-sizing:border-box}
+    body{
+      margin:0;
+      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
+      color:var(--text);
+      background:
+        radial-gradient(circle at 10% -10%,#263b9d 0%,transparent 32%),
+        radial-gradient(circle at 100% 0%,#69218a 0%,transparent 28%),
+        radial-gradient(circle at 50% 120%,#0f5f80 0%,transparent 32%),
+        var(--bg);
+      min-height:100vh;
+    }
+    .app{width:min(1080px,100% - 20px);margin:14px auto;display:grid;grid-template-columns:290px 1fr;gap:12px}
+    .panel{background:var(--panel);border:1px solid var(--line);border-radius:16px;backdrop-filter:blur(8px)}
+    .side{padding:12px;display:flex;flex-direction:column;gap:10px;height:fit-content;position:sticky;top:12px}
+    .brand{padding:10px;border-radius:12px;background:linear-gradient(130deg,#5b6cff66,#00b8ff33);border:1px solid #b7ccff44}
+    .brand h1{margin:0;font-size:20px}
+    .brand p{margin:6px 0 0;color:var(--muted);font-size:12px}
+    .profile-mini{display:flex;gap:10px;align-items:center;padding:8px;border-radius:12px;background:#ffffff08;border:1px solid #ffffff1f}
+    .avatar{width:52px;height:52px;border-radius:12px;object-fit:cover;border:1px solid #ffffff4a;background:linear-gradient(130deg,#4961ce,#2d8fcb)}
+    .stats{display:grid;gap:8px}
+    .stat{display:flex;justify-content:space-between;padding:8px;border-radius:10px;background:#ffffff08;color:var(--muted);font-size:13px}
+    .stat b{color:var(--text)}
+    .nav{display:grid;gap:7px}
+    .nav button{border:1px solid #ffffff26;background:#ffffff0d;color:#eaf1ff;padding:10px;border-radius:10px;font-weight:700;text-align:left;cursor:pointer}
+    .nav button.active{background:linear-gradient(130deg,#5b6cff80,#00b8ff42);border-color:#d7e7ff70}
+    .content{padding:14px;min-height:84vh}
+    .header{display:flex;justify-content:space-between;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:10px}
+    .header h2{margin:0}
+    .sub{color:var(--muted);font-size:14px}
+    .pill{font-size:12px;background:#ffffff14;border:1px solid #ffffff2a;padding:4px 10px;border-radius:999px}
+    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
+    .card{background:var(--panel2);border:1px solid #b8ccff2b;border-radius:14px;padding:12px}
+    button.primary{background:linear-gradient(130deg,var(--primary),var(--primary2));border:0;color:white;padding:10px 12px;border-radius:10px;font-weight:700;cursor:pointer}
+    button.gray{background:linear-gradient(130deg,#616b8f,#8490b4);border:0;color:white;padding:10px 12px;border-radius:10px;font-weight:700;cursor:pointer}
+    input,textarea,select{width:100%;padding:10px;border-radius:10px;border:1px solid #ffffff33;background:#ffffff08;color:#fff;font:inherit}
+    textarea{min-height:90px;resize:vertical}
+    .row{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px}
+    .rarity{display:inline-block;padding:2px 8px;border-radius:999px;font-size:11px;font-weight:800;margin-bottom:6px}
+    .r-common{background:#d1d9ee35}.r-rare{background:#5a81ff44}.r-epic{background:#b75fff4a}.r-legend{background:#ffb1334d}.r-divine{background:#ff5a8a59}
+    .summon{padding:14px;border-radius:16px;background:linear-gradient(140deg,#4050a86b,#7a2f8b4f);border:1px solid #d0e1ff48;text-align:center;display:grid;gap:10px}
+    .orb{margin:0 auto;width:120px;height:120px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#fff,#8bc6ff 20%,#5f63ff 50%,#2a1459 82%);box-shadow:0 0 30px #6c8effaa,0 0 70px #ae6dff6e;animation:pulse 2.2s infinite}
+    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
+    .rng{font-weight:800;min-height:24px;text-shadow:0 0 10px #83b1ffab}
+    .log{max-height:180px;overflow:auto;background:#00000033;border:1px solid #ffffff26;border-radius:10px;padding:8px;font-size:13px}
+    table{width:100%;min-width:520px;border-collapse:collapse}
+    th,td{padding:8px 6px;text-align:left;border-bottom:1px solid #ffffff1d}
+    th{color:#b9caf6}
+    @media (max-width:860px){.app{grid-template-columns:1fr}.side{position:static}}
+  </style>
 </head>
-
 <body>
 <div id="app"></div>
-
 <script>
+  const RARITIES = {
+    COMMON: {name:"–û–±—ã—á–Ω–∞—è", chance:6000, mult:1, class:"r-common"},
+    RARE: {name:"–†–µ–¥–∫–∞—è", chance:3000, mult:2.2, class:"r-rare"},
+    EPIC: {name:"–≠–ø–∏—á–µ—Å–∫–∞—è", chance:800, mult:4.5, class:"r-epic"},
+    LEGEND: {name:"–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è", chance:180, mult:7.5, class:"r-legend"},
+    DIVINE: {name:"–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è", chance:20, mult:13, class:"r-divine"}
+  };
 
-const RARITIES = {
-  COMMON: { name: "–û–±—ã—á–Ω–∞—è", chance: 6000, mult: 1 },
-  RARE: { name: "–†–µ–¥–∫–∞—è", chance: 3000, mult: 2.5 },
-  EPIC: { name: "–≠–ø–∏—á–µ—Å–∫–∞—è", chance: 800, mult: 5 },
-  LEGEND: { name: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è", chance: 180, mult: 8 },
-  DIVINE: { name: "–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è", chance: 20, mult: 15 }
-};
-
-const UNIVERSES = {
-  "JUJUTSU KAISEN": ["–ì–æ–¥–∑—ë", "–ì—ç—Ç–æ", "–ò—Ç–∞–¥–æ—Ä–∏", "–ù–æ–±–∞—Ä–∞"],
-  "EVANGELION": ["–†—ç–π", "–ê—Å–∫–∞", "–°–∏–Ω–¥–∑–∏", "–ö–∞–≤–æ—Ä—É"]
-};
-
-let user = {
-  diamonds: 1500,
-  power: 0,
-  universe: "JUJUTSU KAISEN",
-  inventory: []
-};
-
-let currentView = "main";
-
-function render() {
-  const app = document.getElementById("app");
-
-  if (currentView === "main") {
-    app.innerHTML = `
-      <h1>Anime Gacha Empire</h1>
-      <p>üíé –ê–ª–º–∞–∑—ã: ${user.diamonds}</p>
-      <p>‚ö° –ú–æ—â—å: ${user.power}</p>
-      <button id="btnRoll">–ü—Ä–∏–∑—ã–≤</button>
-      <button id="btnInventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
-    `;
-
-    document.getElementById("btnRoll").addEventListener("click", goRoll);
-    document.getElementById("btnInventory").addEventListener("click", goInventory);
-  }
-
-  if (currentView === "roll") {
-    app.innerHTML = `
-      <h2>–ü—Ä–∏–∑—ã–≤ —Å—Ç–æ–∏—Ç 100 –∞–ª–º–∞–∑–æ–≤</h2>
-      <button id="btnActivate">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
-      <button id="btnBack">–ù–∞–∑–∞–¥</button>
-    `;
-
-    document.getElementById("btnActivate").addEventListener("click", performRoll);
-    document.getElementById("btnBack").addEventListener("click", goMain);
-  }
-
-  if (currentView === "inventory") {
-    let cardsHTML = "";
-
-    if (user.inventory.length === 0) {
-      cardsHTML = "<p>–ü—É—Å—Ç–æ</p>";
-    } else {
-      user.inventory.forEach(card => {
-        cardsHTML += `
-          <div class="card">
-            <strong>${card.name}</strong><br>
-            ${card.rarity}<br>
-            ‚ö° ${card.power} | ‚ù§Ô∏è ${card.hp}
-          </div>
-        `;
-      });
+  const UNIVERSES = {
+    "JUJUTSU KAISEN":["–ì–æ–¥–∑—ë","–ì—ç—Ç–æ","–ò—Ç–∞–¥–æ—Ä–∏","–ù–æ–±–∞—Ä–∞","–ú–∞–∫–∏","–¢–æ–¥–∑–∏"],
+    "EVANGELION":["–†—ç–π","–ê—Å–∫–∞","–°–∏–Ω–¥–∑–∏","–ö–∞–≤–æ—Ä—É","–ú–∏—Å–∞—Ç–æ"],
+    "NARUTO":["–ù–∞—Ä—É—Ç–æ","–°–∞—Å–∫–µ","–°–∞–∫—É—Ä–∞","–ò—Ç–∞—á–∏","–ú–∏–Ω–∞—Ç–æ","–ö–∞–∫–∞—à–∏"]
+  };
+
+  const BOT_RANK = [
+    {nickname:"Akira", title:"Storm", power:8200, wins:39, clan:"Moonlit"},
+    {nickname:"Yoru", title:"Blade", power:7300, wins:31, clan:"Nova"},
+    {nickname:"Ren", title:"Shogun", power:6100, wins:24, clan:"Solo"}
+  ];
+
+  const state = {
+    view:"main",
+    rolling:false,
+    rngText:'–ù–∞–∂–º–∏ "–≠–ø–∏—á–Ω—ã–π –ø—Ä–∏–∑—ã–≤"',
+    timer:null,
+    profileDraft:null,
+    logs:[],
+    clans:[
+      {id:"moonlit",name:"Moonlit",members:24,power:48000,desc:"–ù–æ—á–Ω—ã–µ —Ç—É—Ä–Ω–∏—Ä—ã"},
+      {id:"nova",name:"Nova",members:16,power:35000,desc:"–°–∏–ª—å–Ω—ã–π —Ä–æ—Å—Ç"},
+      {id:"eclipse",name:"Eclipse",members:31,power:62000,desc:"–¢–æ–ø PvP"}
+    ],
+    pvpHistory:[],
+    user:{
+      diamonds:1500,
+      power:0,
+      universe:"JUJUTSU KAISEN",
+      inventory:[],
+      pvpWins:0,
+      pvpLosses:0,
+      clan:null,
+      profile:{
+        nickname:"Player",
+        title:"–ù–æ–≤–∏—á–æ–∫",
+        avatar:"https://i.imgur.com/f4Q3QW5.png",
+        description:"–ò–¥—É –∫ –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–º –¥—Ä–æ–ø–∞–º."
+      }
     }
+  };
 
-    app.innerHTML = `
-      <h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
-      ${cardsHTML}
-      <button id="btnBack">–ù–∞–∑–∞–¥</button>
-    `;
+  const byId = (id)=>document.getElementById(id);
+  const addLog = (text)=>{ state.logs.unshift(`${new Date().toLocaleTimeString()} ‚Ä¢ ${text}`); state.logs=state.logs.slice(0,20); };
+  const recalcPower = ()=>{ state.user.power = state.user.inventory.reduce((s,c)=>s+c.power,0); };
 
-    document.getElementById("btnBack").addEventListener("click", goMain);
+  function rarityRoll(){
+    const r=Math.floor(Math.random()*10000);
+    let sum=0;
+    for(const key in RARITIES){ sum += RARITIES[key].chance; if(r<sum) return key; }
+    return "COMMON";
   }
-}
 
-function performRoll() {
-  if (user.diamonds < 100) {
-    alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–ª–º–∞–∑–æ–≤");
-    return;
+  function makeCard(){
+    const rarityKey=rarityRoll();
+    const rarity=RARITIES[rarityKey];
+    const names=UNIVERSES[state.user.universe];
+    const name=names[Math.floor(Math.random()*names.length)];
+    return {
+      id:Date.now()+Math.random(),
+      name,
+      rarityKey,
+      rarity:rarity.name,
+      power:Math.floor((Math.random()*90+60)*rarity.mult),
+      hp:Math.floor((Math.random()*140+120)*rarity.mult)
+    };
   }
 
-  user.diamonds -= 100;
+  function navBtn(view,label){ return `<button data-nav="${view}" class="${state.view===view?'active':''}">${label}</button>`; }
+
+  function sideHtml(){
+    const u=state.user;
+    return `
+      <aside class="panel side">
+        <div class="brand"><h1>Anime Gacha Empire</h1><p>–ü–æ–ª–Ω–æ—Å—Ç—å—é –∫–ª–∏–µ–Ω—Ç—Å–∫–∞—è WebApp-—Å—Ç—Ä–∞–Ω–∏—Ü–∞</p></div>
+        <div class="profile-mini">
+          <img class="avatar" src="${u.profile.avatar}" onerror="this.src='https://i.imgur.com/f4Q3QW5.png'" alt="avatar"/>
+          <div><div class="sub">${u.profile.title}</div><b>${u.profile.nickname}</b></div>
+        </div>
+        <div class="stats">
+          <div class="stat"><span>üíé –ê–ª–º–∞–∑—ã</span><b>${u.diamonds}</b></div>
+          <div class="stat"><span>‚ö° –ú–æ—â—å</span><b>${u.power}</b></div>
+          <div class="stat"><span>üèÜ PvP</span><b>${u.pvpWins}W / ${u.pvpLosses}L</b></div>
+        </div>
+        <div class="nav">
+          ${navBtn('main','–ì–ª–∞–≤–Ω–∞—è')}
+          ${navBtn('roll','–ü—Ä–∏–∑—ã–≤')}
+          ${navBtn('inventory','–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å')}
+          ${navBtn('profile','–ü—Ä–æ—Ñ–∏–ª—å')}
+          ${navBtn('clan','–ö–ª–∞–Ω—ã')}
+          ${navBtn('pvp','PvP')}
+          ${navBtn('fusion','–°–ª–∏—è–Ω–∏–µ')}
+          ${navBtn('ranking','–†–µ–π—Ç–∏–Ω–≥–∏')}
+        </div>
+      </aside>`;
+  }
 
-  const rng = Math.floor(Math.random() * 10000);
-  let cumulative = 0;
-  let rarityKey = "COMMON";
+  function vMain(){
+    const u=state.user;
+    return `<div class="header"><div><h2>${u.profile.title} ${u.profile.nickname}</h2><div class="sub">${u.profile.description}</div></div><span class="pill">üåå ${u.universe}</span></div>
+      <div class="grid">
+        <div class="card"><h3>–°—Ç–∞—Ä—Ç</h3><div class="sub">–°–¥–µ–ª–∞–π –ø—Ä–∏–∑—ã–≤ –∏ —É—Å–∏–ª–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</div><br><button class="primary" id="goRoll">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–∏–∑—ã–≤—É</button></div>
+        <div class="card"><h3>–ö–ª–∞–Ω</h3><div class="sub">${u.clan?`–í –∫–ª–∞–Ω–µ: ${u.clan}`:'–¢—ã –ø–æ–∫–∞ –±–µ–∑ –∫–ª–∞–Ω–∞'}</div><br><button class="primary" id="goClan">–û—Ç–∫—Ä—ã—Ç—å –∫–ª–∞–Ω—ã</button></div>
+        <div class="card"><h3>–¢–∞–±–ª–∏—Ü–∞</h3><div class="sub">–°–ª–µ–¥–∏ –∑–∞ –ø–æ–∑–∏—Ü–∏–µ–π –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ</div><br><button class="primary" id="goRank">–û—Ç–∫—Ä—ã—Ç—å —Ä–µ–π—Ç–∏–Ω–≥–∏</button></div>
+      </div>
+      <div class="card" style="margin-top:10px"><h3>–°–æ–±—ã—Ç–∏—è</h3><div class="log">${state.logs.length?state.logs.map(x=>`<div>${x}</div>`).join(''):'–ü–æ–∫–∞ –ø—É—Å—Ç–æ'}</div></div>`;
+  }
 
-  for (let key in RARITIES) {
-    cumulative += RARITIES[key].chance;
-    if (rng <= cumulative) {
-      rarityKey = key;
-      break;
-    }
+  function vRoll(){
+    const last=state.user.inventory.at(-1);
+    return `<div class="header"><div><h2>–≠–ø–∏—á–Ω—ã–π –ø—Ä–∏–∑—ã–≤</h2><div class="sub">–°—Ç–æ–∏–º–æ—Å—Ç—å 100 üíé</div></div><span class="pill">DIVINE 0.2%</span></div>
+      <div class="summon">
+        <div class="orb"></div>
+        <div id="rng" class="rng">${state.rngText}</div>
+        <div class="row">
+          <select id="universe">${Object.keys(UNIVERSES).map(x=>`<option ${x===state.user.universe?'selected':''}>${x}</option>`).join('')}</select>
+          <button class="primary" id="btnRoll" ${state.rolling?'disabled':''}>‚ö° –≠–ø–∏—á–Ω—ã–π –ø—Ä–∏–∑—ã–≤</button>
+        </div>
+      </div>
+      <div class="card" style="margin-top:10px"><h3>–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥—Ä–æ–ø</h3><div class="sub">${last?`${last.name} (${last.rarity})`:"–ü–æ–∫–∞ –ø—É—Å—Ç–æ"}</div></div>`;
   }
 
-  const names = UNIVERSES[user.universe];
-  const name = names[Math.floor(Math.random() * names.length)];
-  const rarity = RARITIES[rarityKey];
+  function vInventory(){
+    const list=state.user.inventory;
+    return `<div class="header"><h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2><span class="pill">–ö–∞—Ä—Ç: ${list.length}</span></div>
+      <div class="grid">${list.length?list.map(c=>`<div class="card"><span class="rarity ${RARITIES[c.rarityKey].class}">${c.rarity}</span><h3 style="margin:0 0 8px">${c.name}</h3><div class="sub">‚ö° ${c.power}</div><div class="sub">‚ù§Ô∏è ${c.hp}</div></div>`).join(''):'<div class="card">–ü–æ–∫–∞ –Ω–µ—Ç –∫–∞—Ä—Ç</div>'}</div>`;
+  }
 
-  const newCard = {
-    id: Date.now(),
-    name: name,
-    rarity: rarity.name,
-    power: Math.floor((Math.random() * 100 + 50) * rarity.mult),
-    hp: Math.floor((Math.random() * 200 + 100) * rarity.mult)
-  };
+  function vProfile(){
+    const p=state.profileDraft || {...state.user.profile};
+    return `<div class="header"><h2>–ü—Ä–æ—Ñ–∏–ª—å</h2></div>
+      <div class="row"><div class="card"><label>–ù–∏–∫</label><input id="nick" value="${p.nickname}" maxlength="20"></div><div class="card"><label>–¢–∏—Ç—É–ª</label><input id="title" value="${p.title}" maxlength="20"></div></div>
+      <div class="card" style="margin-top:10px"><label>URL –∞–≤–∞—Ç–∞—Ä–∫–∏</label><input id="avatar" value="${p.avatar}"></div>
+      <div class="card" style="margin-top:10px"><label>–û–ø–∏—Å–∞–Ω–∏–µ</label><textarea id="desc">${p.description}</textarea></div>
+      <div class="row" style="margin-top:10px"><button class="primary" id="saveProfile">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><button class="gray" id="resetProfile">–°–±—Ä–æ—Å–∏—Ç—å</button></div>`;
+  }
 
-  user.inventory.push(newCard);
-  user.power += newCard.power;
+  function vClan(){
+    return `<div class="header"><h2>–ö–ª–∞–Ω—ã</h2><span class="pill">${state.user.clan||'–±–µ–∑ –∫–ª–∞–Ω–∞'}</span></div>
+      <div class="card"><div class="row"><input id="newClan" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞–Ω–∞" maxlength="18"><button class="primary" id="createClan">–°–æ–∑–¥–∞—Ç—å –∫–ª–∞–Ω</button></div></div>
+      <div class="grid" style="margin-top:10px">${state.clans.map(c=>`<div class="card"><h3 style="margin-top:0">${c.name}</h3><div class="sub">üë• ${c.members}</div><div class="sub">‚ö° ${c.power}</div><p class="sub">${c.desc}</p><button class="primary" data-join="${c.id}">${state.user.clan===c.name?'–¢—ã –≤ –∫–ª–∞–Ω–µ':'–í—Å—Ç—É–ø–∏—Ç—å'}</button></div>`).join('')}</div>`;
+  }
 
-  alert("–í—ã–ø–∞–ª–∞ –∫–∞—Ä—Ç–∞: " + name + " (" + rarity.name + ")");
-  render();
-}
+  function vPvp(){
+    return `<div class="header"><div><h2>PvP –ê—Ä–µ–Ω–∞</h2><div class="sub">–ë–æ–π –ø—Ä–æ—Ç–∏–≤ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞</div></div><button class="primary" id="fight">‚öîÔ∏è –ù–∞–π—Ç–∏ –±–æ–π</button></div>
+      <div class="card"><h3>–ò—Å—Ç–æ—Ä–∏—è</h3><div class="log">${state.pvpHistory.length?state.pvpHistory.map(x=>`<div>${x}</div>`).join(''):'–ï—â–µ –Ω–µ—Ç –±–æ–µ–≤'}</div></div>`;
+  }
 
-function goMain() {
-  currentView = "main";
-  render();
-}
+  function vFusion(){
+    const opts=state.user.inventory.map(c=>`<option value="${c.id}">${c.name} ‚Ä¢ ${c.rarity} ‚Ä¢ ${c.power}‚ö°</option>`).join('');
+    return `<div class="header"><h2>–°–ª–∏—è–Ω–∏–µ</h2></div><div class="card">${state.user.inventory.length<2?'–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 2 –∫–∞—Ä—Ç—ã':`<div class="row"><select id="fA">${opts}</select><select id="fB">${opts}</select></div><div style="margin-top:10px"><button class="primary" id="doFusion">üîß –°–ª–∏—Ç—å</button></div>`}</div>`;
+  }
 
-function goRoll() {
-  currentView = "roll";
-  render();
-}
+  function vRanking(){
+    const me={nickname:state.user.profile.nickname,title:state.user.profile.title,power:state.user.power,wins:state.user.pvpWins,clan:state.user.clan||'Solo'};
+    const rows=[...BOT_RANK,me].sort((a,b)=>(b.power+b.wins*30)-(a.power+a.wins*30));
+    return `<div class="header"><h2>–†–µ–π—Ç–∏–Ω–≥–∏</h2></div><div class="card" style="overflow:auto"><table><thead><tr><th>#</th><th>–ò–≥—Ä–æ–∫</th><th>–ö–ª–∞–Ω</th><th>–ú–æ—â—å</th><th>–ü–æ–±–µ–¥—ã</th></tr></thead><tbody>${rows.map((r,i)=>`<tr><td>${i+1}</td><td>${r.title} ${r.nickname}</td><td>${r.clan}</td><td>${r.power}</td><td>${r.wins}</td></tr>`).join('')}</tbody></table></div>`;
+  }
 
-function goInventory() {
-  currentView = "inventory";
-  render();
-}
+  function viewHtml(){
+    if(state.view==='main') return vMain();
+    if(state.view==='roll') return vRoll();
+    if(state.view==='inventory') return vInventory();
+    if(state.view==='profile') return vProfile();
+    if(state.view==='clan') return vClan();
+    if(state.view==='pvp') return vPvp();
+    if(state.view==='fusion') return vFusion();
+    return vRanking();
+  }
 
-if (window.Telegram && window.Telegram.WebApp) {
-  Telegram.WebApp.ready();
-  Telegram.WebApp.expand();
-}
+  function render(){
+    byId('app').innerHTML = `<div class="app">${sideHtml()}<main class="panel content">${viewHtml()}</main></div>`;
+    bind();
+  }
+
+  function setView(v){state.view=v;render();}
+
+  function bind(){
+    document.querySelectorAll('[data-nav]').forEach(b=>b.addEventListener('click',()=>setView(b.dataset.nav)));
+
+    const goRoll=byId('goRoll'); if(goRoll) goRoll.onclick=()=>setView('roll');
+    const goClan=byId('goClan'); if(goClan) goClan.onclick=()=>setView('clan');
+    const goRank=byId('goRank'); if(goRank) goRank.onclick=()=>setView('ranking');
+
+    const universe=byId('universe'); if(universe) universe.onchange=e=>state.user.universe=e.target.value;
+    const btnRoll=byId('btnRoll'); if(btnRoll) btnRoll.onclick=doRoll;
+
+    const save=byId('saveProfile'); if(save) save.onclick=saveProfile;
+    const reset=byId('resetProfile'); if(reset) reset.onclick=()=>{state.profileDraft={...state.user.profile};render();};
+    ['nick','title','avatar','desc'].forEach(id=>{
+      const el=byId(id);
+      if(el){
+        el.oninput=()=>{state.profileDraft={nickname:byId('nick').value,title:byId('title').value,avatar:byId('avatar').value,description:byId('desc').value};};
+      }
+    });
+
+    const createClan=byId('createClan'); if(createClan) createClan.onclick=()=>{
+      const name=byId('newClan').value.trim();
+      if(!name){ alert('–í–≤–µ–¥–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞–Ω–∞'); return; }
+      const id=name.toLowerCase().replace(/\s+/g,'-');
+      state.clans.unshift({id,name,members:1,power:state.user.power,desc:'–ù–æ–≤—ã–π –∫–ª–∞–Ω –∏–≥—Ä–æ–∫–∞'});
+      state.user.clan=name; addLog(`–°–æ–∑–¥–∞–Ω –∫–ª–∞–Ω ${name}`); render();
+    };
+
+    document.querySelectorAll('[data-join]').forEach(btn=>btn.onclick=()=>{
+      const c=state.clans.find(x=>x.id===btn.dataset.join);
+      if(!c) return;
+      state.user.clan=c.name; c.members+=1; addLog(`–í—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ –∫–ª–∞–Ω ${c.name}`); render();
+    });
+
+    const fight=byId('fight'); if(fight) fight.onclick=()=>{
+      if(state.user.power<100){ alert('–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 100 –º–æ—â–∏'); return; }
+      const rival=BOT_RANK[Math.floor(Math.random()*BOT_RANK.length)];
+      const us=state.user.power+Math.floor(Math.random()*260);
+      const rs=rival.power+Math.floor(Math.random()*260);
+      const win=us>=rs;
+      if(win){ state.user.pvpWins+=1; state.user.diamonds+=70; } else { state.user.pvpLosses+=1; state.user.diamonds+=25; }
+      const t=`${win?'‚úÖ –ü–æ–±–µ–¥–∞':'‚ùå –ü–æ—Ä–∞–∂–µ–Ω–∏–µ'} vs ${rival.nickname} (${us} vs ${rs})`;
+      state.pvpHistory.unshift(t); state.pvpHistory=state.pvpHistory.slice(0,18); addLog(t); render();
+    };
+
+    const fuse=byId('doFusion'); if(fuse) fuse.onclick=()=>{
+      const a=Number(byId('fA').value), b=Number(byId('fB').value);
+      if(a===b){ alert('–í—ã–±–µ—Ä–∏ 2 —Ä–∞–∑–Ω—ã–µ –∫–∞—Ä—Ç—ã'); return; }
+      const c1=state.user.inventory.find(c=>c.id===a), c2=state.user.inventory.find(c=>c.id===b);
+      if(!c1 || !c2){ alert('–ö–∞—Ä—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã'); return; }
+      state.user.inventory = state.user.inventory.filter(c=>c.id!==a && c.id!==b);
+      const order=['COMMON','RARE','EPIC','LEGEND','DIVINE'];
+      const i=Math.max(order.indexOf(c1.rarityKey),order.indexOf(c2.rarityKey));
+      const up=Math.min(i+(Math.random()<0.4?1:0),order.length-1);
+      const key=order[up];
+      state.user.inventory.push({id:Date.now()+Math.random(),name:`${c1.name}-${c2.name}`,rarityKey:key,rarity:RARITIES[key].name,power:Math.floor((c1.power+c2.power)*0.68),hp:Math.floor((c1.hp+c2.hp)*0.68)});
+      recalcPower(); addLog('–°–ª–∏—è–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ'); render();
+    };
+  }
 
-render();
+  function saveProfile(){
+    const nick=byId('nick').value.trim();
+    const title=byId('title').value.trim();
+    const avatar=byId('avatar').value.trim();
+    const desc=byId('desc').value.trim();
+    state.user.profile.nickname=nick||'Player';
+    state.user.profile.title=title||'–ù–æ–≤–∏—á–æ–∫';
+    state.user.profile.avatar=avatar||'https://i.imgur.com/f4Q3QW5.png';
+    state.user.profile.description=desc||'–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è';
+    state.profileDraft=null;
+    addLog('–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω');
+    render();
+  }
 
+  function doRoll(){
+    if(state.rolling) return;
+    if(state.user.diamonds<100){ alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–ª–º–∞–∑–æ–≤'); return; }
+    state.rolling=true;
+    state.user.diamonds-=100;
+    const rngEl=byId('rng');
+    const keys=Object.keys(RARITIES);
+    let tick=0;
+    state.timer=setInterval(()=>{
+      const rk=keys[Math.floor(Math.random()*keys.length)];
+      if(rngEl) rngEl.textContent=`RNG –∫—Ä—É—Ç–∏—Ç—Å—è... ${RARITIES[rk].name}`;
+      tick++;
+      if(tick>14){
+        clearInterval(state.timer);
+        const card=makeCard();
+        state.user.inventory.push(card);
+        recalcPower();
+        state.rngText=`‚ú® ${card.name} ‚Ä¢ ${card.rarity} | ‚ö° ${card.power} | ‚ù§Ô∏è ${card.hp}`;
+        state.rolling=false;
+        addLog(`–ü–æ–ª—É—á–µ–Ω–∞ –∫–∞—Ä—Ç–∞ ${card.name} (${card.rarity})`);
+        render();
+      }
+    },120);
+  }
+
+  function loadTelegramSdk(){
+    return new Promise((resolve)=>{
+      if(window.Telegram && window.Telegram.WebApp){ resolve(true); return; }
+      const s=document.createElement('script');
+      s.src='https://telegram.org/js/telegram-web-app.js';
+      s.async=true;
+      const done=()=>resolve(!!(window.Telegram && window.Telegram.WebApp));
+      s.onload=done;
+      s.onerror=()=>resolve(false);
+      document.head.appendChild(s);
+      setTimeout(done,2500);
+    });
+  }
+
+  async function initTelegram(){
+    await loadTelegramSdk();
+    if(window.Telegram && window.Telegram.WebApp){
+      window.Telegram.WebApp.ready();
+      window.Telegram.WebApp.expand();
+    }
+  }
+
+  addLog('–°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞');
+  render();
+  initTelegram();
 </script>
 </body>
 </html>
