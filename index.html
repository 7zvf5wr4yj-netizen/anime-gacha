<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>DECK ROASTER - GOLD & EVO EDITION</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root { --red: #ff003c; --cyan: #00f2ff; --bg: #000; --gold: #ffcc00; --purple: #cf19ff; }
    body { background: var(--bg); color: #fff; font-family: 'Outfit', sans-serif; margin: 0; padding: 0; overflow: hidden; }
    .app { display: flex; flex-direction: column; height: 100vh; max-width: 500px; margin: 0 auto; }
    .header { padding: 10px; text-align: center; border-bottom: 2px solid var(--red); background: #050505; }
    .glitch { font-family: 'Orbitron'; font-size: 16px; text-shadow: 2px 2px var(--red); text-transform: uppercase; }
    .deck-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; padding: 10px; }
    .slot { aspect-ratio: 1/1.2; background: #111; border: 2px solid #222; border-radius: 8px; display: flex; align-items: center; justify-content: center; position: relative; transition: 0.3s; }
    .slot.filled { border-color: var(--cyan); }
    .slot.evo { border-color: var(--purple); box-shadow: 0 0 15px var(--purple); }
    .slot.star { border-color: var(--gold); box-shadow: 0 0 15px var(--gold); }
    .slot.champ { border-color: var(--gold); background: linear-gradient(45deg, #443300, #111); }
    .slot img { width: 100%; height: 100%; object-fit: contain; }
    .stats { padding: 10px 20px; flex-grow: 1; }
    .stat-row { margin-bottom: 10px; }
    .stat-label { display: flex; justify-content: space-between; font-family: 'Orbitron'; font-size: 10px; color: #666; }
    .bar-bg { background: #1a1a1a; height: 6px; border-radius: 3px; margin-top: 4px; overflow: hidden; }
    .bar-fill { height: 100%; width: 0%; background: var(--cyan); transition: 1s cubic-bezier(0.17, 0.67, 0.83, 0.67); }
    .btn-main { margin: 10px; padding: 18px; border: none; border-radius: 12px; background: var(--red); color: #fff; font-family: 'Orbitron'; font-weight: 900; cursor: pointer; text-transform: uppercase; }
    
    /* –û–∫–Ω–æ –≤—ã–±–æ—Ä–∞ */
    .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 2000; display: none; align-items: center; justify-content: center; flex-direction: column; padding: 20px; }
    .choice-btn { width: 100%; padding: 16px; margin: 8px; border-radius: 12px; border: none; font-family: 'Orbitron'; font-size: 14px; font-weight: bold; color: #fff; cursor: pointer; transition: 0.2s; }
    .btn-norm { background: #333; }
    .btn-evo { background: var(--purple); text-shadow: 0 0 10px #fff; }
    .btn-star { background: var(--gold); color: #000; box-shadow: 0 0 20px rgba(255,204,0,0.4); }
    .btn-champ { background: linear-gradient(90deg, #ffcc00, #ff8800); color: #000; }

    .modal { position: fixed; inset: 0; background: #000; z-index: 1000; display: none; flex-direction: column; }
    .search-area { padding: 15px; background: #0a0a0a; border-bottom: 1px solid #333; }
    #search { width: 100%; padding: 12px; background: #111; border: 1px solid var(--red); border-radius: 8px; color: #fff; outline: none; }
    .card-list { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 15px; overflow-y: auto; }
    .card-item { background: #111; border-radius: 10px; padding: 5px; text-align: center; border: 1px solid #222; }
    .card-item img { width: 100%; border-radius: 5px; }
    
    .result-view { position: fixed; inset: 0; background: #000; z-index: 3000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
    .result-card { background: #0a0a0a; border: 3px solid var(--red); border-radius: 20px; padding: 25px; text-align: center; width: 100%; position: relative; }
  </style>
</head>
<body>

<div class="app">
  <div class="header"><div class="glitch">DECK ANALYZER 2026</div></div>
  <div class="deck-grid">
    <script>
      for(let i=0; i<8; i++) document.write(`<div class="slot" id="s${i}" onclick="openModal(${i})"><img id="img${i}" style="display:none"><span id="p${i}" style="opacity:0.3; font-size:24px;">+</span></div>`);
    </script>
  </div>
  <div class="stats">
    <div class="stat-row"><div class="stat-label"><span>TOXICITY (–Ø–î)</span><span id="v-tox">0%</span></div><div class="bar-bg"><div class="bar-fill" id="b-tox"></div></div></div>
    <div class="stat-row"><div class="stat-label"><span>SKILL ISSUE</span><span id="v-skill">0%</span></div><div class="bar-bg"><div class="bar-fill" id="b-skill"></div></div></div>
    <div class="stat-row"><div class="stat-label"><span>GIRLFRIEND CHANCE</span><span id="v-love">100%</span></div><div class="bar-bg"><div class="bar-fill" id="b-love" style="background:var(--red); width:100%"></div></div></div>
  </div>
  <button class="btn-main" onclick="startRoast()">–£–ù–ò–ó–ò–¢–¨ –ö–û–õ–û–î–£</button>
</div>

<div id="choice-overlay" class="overlay">
  <h2 id="choice-name" style="margin-bottom:20px; font-family:'Orbitron';">–ö–ê–†–¢–ê</h2>
  <button class="choice-btn btn-norm" onclick="selectVersion('norm')">–û–ë–´–ß–ù–ê–Ø</button>
  <button id="opt-star" class="choice-btn btn-star" onclick="selectVersion('star')">–ó–û–õ–û–¢–ê–Ø (STAR LEVEL)</button>
  <button id="opt-evo" class="choice-btn btn-evo" style="display:none" onclick="selectVersion('evo')">–≠–í–û–õ–Æ–¶–ò–Ø</button>
  <button id="opt-champ" class="choice-btn btn-champ" style="display:none" onclick="selectVersion('champ')">–ß–ï–ú–ü–ò–û–ù</button>
  <button style="background:none; border:none; color:#555; margin-top:20px;" onclick="closeChoice()">–û–¢–ú–ï–ù–ê</button>
</div>

<div id="modal" class="modal">
  <div class="search-area">
    <input type="text" id="search" placeholder="–ù–∞–π—Ç–∏ –∫–∞—Ä—Ç—É..." oninput="renderCards()">
    <button onclick="closeModal()" style="background:none; border:none; color:var(--red); margin-top:10px; width:100%; font-weight:bold;">–ù–ê–ó–ê–î</button>
  </div>
  <div class="card-list" id="card-list"></div>
</div>

<div id="result" class="result-view">
  <div id="capture-area" class="result-card">
    <div id="res-emoji" style="font-size: 60px; margin-bottom:10px;"></div>
    <h2 id="res-title" style="color:var(--red); font-family:'Orbitron'; margin:0;"></h2>
    <p id="res-text" style="font-size: 14px; margin: 20px 0; line-height:1.5;"></p>
    <div id="res-grid" style="display:grid; grid-template-columns:repeat(4,1fr); gap:5px;"></div>
  </div>
  <button class="btn-main" style="width:100%" onclick="saveResult()">–°–û–•–†–ê–ù–ò–¢–¨ –î–õ–Ø –¢–ò–ö–¢–û–ö–ê</button>
  <button onclick="location.reload()" style="background:none; border:none; color:#555; margin-top:15px;">–ó–ê–ù–û–í–û</button>
</div>

<script>
const tg = window.Telegram.WebApp; tg.expand();

// –ë–ê–ó–ê –î–ê–ù–ù–´–• (ID –ò–ó –ö–≠–®–ê –ò–ì–†–´)
const DATA = [
  {n:"–ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—å",id:"mega-knight",evo:true,t:40,s:80}, {n:"–í—Å–∞–¥–Ω–∏–∫ –Ω–∞ –∫–∞–±–∞–Ω–µ",id:"hog-rider",evo:true,t:30,s:10},
  {n:"–≠–ª–∏—Ç–Ω—ã–µ –≤–∞—Ä–≤–∞—Ä—ã",id:"elite-barbarians",evo:true,t:80,s:70}, {n:"–ê—Ä–±–∞–ª–µ—Ç",id:"x-bow",t:60,s:40},
  {n:"–û–≥–Ω–µ–Ω–Ω–∞—è –ª—É—á–Ω–∏—Ü–∞",id:"firecracker",evo:true,t:40,s:10}, {n:"–ü.–ï.–ö.–ö.–ê.",id:"pekka",evo:true,t:15,s:20},
  {n:"–í–µ–¥—å–º–∞",id:"witch",t:20,s:50}, {n:"–ö–æ–ª–¥—É–Ω",id:"wizard",evo:true,t:10,s:60},
  {n:"–ú–∞–ª–µ–Ω—å–∫–∏–π –ü—Ä–∏–Ω—Ü",id:"little-prince",champ:true,t:30,s:15}, {n:"–ö–æ—Ä–æ–ª–µ–≤–∞ –ª—É—á–Ω–∏—Ü",id:"archer-queen",champ:true,t:20,s:20},
  {n:"–ì–æ–±–ª–∏–Ω—Å–∫–∞—è –±–æ—á–∫–∞",id:"goblin-barrel",evo:true,t:40,s:10}, {n:"–ó–∞–º–æ—Ä–æ–∑–∫–∞",id:"freeze",t:90,s:80},
  {n:"–ó–µ—Ä–∫–∞–ª–æ",id:"mirror",t:70,s:50}, {n:"–≠–ª–µ–∫—Ç—Ä–æ–≥–∏–≥–∞–Ω—Ç",id:"electro-giant",t:75,s:40},
  {n:"–ë–æ–µ–≤–æ–π —Ç–∞—Ä–∞–Ω",id:"battle-ram",evo:true,t:10,s:15}, {n:"–í–∞–ª—å–∫–∏—Ä–∏—è",id:"valkyrie",evo:true,t:5,s:10},
  {n:"–ú–æ—Ä—Ç–∏—Ä–∞",id:"mortar",evo:true,t:45,s:25}, {n:"–°–∫–µ–ª–µ—Ç—ã",id:"skeletons",evo:true,t:5,s:5},
  {n:"–°–ø–∞—Ä–∫–∏",id:"sparky",t:60,s:40}, {n:"–Ø—Ä–æ—Å—Ç—å",id:"rage",t:50,s:30}, {n:"–ì–æ–±–ª–∏–Ω—à—Ç–µ–π–Ω",id:"goblinstein",t:40,s:20}
  // –î–æ–±–∞–≤—å —Å—é–¥–∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–∞—Ä—Ç—ã –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
];

let deck = Array(8).fill(null);
let curSlot = 0;
let tempCard = null;

function openModal(i) { curSlot = i; document.getElementById('modal').style.display = 'flex'; renderCards(); }
function closeModal() { document.getElementById('modal').style.display = 'none'; }
function closeChoice() { document.getElementById('choice-overlay').style.display = 'none'; }

function renderCards() {
  const q = document.getElementById('search').value.toLowerCase();
  const list = document.getElementById('card-list');
  list.innerHTML = DATA.filter(c => c.n.toLowerCase().includes(q)).map(c => `
    <div class="card-item" onclick="initChoice('${c.n}')">
      <img src="https://royaleapi.com/static/img/cards-150/${c.id}.png">
      <div style="font-size:10px; margin-top:5px;">${c.n}</div>
    </div>
  `).join('');
}

function initChoice(name) {
  tempCard = DATA.find(x => x.n === name);
  document.getElementById('modal').style.display = 'none';
  document.getElementById('choice-overlay').style.display = 'flex';
  document.getElementById('choice-name').innerText = name;
  document.getElementById('opt-evo').style.display = tempCard.evo ? 'block' : 'none';
  document.getElementById('opt-champ').style.display = tempCard.champ ? 'block' : 'none';
}

function selectVersion(ver) {
  let final = {...tempCard, ver: ver};
  deck[curSlot] = final;
  
  const s = document.getElementById(`s${curSlot}`);
  const img = document.getElementById(`img${curSlot}`);
  
  s.className = `slot filled ${ver}`;
  let url = `https://royaleapi.com/static/img/cards-150/${final.id}${ver==='evo'?'-ev1':''}.png`;
  img.src = url;
  img.style.display = 'block';
  document.getElementById(`p${curSlot}`).style.display = 'none';
  
  closeChoice();
  updateStats();
}

function updateStats() {
  const d = deck.filter(x => x);
  const tox = d.reduce((a,b) => a + (b.ver==='evo'?b.t+20:b.t), 0) / 1.6;
  const skill = d.reduce((a,b) => a + (b.ver==='star'?b.s+10:b.s), 0) / 1.6;
  
  document.getElementById('b-tox').style.width = Math.min(100, tox) + '%';
  document.getElementById('v-tox').innerText = Math.round(tox) + '%';
  document.getElementById('b-skill').style.width = Math.min(100, skill) + '%';
  document.getElementById('v-skill').innerText = Math.round(skill) + '%';
  document.getElementById('b-love').style.width = Math.max(0, 100 - (tox+skill)/2.5) + '%';
}

function startRoast() {
  if(deck.includes(null)) return tg.showAlert("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ 8 –∫–∞—Ä—Ç!");
  
  const names = deck.map(c => c.n);
  const vers = deck.map(c => c.ver);
  let t, e, txt;

  if(vers.includes('star') && names.includes('–ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—å')) {
    t = "–ó–û–õ–û–¢–û–ô –ö–õ–û–£–ù"; e = "‚ú®ü§°";
    txt = "–¢—ã —Ä–µ–∞–ª—å–Ω–æ –ø–æ—Ç—Ä–∞—Ç–∏–ª –∑–≤–µ–∑–¥–Ω—ã–µ –æ—á–∫–∏ –Ω–∞ –ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—è? –î—É–º–∞–µ—à—å, –µ—Å–ª–∏ –æ–Ω –±–ª–µ—Å—Ç–∏—Ç, —Ç–æ –µ–≥–æ –ø—Ä—ã–∂–æ–∫ –Ω–∞ –º–æ—Å—Ç —Å—Ç–∞–Ω–µ—Ç —É–º–Ω–µ–µ? –¢—ã ‚Äî –ª–µ–≥–µ–Ω–¥–∞ –º–∏–¥–ª–∞–¥–µ—Ä–∞, –∑–æ–ª–æ—Ç–æ–π —Å—Ç–∞–Ω–¥–∞—Ä—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –º–æ–∑–≥–∞.";
  } else if(vers.includes('evo') && names.includes('–≠–ª–∏—Ç–Ω—ã–µ –≤–∞—Ä–≤–∞—Ä—ã')) {
    t = "–ú–£–¢–ê–ù–¢-–û–õ–ò–ì–û–§–†–ï–ù"; e = "üß¨ü§Æ";
    txt = "–≠–≤–æ–ª—é—Ü–∏—è –≠–ª–∏—Ç–æ–∫. –¢—ã –±—É–∫–≤–∞–ª—å–Ω–æ –∑–∞–ø–ª–∞—Ç–∏–ª –∑–∞ —Ç–æ, —á—Ç–æ–±—ã –∏–≥—Ä–∞–ª–∞ –Ω–µ–π—Ä–æ—Å–µ—Ç—å –≤–º–µ—Å—Ç–æ —Ç–µ–±—è. –£ —Ç–µ–±—è –Ω–µ—Ç —Å–æ–≤–µ—Å—Ç–∏, –Ω–µ—Ç –¥—Ä—É–∑–µ–π, –∏, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, —Ç—ã –¥–æ —Å–∏—Ö –ø–æ—Ä –ø—Ä–æ—Å–∏—à—å –º–∞–º—É –∑–∞–≤—è–∑–∞—Ç—å —Ç–µ–±–µ —à–Ω—É—Ä–∫–∏.";
  } else if(names.includes('–ê—Ä–±–∞–ª–µ—Ç') && names.includes('–ó–∞–º–æ—Ä–æ–∑–∫–∞')) {
    t = "–õ–ï–§–û–†–¢–û–í–°–ö–ò–ô –£–ó–ù–ò–ö"; e = "üßä";
    txt = "–ê—Ä–±–∞–ª–µ—Ç –ø–æ–¥ –§—Ä–∏–∑–æ–º? –¢—ã —Å–∞–º—ã–π –º–µ—Ä–∑–∫–∏–π —Ç–∏–ø, –∫–æ—Ç–æ—Ä–æ–≥–æ —è –≤–∏–¥–µ–ª. –¢—ã –Ω–µ –∏–≥—Ä–∞–µ—à—å –≤ –ö–ª—ç—à, —Ç—ã –ø—Ä–æ—Å—Ç–æ –ø—ã—Ç–∞–µ—à—å—Å—è —Å–¥–µ–ª–∞—Ç—å –∂–∏–∑–Ω—å –¥—Ä—É–≥–∏—Ö –ª—é–¥–µ–π —Ö—É–∂–µ. –ù–∞–¥–µ—é—Å—å, —É —Ç–µ–±—è –≤—ã–ª–µ—Ç–∏—Ç Wi-Fi.";
  } else if(vers.filter(v => v==='evo').length >= 2) {
    t = "–≠–í–û-–®–õ–Æ–•–ê"; e = "üòà";
    txt = "–î–≤–µ —ç–≤–æ–ª—é—Ü–∏–∏ –≤ –¥–µ–∫–µ. –ë–µ–∑ –¥–æ–Ω–∞—Ç–∞ —Ç—ã –±—ã –¥–∞–∂–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ—á–Ω—ã–π –ª–∞–≥–µ—Ä—å –Ω–µ –ø—Ä–æ—à–µ–ª. –¢–≤–æ–π —Å–∫–∏–ª–ª –∫—É–ø–ª–µ–Ω –≤ –º–∞–≥–∞–∑–∏–Ω–µ, –Ω–æ —É–≤–∞–∂–µ–Ω–∏–µ —Ç–∞–º –Ω–µ –ø—Ä–æ–¥–∞–µ—Ç—Å—è.";
  } else {
    t = "–ü–û–°–ú–ï–®–ò–©–ï"; e = "üí©";
    txt = "–†–∞–Ω–¥–æ–º–Ω—ã–π –º—É—Å–æ—Ä. –¢—ã –ø—Ä–æ—Å—Ç–æ –Ω–∞–∫–∏–¥–∞–ª –∫–∞—Ä—Ç –∏ –∂–¥–µ—à—å —á—É–¥–∞. –¢–≤–æ—è –¥–µ–∫–∞ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ –æ–±—ä–µ–¥–∫–∏ —Å –ø—Ä–∞–∑–¥–Ω–∏—á–Ω–æ–≥–æ —Å—Ç–æ–ª–∞ —Ç–æ–ø-–∏–≥—Ä–æ–∫–∞.";
  }

  document.getElementById('res-title').innerText = t;
  document.getElementById('res-emoji').innerText = e;
  document.getElementById('res-text').innerText = txt;
  document.getElementById('res-grid').innerHTML = deck.map(x => `<img src="https://royaleapi.com/static/img/cards-150/${x.id}${x.ver==='evo'?'-ev1':''}.png" class="${x.ver}">`).join('');
  document.getElementById('result').style.display = 'flex';
  tg.HapticFeedback.notificationOccurred('success');
}

function saveResult() {
  html2canvas(document.getElementById('capture-area')).then(canvas => {
    const a = document.createElement('a'); a.download='roast.png'; a.href=canvas.toDataURL(); a.click();
    tg.showAlert("–°–∫—Ä–∏–Ω—à–æ—Ç –≥–æ—Ç–æ–≤!");
  });
}
</script>
</body>
</html>
