<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>CR: Pro Strategy Analyst</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --main-bg: #0b0e14;
      --accent: #00d2ff;
      --glass: rgba(255, 255, 255, 0.03);
      --glass-border: rgba(255, 255, 255, 0.1);
      --text: #e2e8f0;
    }

    body {
      background: radial-gradient(circle at 50% 0%, #1a2a44 0%, #0b0e14 100%);
      color: var(--text); font-family: 'Montserrat', sans-serif;
      margin: 0; padding: 0; height: 100vh; overflow: hidden;
    }

    /* –ê–ù–ò–ú–ê–¶–ò–ò –ö–õ–Æ–ß–ï–í–´–• –ö–ê–î–†–û–í */
    @keyframes slotPop {
      0% { transform: scale(0.5); opacity: 0; }
      70% { transform: scale(1.1); }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes slideInUp {
      from { transform: translateY(100%); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    @keyframes glowPulse {
      0% { box-shadow: 0 0 5px var(--accent); }
      50% { box-shadow: 0 0 20px var(--accent); }
      100% { box-shadow: 0 0 5px var(--accent); }
    }

    .app-container { display: flex; flex-direction: column; height: 100%; max-width: 500px; margin: 0 auto; }

    .header { padding: 30px 20px; text-align: center; }
    .header h1 { 
      margin: 0; font-size: 22px; font-weight: 900; letter-spacing: 2px;
      background: linear-gradient(to right, #00d2ff, #9cedff);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      text-transform: uppercase;
    }

    /* –°–ï–¢–ö–ê –ö–û–õ–û–î–´ */
    .deck-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; padding: 0 20px; }

    .slot {
      aspect-ratio: 1/1.3; background: var(--glass);
      border: 1px solid var(--glass-border); border-radius: 12px;
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      display: flex; align-items: center; justify-content: center;
      cursor: pointer; position: relative; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .slot.filled img {
      animation: slotPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }

    .slot.filled {
      border-color: var(--accent);
      background: rgba(0, 210, 255, 0.05);
    }

    .slot img { width: 85%; height: 85%; object-fit: contain; }

    .elixir-tag {
      position: absolute; top: -8px; right: -8px;
      background: linear-gradient(135deg, #ff00ff, #8a2be2);
      color: white; border-radius: 50%; width: 22px; height: 22px;
      font-size: 11px; font-weight: 900; display: flex; 
      align-items: center; justify-content: center; border: 2px solid var(--main-bg);
      z-index: 10;
    }

    /* –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –í–´–ë–û–†–ê */
    .picker-modal {
      position: fixed; inset: 0; background: rgba(0,0,0,0.85);
      backdrop-filter: blur(15px); z-index: 100; display: none;
      flex-direction: column; 
    }

    .picker-content {
      margin-top: auto; background: #161b22; 
      border-top: 2px solid var(--accent);
      border-radius: 30px 30px 0 0;
      height: 75vh; overflow-y: auto;
      animation: slideInUp 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }

    .picker-header { 
      position: sticky; top: 0; background: #161b22; z-index: 5;
      padding: 20px; border-bottom: 1px solid var(--glass-border);
      display: flex; gap: 10px; align-items: center;
    }

    #search { 
      flex: 1; background: rgba(255,255,255,0.05); border: 1px solid var(--glass-border);
      border-radius: 12px; padding: 12px; color: white; font-family: 'Montserrat';
    }

    .picker-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 20px; }

    .card-option { transition: transform 0.2s; position: relative; }
    .card-option:active { transform: scale(0.9); }
    .card-option img { width: 100%; border-radius: 10px; }
    .card-option.disabled { opacity: 0.2; filter: grayscale(1); pointer-events: none; }

    /* –ö–ù–û–ü–ö–ê */
    .action-area { padding: 30px 20px; }
    .analyze-btn {
      width: 100%; padding: 20px; border-radius: 16px; border: none;
      background: linear-gradient(135deg, #3a7bd5, #00d2ff);
      color: white; font-size: 16px; font-weight: 900; text-transform: uppercase;
      cursor: pointer; box-shadow: 0 10px 20px rgba(0, 210, 255, 0.2);
    }

    /* –≠–ö–†–ê–ù –†–ï–ó–£–õ–¨–¢–ê–¢–ê */
    .result-screen {
      position: fixed; inset: 0; background: var(--main-bg);
      z-index: 200; display: none; flex-direction: column; align-items: center;
      padding: 40px 25px; justify-content: center;
      animation: slideInUp 0.5s ease;
    }
  </style>
</head>
<body>

<div class="app-container">
  <div class="header">
    <h1>PRO ANALYST</h1>
    <p>VERSION 2.0 ‚Ä¢ ANIMATED</p>
  </div>

  <div class="deck-grid" id="deck-slots">
    <div class="slot" onclick="openPicker(0)" id="s0">‚ûï</div>
    <div class="slot" onclick="openPicker(1)" id="s1">‚ûï</div>
    <div class="slot" onclick="openPicker(2)" id="s2">‚ûï</div>
    <div class="slot" onclick="openPicker(3)" id="s3">‚ûï</div>
    <div class="slot" onclick="openPicker(4)" id="s4">‚ûï</div>
    <div class="slot" onclick="openPicker(5)" id="s5">‚ûï</div>
    <div class="slot" onclick="openPicker(6)" id="s6">‚ûï</div>
    <div class="slot" onclick="openPicker(7)" id="s7">‚ûï</div>
  </div>

  <div class="action-area">
    <button class="analyze-btn" onclick="startAnalysis()">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–∏–ª–¥</button>
  </div>
</div>

<div id="picker-modal" class="picker-modal" onclick="closePicker()">
  <div class="picker-content" onclick="event.stopPropagation()">
    <div class="picker-header">
      <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ –∫–∞—Ä—Ç—ã..." oninput="renderPicker()">
      <div onclick="closePicker()" style="font-size: 24px; padding: 5px;">‚úï</div>
    </div>
    <div class="picker-grid" id="picker-list"></div>
  </div>
</div>

<div id="result-screen" class="result-screen">
  <div id="res-content" style="width: 100%; max-width: 400px; text-align: center;">
    <div id="mini-deck-view" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 30px;"></div>
    <div style="background: var(--glass); padding: 40px 20px; border-radius: 24px; border: 1px solid var(--glass-border);">
        <span id="v-emoji" style="font-size: 60px;"></span>
        <h2 id="v-title" style="color: var(--accent); margin: 15px 0;"></h2>
        <p id="v-text" style="line-height: 1.6; opacity: 0.9;"></p>
    </div>
    <button class="analyze-btn" style="margin-top: 30px; background: rgba(255,255,255,0.05);" onclick="location.reload()">–ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å</button>
  </div>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

// –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ ID –∫–∞—Ä—Ç –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–æ–∫
const CARDS = [
  {id:"mega-knight",n:"–ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—å",e:7,t:"mid"},{id:"hog-rider",n:"–•–æ–≥",e:4,t:"win"},
  {id:"pekka",n:"–ü–ï–ö–ö–ê",e:7,t:"heavy"},{id:"the-log",n:"–ë—Ä–µ–≤–Ω–æ",e:2,t:"spell"},
  {id:"fireball",n:"–§–∞–π–µ—Ä–±–æ–ª",e:4,t:"spell"},{id:"elite-barbarians",n:"–≠–ª–∏—Ç–∫–∏",e:6,t:"mid"},
  {id:"balloon",n:"–®–∞—Ä",e:5,t:"win"},{id:"goblin-barrel",n:"–ë–æ—á–∫–∞",e:3,t:"win"},
  {id:"electro-giant",n:"–≠–ª–µ–∫—Ç—Ä–æ–≥–∏–≥–∞–Ω—Ç",e:7,t:"mid"},{id:"x-bow",n:"–ê—Ä–±–∞–ª–µ—Ç",e:6,t:"cancer"},
  {id:"graveyard",n:"–ö–ª–∞–¥–±–∏—â–µ",e:5,t:"win"},{id:"golem",n:"–ì–æ–ª–µ–º",e:8,t:"heavy"},
  {id:"miner",n:"–®–∞—Ö—Ç–µ—Ä",e:3,t:"win"},{id:"poison",n:"–Ø–¥",e:4,t:"spell"},
  {id:"skeletons",n:"–°–∫–µ–ª–µ—Ç—ã",e:1,t:"cycle"},{id:"ice-spirit",n:"–õ–µ–¥—è–Ω–æ–π –¥—É—Ö",e:1,t:"cycle"},
  {id:"valkyrie",n:"–í–∞–ª—å–∫–∏—Ä–∏—è",e:4,t:"def"},{id:"executioner",n:"–ü–∞–ª–∞—á",e:5,t:"def"},
  {id:"zap",n:"–†–∞–∑—Ä—è–¥",e:2,t:"spell"},{id:"inferno-tower",n:"–ò–Ω—Ñ–µ—Ä–Ω–æ",e:5,t:"def"}
];

let deck = Array(8).fill(null);
let currentSlot = 0;

function openPicker(idx) {
  currentSlot = idx;
  document.getElementById('picker-modal').style.display = 'flex';
  renderPicker();
  tg.HapticFeedback.impactOccurred('medium');
}

function closePicker() {
  const content = document.querySelector('.picker-content');
  content.style.transform = 'translateY(100%)';
  setTimeout(() => {
    document.getElementById('picker-modal').style.display = 'none';
    content.style.transform = 'translateY(0)';
  }, 300);
}

function renderPicker() {
  const query = document.getElementById('search').value.toLowerCase();
  const container = document.getElementById('picker-list');
  const selectedIds = deck.filter(x => x).map(x => x.id);

  container.innerHTML = CARDS.filter(c => c.n.toLowerCase().includes(query)).map(c => {
    const isSelected = selectedIds.includes(c.id);
    return `
      <div class="card-option ${isSelected ? 'disabled' : ''}" onclick="selectCard('${c.id}')">
        <img src="https://royaleapi.github.io/cr-api-assets/cards/${c.id}.png">
      </div>
    `;
  }).join('');
}

function selectCard(id) {
  const card = CARDS.find(x => x.id === id);
  deck[currentSlot] = card;
  
  const slot = document.getElementById(`s${currentSlot}`);
  // –û—á–∏—â–∞–µ–º –∏ –¥–æ–±–∞–≤–ª—è–µ–º —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
  slot.innerHTML = `<div class="elixir-tag">${card.e}</div><img src="https://royaleapi.github.io/cr-api-assets/cards/${id}.png">`;
  slot.classList.add('filled');
  
  closePicker();
  tg.HapticFeedback.notificationOccurred('success');
}

function startAnalysis() {
  if (deck.includes(null)) return tg.showAlert("–ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ 8 —Å–ª–æ—Ç–æ–≤!");

  const avg = (deck.reduce((a,b) => a+b.e, 0) / 8).toFixed(1);
  const midCount = deck.filter(c => c.t === 'mid' || c.e >= 7).length;
  const spellCount = deck.filter(c => c.t === 'spell').length;
  const winCount = deck.filter(c => c.t === 'win' || c.t === 'cancer').length;

  let title, text, emoji;

  if (midCount >= 3 && avg > 4.2) {
    emoji = "ü§°"; title = "–ú–ê–°–¢–ï–† –ú–ò–î–õ–ê–î–î–ï–†–ê";
    text = `–°—Ä–µ–¥–Ω–∏–π —ç–ª–∏–∫—Å–∏—Ä ${avg}. –¢–≤–æ—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è ‚Äî –ø—Ä–æ—Å—Ç–æ –∑–∞–¥–∞–≤–∏—Ç—å –º–∞—Å—Å–æ–π? –£–¥–∞—á–Ω–æ–≥–æ –¥–µ—Ñ–∞ –ø—Ä–æ—Ç–∏–≤ –•–æ–≥–∞ 2.6, —Å–∫–∞–∑–æ—á–Ω–∏–∫.`;
  } else if (spellCount >= 2 && winCount >= 1 && avg >= 3.0 && avg <= 3.9) {
    emoji = "üî•"; title = "–°–û–õ–ò–î–ù–´–ô –ü–ò–ö";
    text = `–ö—Ä–∞—Å–∏–≤–æ —Å–æ–±—Ä–∞–ª. –ë–∞–ª–∞–Ω—Å –∏–¥–µ–∞–ª—å–Ω—ã–π, —Å–ø–µ–ª–ª—ã –Ω–∞ –º–µ—Å—Ç–µ. –¢—ã –ª–∏–±–æ –ø—Ä–æ—Ñ–∏, –ª–∏–±–æ —É–¥–∞—á–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª –¥–µ–∫—É —É —Ç–æ–ø–∞.`;
  } else if (winCount === 0) {
    emoji = "üß±"; title = "–¢–£–ü–û–ô –î–ï–§";
    text = "–£ —Ç–µ–±—è –Ω–µ—Ç –≤–∏–Ω-–∫–æ–Ω–∞. –°–æ–±–∏—Ä–∞–µ—à—å—Å—è –≤—ã–∏–≥—Ä—ã–≤–∞—Ç—å –Ω–∞ –Ω–∏—á—å—é? –î–æ–±–∞–≤—å –•–æ–≥–∞ –∏–ª–∏ –®–∞—Ä–∞.";
  } else {
    emoji = "üßê"; title = "–ü–û–ô–î–ï–¢...";
    text = `–ö–æ–ª–æ–¥–∞ (–°—Ä. —ç–ª–∏–∫—Å–∏—Ä ${avg}) –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è, –Ω–æ –±–µ–∑ –¥—É—à–∏. –ò–≥—Ä–∞—Ç—å –º–æ–∂–Ω–æ, –Ω–æ –ª–µ–≥–µ–Ω–¥—É —Ç–∞–∫ –±—É–¥–µ—à—å –±—Ä–∞—Ç—å –¥–æ–ª–≥–æ.`;
  }

  document.getElementById('v-emoji').innerText = emoji;
  document.getElementById('v-title').innerText = title;
  document.getElementById('v-text').innerText = text;
  document.getElementById('mini-deck-view').innerHTML = deck.map(c => `<div style="aspect-ratio:1/1; overflow:hidden; border-radius:4px;"><img src="https://royaleapi.github.io/cr-api-assets/cards/${c.id}.png" style="width:100%"></div>`).join('');
  
  document.getElementById('result-screen').style.display = 'flex';
  tg.HapticFeedback.notificationOccurred('warning');
}
</script>
</body>
</html>
