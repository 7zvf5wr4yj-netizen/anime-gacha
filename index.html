<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>CR: Ultimate Deck Analyst</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #030712;
      --accent: #00f2ff;
      --pink: #ff00c8;
      --glass: rgba(255, 255, 255, 0.03);
      --border: rgba(255, 255, 255, 0.08);
    }

    body {
      background: var(--bg);
      color: #fff; font-family: 'Outfit', sans-serif;
      margin: 0; padding: 0; height: 100vh; overflow: hidden;
    }

    /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ–Ω */
    .bg-animation {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: radial-gradient(circle at 50% 0%, #1e293b 0%, #030712 100%);
      z-index: -1;
    }

    .bg-glow {
      position: absolute; width: 300px; height: 300px;
      background: var(--accent); filter: blur(150px);
      opacity: 0.1; top: -100px; left: 50%; transform: translateX(-50%);
    }

    .app { display: flex; flex-direction: column; height: 100%; max-width: 500px; margin: 0 auto; position: relative; }

    .header { padding: 30px 20px 20px; text-align: center; }
    .header h1 { 
      margin: 0; font-size: 24px; font-weight: 900; letter-spacing: 1px;
      background: linear-gradient(to right, var(--accent), #fff);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      text-transform: uppercase;
    }
    .header p { font-size: 10px; opacity: 0.4; letter-spacing: 3px; margin-top: 5px; }

    /* –°–ï–¢–ö–ê –°–õ–û–¢–û–í */
    .deck-grid { display: grid; grid-template-columns: repeat(4, 2fr); gap: 12px; padding: 10px 20px; }

    .slot {
      aspect-ratio: 1/1.25; background: var(--glass);
      border: 1px solid var(--border); border-radius: 16px;
      display: flex; align-items: center; justify-content: center;
      position: relative; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      backdrop-filter: blur(10px);
    }
    .slot:active { transform: scale(0.95); }

    .slot.filled { border-color: rgba(0, 242, 255, 0.4); box-shadow: 0 0 20px rgba(0, 242, 255, 0.1); }

    .slot img { width: 90%; height: 90%; object-fit: contain; display: none; }
    
    /* –ê–Ω–∏–º–∞—Ü–∏—è –≤–ª–µ—Ç–∞ –∫–∞—Ä—Ç—ã */
    .slot.filled img { 
      display: block; 
      animation: cardPop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) forwards; 
    }

    @keyframes cardPop {
      0% { transform: scale(0.4) translateY(20px); opacity: 0; }
      100% { transform: scale(1) translateY(0); opacity: 1; }
    }

    .plus-icon { font-size: 24px; color: rgba(255,255,255,0.1); }
    .slot.filled .plus-icon { display: none; }

    .elixir-tag {
      position: absolute; top: -6px; right: -6px;
      background: linear-gradient(135deg, var(--pink), #8000ff);
      color: white; border-radius: 8px; width: 24px; height: 24px;
      font-size: 11px; font-weight: 900; display: none;
      align-items: center; justify-content: center; border: 2px solid var(--bg); z-index: 5;
    }
    .slot.filled .elixir-tag { display: flex; }

    /* –ú–û–î–ê–õ–ö–ê –í–´–ë–û–†–ê */
    .modal {
      position: fixed; inset: 0; background: rgba(0,0,0,0.9);
      backdrop-filter: blur(20px); z-index: 1000; display: none;
      flex-direction: column; animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .modal-content {
      margin-top: auto; background: #0f172a; border-top: 2px solid var(--accent);
      border-radius: 30px 30px 0 0; height: 85vh; overflow-y: auto;
      display: flex; flex-direction: column;
    }

    .modal-header { padding: 25px; position: sticky; top: 0; background: #0f172a; z-index: 10; }
    #search {
      width: 100%; background: rgba(255,255,255,0.05); border: 1px solid var(--border);
      padding: 15px; border-radius: 14px; color: #fff; outline: none; font-size: 16px;
      box-sizing: border-box; font-family: 'Outfit';
    }

    .cards-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 20px; }
    .card-item { transition: 0.2s; position: relative; text-align: center; }
    .card-item img { width: 100%; border-radius: 12px; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3)); }
    .card-item.used { opacity: 0.2; filter: grayscale(1); pointer-events: none; }
    .card-item:active { transform: scale(0.9); }

    /* –ö–ù–û–ü–ö–ê */
    .footer { padding: 30px 20px; }
    .btn-action {
      width: 100%; padding: 22px; border-radius: 20px; border: none;
      background: linear-gradient(90deg, #3b82f6, var(--accent));
      color: #fff; font-weight: 900; text-transform: uppercase; letter-spacing: 1px;
      cursor: pointer; box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
      transition: 0.3s;
    }
    .btn-action:active { transform: scale(0.98); }

    /* –†–ï–ó–£–õ–¨–¢–ê–¢ */
    .result-overlay {
      position: fixed; inset: 0; background: var(--bg); z-index: 2000;
      display: none; flex-direction: column; align-items: center; justify-content: center;
      padding: 20px; text-align: center;
    }
    .result-card {
      background: var(--glass); border: 1px solid var(--border);
      padding: 40px 25px; border-radius: 32px; width: 100%; box-sizing: border-box;
      backdrop-filter: blur(10px);
    }
  </style>
</head>
<body>

<div class="bg-animation"><div class="bg-glow"></div></div>

<div class="app">
  <div class="header">
    <h1>CR DECK ANALYST</h1>
    <p>POWERED BY AI ‚Ä¢ PRECISE EVALUATION</p>
  </div>

  <div class="deck-grid" id="main-grid">
    <script>
      for(let i=0; i<8; i++) {
        document.write(`
          <div class="slot" id="slot-${i}" onclick="openPicker(${i})">
            <div class="plus-icon">Ôºã</div>
            <div class="elixir-tag" id="elixir-${i}">0</div>
            <img id="img-${i}" src="">
          </div>
        `);
      }
    </script>
  </div>

  <div class="footer">
    <button class="btn-action" onclick="runAnalysis()">–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–∏–ª–¥</button>
  </div>
</div>

<div id="modal" class="modal" onclick="closePicker()">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-header">
      <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ –∫–∞—Ä—Ç—ã..." oninput="renderPicker()">
    </div>
    <div class="cards-grid" id="picker-grid"></div>
  </div>
</div>

<div id="result-screen" class="result-overlay">
  <div style="display:grid; grid-template-columns: repeat(8, 1fr); gap:4px; width:100%; margin-bottom:25px;" id="res-mini"></div>
  <div class="result-card">
    <div id="res-emoji" style="font-size: 70px; margin-bottom: 20px;"></div>
    <h2 id="res-title" style="margin: 0; color: var(--accent); font-size: 28px;"></h2>
    <p id="res-text" style="font-size: 16px; line-height: 1.6; opacity: 0.8; margin-top: 20px;"></p>
  </div>
  <button class="btn-action" style="margin-top: 40px; background: rgba(255,255,255,0.05);" onclick="location.reload()">–í–µ—Ä–Ω—É—Ç—å—Å—è</button>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

// –ü–û–õ–ù–ê–Ø –ë–ê–ó–ê –ö–ê–†–¢
const CARDS = [
  // WIN CONDITIONS
  {id:"hog-rider",n:"–•–æ–≥",e:4,t:"win"},{id:"balloon",n:"–®–∞—Ä",e:5,t:"win"},{id:"goblin-barrel",n:"–ë–æ—á–∫–∞",e:3,t:"win"},
  {id:"giant",n:"–ì–∏–≥–∞–Ω—Ç",e:5,t:"win"},{id:"royal-giant",n:"–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –≥–∏–≥–∞–Ω—Ç",e:6,t:"win"},{id:"golem",n:"–ì–æ–ª–µ–º",e:8,t:"win"},
  {id:"battle-ram",n:"–¢–∞—Ä–∞–Ω",e:4,t:"win"},{id:"ram-rider",n:"–í—Å–∞–¥–Ω–∏—Ü–∞",e:5,t:"win"},{id:"graveyard",n:"–ö–ª–∞–¥–±–∏—â–µ",e:5,t:"win"},
  {id:"sparky",n:"–°–ø–∞—Ä–∫–∏",e:6,t:"win"},{id:"electro-giant",n:"–≠–ª–µ–∫—Ç—Ä–æ–≥–∏–≥–∞–Ω—Ç",e:7,t:"win"},{id:"x-bow",n:"–ê—Ä–±–∞–ª–µ—Ç",e:6,t:"cancer"},
  {id:"mortar",n:"–ú–æ—Ä—Ç–∏—Ä–∞",e:4,t:"win"},{id:"miner",n:"–®–∞—Ö—Ç–µ—Ä",e:3,t:"win"},
  // SPELLS
  {id:"the-log",n:"–ë—Ä–µ–≤–Ω–æ",e:2,t:"spell"},{id:"arrows",n:"–°—Ç—Ä–µ–ª—ã",e:3,t:"spell"},{id:"fireball",n:"–§–∞–π–µ—Ä–±–æ–ª",e:4,t:"spell"},
  {id:"poison",n:"–Ø–¥",e:4,t:"spell"},{id:"zap",n:"–†–∞–∑—Ä—è–¥",e:2,t:"spell"},{id:"rocket",n:"–†–∞–∫–µ—Ç–∞",e:6,t:"spell"},
  {id:"tornado",n:"–¢–æ—Ä–Ω–∞–¥–æ",e:3,t:"spell"},{id:"earthquake",n:"–ó–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–µ",e:3,t:"spell"},{id:"freeze",n:"–ó–∞–º–æ—Ä–æ–∑–∫–∞",e:4,t:"spell"},
  // SUPPORT / DEFENSE
  {id:"mega-knight",n:"–ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—å",e:7,t:"mid"},{id:"pekka",n:"–ü–ï–ö–ö–ê",e:7,t:"heavy"},{id:"mini-pekka",n:"–ú–∏–Ω–∏ –ü–ï–ö–ö–ê",e:4,t:"def"},
  {id:"valkyrie",n:"–í–∞–ª—å–∫–∏—Ä–∏—è",e:4,t:"def"},{id:"knight",n:"–†—ã—Ü–∞—Ä—å",e:3,t:"def"},{id:"wizard",n:"–ú–∞–≥",e:5,t:"mid"},
  {id:"executioner",n:"–ü–∞–ª–∞—á",e:5,t:"def"},{id:"baby-dragon",n:"–î—Ä–∞–∫–æ–Ω—á–∏–∫",e:4,t:"sup"},{id:"musketeer",n:"–ú—É—à–∫–µ—Ç–µ—Ä",e:4,t:"sup"},
  {id:"electro-wizard",n:"–≠–ª–µ–∫—Ç—Ä–æ–º–∞–≥",e:4,t:"sup"},{id:"ice-wizard",n:"–õ–µ–¥—è–Ω–æ–π –º–∞–≥",e:3,t:"sup"},{id:"witch",n:"–í–µ–¥—å–º–∞",e:5,t:"mid"},
  {id:"night-witch",n:"–ù–æ—á–Ω–∞—è –≤–µ–¥—å–º–∞",e:4,t:"sup"},{id:"bandit",n:"–ë–∞–Ω–¥–∏—Ç–∫–∞",e:3,t:"sup"},{id:"ghost",n:"–ü—Ä–∏–∑—Ä–∞–∫",e:3,t:"sup"},
  {id:"inferno-dragon",n:"–ü–ª–∞–º–µ–Ω–Ω—ã–π",e:4,t:"def"},{id:"inferno-tower",n:"–ò–Ω—Ñ–µ—Ä–Ω–æ",e:5,t:"def"},{id:"cannon",n:"–ü—É—à–∫–∞",e:3,t:"def"},
  {id:"tesla",n:"–¢–µ—Å–ª–∞",e:4,t:"def"},{id:"elite-barbarians",n:"–≠–ª–∏—Ç–∫–∏",e:6,t:"mid"},{id:"skeletons",n:"–°–∫–µ–ª–µ—Ç—ã",e:1,t:"cycle"},
  {id:"ice-spirit",n:"–õ–µ–¥—è–Ω–æ–π –¥—É—Ö",e:1,t:"cycle"},{id:"electro-spirit",n:"–≠–ª–µ–∫—Ç—Ä–æ–¥—É—Ö",e:1,t:"cycle"},
  // CHAMPIONS
  {id:"little-prince",n:"–ú–∞–ª–µ–Ω—å–∫–∏–π –ø—Ä–∏–Ω—Ü",e:3,t:"sup"},{id:"monk",n:"–ú–æ–Ω–∞—Ö",e:5,t:"sup"},{id:"archer-queen",n:"–ö–æ—Ä–æ–ª–µ–≤–∞",e:5,t:"sup"}
];

let deck = Array(8).fill(null);
let activeSlot = null;

function openPicker(idx) {
  activeSlot = idx;
  document.getElementById('modal').style.display = 'flex';
  renderPicker();
  tg.HapticFeedback.impactOccurred('medium');
}

function closePicker() { document.getElementById('modal').style.display = 'none'; }

function renderPicker() {
  const q = document.getElementById('search').value.toLowerCase();
  const grid = document.getElementById('picker-grid');
  const used = deck.filter(c => c).map(c => c.id);

  grid.innerHTML = CARDS.filter(c => c.n.toLowerCase().includes(q)).map(c => `
    <div class="card-item ${used.includes(c.id) ? 'used' : ''}" onclick="selectCard('${c.id}')">
      <img src="https://royaleapi.github.io/cr-api-assets/cards/${c.id}.png">
    </div>
  `).join('');
}

function selectCard(id) {
  const card = CARDS.find(c => c.id === id);
  deck[activeSlot] = card;

  const slot = document.getElementById(`slot-${activeSlot}`);
  const img = document.getElementById(`img-${activeSlot}`);
  const elix = document.getElementById(`elixir-${activeSlot}`);

  // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
  slot.classList.remove('filled');
  void slot.offsetWidth; 
  
  img.src = `https://royaleapi.github.io/cr-api-assets/cards/${id}.png`;
  elix.innerText = card.e;
  slot.classList.add('filled');

  closePicker();
  tg.HapticFeedback.notificationOccurred('success');
}

function runAnalysis() {
  if (deck.includes(null)) return tg.showAlert("–í—ã–±–µ—Ä–∏ –≤—Å–µ 8 –∫–∞—Ä—Ç, —á—Ç–æ–±—ã —è –º–æ–≥ –∏—Ö –ø—Ä–æ–∂–∞—Ä–∏—Ç—å!");

  const avg = (deck.reduce((a,b) => a+b.e, 0) / 8).toFixed(1);
  const midCount = deck.filter(c => c.t === 'mid' || c.e >= 7).length;
  const spellCount = deck.filter(c => c.t === 'spell').length;
  const winCount = deck.filter(c => c.t === 'win' || c.t === 'cancer').length;

  let e, t, d;

  if (midCount >= 3 && avg > 4.4) {
    e = "ü§°"; t = "–ú–ò–î–õ–ê–î–î–ï–† –•–ï–†–û";
    d = `–°–ª—É—à–∞–π, —Ç–≤–æ—è –¥–µ–∫–∞ –∑–∞ ${avg} —ç–ª–∏–∫—Å–∏—Ä–∞ ‚Äî —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ –ø–∞–º—è—Ç–Ω–∏–∫ —Å–ø–∞–º—É –ú–µ–≥–∞—Ä—ã—Ü–∞—Ä–µ–º. –¢—ã –ª–∏–±–æ –æ—á–µ–Ω—å –≤–µ—Ä–∏—à—å –≤ —á—É–¥–æ, –ª–∏–±–æ –ø—Ä–æ—Å—Ç–æ –ª—é–±–∏—à—å —Å—Ç—Ä–∞–¥–∞—Ç—å. –ù–æ –≤ –¢–∏–∫–¢–æ–∫–µ –æ—Ü–µ–Ω—è—Ç!`;
  } else if (spellCount >= 2 && winCount >= 1 && avg >= 3.1 && avg <= 3.9) {
    e = "üî•"; t = "–°–û–õ–ò–î–ù–´–ô –í–´–ë–û–†";
    d = `–ë–ª–∏–Ω, –¥–∞–∂–µ –ø—Ä–∏–¥—Ä–∞—Ç—å—Å—è —Å–ª–æ–∂–Ω–æ. –í—Å—ë –ø–æ —É–º—É: –µ—Å—Ç—å —Ç–∞–Ω–∫, –µ—Å—Ç—å —Å–ø–µ–ª–ª—ã, —Å—Ä–µ–¥–Ω–∏–π —á–µ–∫ ${avg}. –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, —Ç—ã –ø—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª –¥–µ–∫—É —É —Ç–æ–ø–∞, –Ω–æ –≤–∫—É—Å —É —Ç–µ–±—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ –µ—Å—Ç—å!`;
  } else if (winCount === 0) {
    e = "ü§®"; t = "–ë–ï–ó–î–ê–†–ù–´–ô –î–ï–§";
    d = "–£ —Ç–µ–±—è 8 –∫–∞—Ä—Ç, –Ω–æ –Ω–∏ –æ–¥–Ω–∞ –Ω–µ —É–º–µ–µ—Ç –±–∏—Ç—å –ø–æ –±–∞—à–Ω—è–º. –¢—ã –ø–ª–∞–Ω–∏—Ä—É–µ—à—å –≤—ã–∏–≥—Ä–∞—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –∏–ª–∏ –∂–¥–µ—à—å, –ø–æ–∫–∞ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫ —É–º—Ä–µ—Ç –æ—Ç —Å—Ç–∞—Ä–æ—Å—Ç–∏? –î–æ–±–∞–≤—å –•–æ–≥–∞ –∏–ª–∏ –®–∞—Ä–∞!";
  } else if (avg < 2.9) {
    e = "‚ö°"; t = "–ü–û–¢–ù–´–ô –¶–ò–ö–õ–ï–†";
    d = `–°—Ä–µ–¥–Ω–∏–π —ç–ª–∏–∫—Å–∏—Ä ${avg}. –¢—ã –∏–∑ —Ç–µ—Ö, –∫—Ç–æ –∑–∞–∫–∏–¥—ã–≤–∞–µ—Ç –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ —Å–∫–µ–ª–µ—Ç–∞–º–∏ –¥–æ –∏–Ω—Ñ–∞—Ä–∫—Ç–∞. –ú–æ—â–Ω–æ, –ø–æ—Ç–Ω–æ, –∑–∞–¥—Ä–æ—Ç—Å–∫–∏. –£–≤–∞–∂–µ–Ω–∏–µ –∑–∞ —Å–∫–∏–ª–ª, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å.`;
  } else {
    e = "üßê"; t = "–ù–ò –†–´–ë–ê –ù–ò –ú–Ø–°–û";
    d = `–ë–∏–ª–¥ –∏–≥—Ä–∞–±–µ–ª—å–Ω—ã–π, –Ω–æ —Å–∫—É—á–Ω—ã–π –∫–∞–∫ —É—Ä–æ–∫–∏ –∏—Å—Ç–æ—Ä–∏–∏. –í—Ä–æ–¥–µ –≤—Å—ë –µ—Å—Ç—å, –Ω–æ –∏–∑—é–º–∏–Ω–∫–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç. –ò–≥—Ä–∞–π, –Ω–æ –Ω–∞ —Ç–æ–ø-1 –º–∏—Ä–∞ –Ω–µ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–π.`;
  }

  document.getElementById('res-emoji').innerText = e;
  document.getElementById('res-title').innerText = t;
  document.getElementById('res-text').innerText = d;
  document.getElementById('res-mini').innerHTML = deck.map(c => `<img src="https://royaleapi.github.io/cr-api-assets/cards/${c.id}.png" style="width:100%; border-radius:4px;">`).join('');
  
  document.getElementById('result-screen').style.display = 'flex';
  tg.HapticFeedback.notificationOccurred('warning');
}
</script>
</body>
</html>
