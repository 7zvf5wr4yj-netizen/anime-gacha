<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>CR: Deck Roast</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --cr-blue: #1e90ff;
      --cr-dark: #0f172a;
      --cr-gold: #fbbf24;
      --danger: #ef4444;
    }

    body {
      background: var(--cr-dark);
      color: #fff; font-family: 'Rubik', sans-serif;
      margin: 0; padding: 0; display: flex; flex-direction: column; height: 100vh;
    }

    .header {
      padding: 20px; text-align: center; background: rgba(255,255,255,0.05);
      border-bottom: 2px solid #334155;
    }

    /* –°–ï–¢–ö–ê –ö–û–õ–û–î–´ */
    .deck-grid {
      display: grid; grid-template-columns: repeat(4, 1fr);
      gap: 10px; padding: 20px;
    }

    .slot {
      aspect-ratio: 3/4; background: #1e293b; border-radius: 12px;
      border: 2px solid #334155; display: flex; align-items: center;
      justify-content: center; font-size: 10px; text-align: center;
      cursor: pointer; position: relative; transition: 0.2s;
    }

    .slot.active { border-color: var(--cr-blue); box-shadow: 0 0 15px var(--cr-blue); }
    .slot.filled { border-style: solid; background: #334155; }

    .elixir-badge {
      position: absolute; top: -5px; right: -5px;
      background: #f0f; color: white; border-radius: 50%;
      width: 20px; height: 20px; font-size: 11px;
      display: flex; align-items: center; justify-content: center; border: 2px solid #fff;
    }

    /* –°–ï–õ–ï–ö–¢–û–† –ö–ê–†–¢ */
    .card-picker {
      position: fixed; bottom: 0; left: 0; width: 100%; height: 50%;
      background: #1e293b; border-top: 4px solid var(--cr-blue);
      display: none; grid-template-columns: repeat(3, 1fr);
      overflow-y: auto; padding: 10px; gap: 10px; z-index: 100;
    }

    .picker-card {
      background: #0f172a; padding: 10px; border-radius: 8px;
      font-size: 12px; text-align: center; border: 1px solid #334155;
    }

    /* –ö–ù–û–ü–ö–ê –ê–ù–ê–õ–ò–ó–ê */
    .footer { padding: 20px; }
    .rate-btn {
      width: 100%; background: var(--cr-blue); border: none;
      padding: 20px; border-radius: 15px; color: white;
      font-size: 18px; font-weight: 900; letter-spacing: 1px;
      box-shadow: 0 4px 0 #0052a3;
    }
    .rate-btn:active { transform: translateY(4px); box-shadow: none; }

    /* –í–ï–†–î–ò–ö–¢ */
    .overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.95);
      display: none; flex-direction: column; align-items: center;
      justify-content: center; padding: 30px; z-index: 200; text-align: center;
    }
    .verdict-title { font-size: 40px; color: var(--cr-gold); margin: 0; }
    .verdict-text { font-size: 18px; margin: 20px 0; line-height: 1.4; }
  </style>
</head>
<body>

<div class="header">
  <h1 style="margin:0; font-size: 24px;">DECK CHECKER</h1>
  <p style="opacity:0.6; font-size:12px; margin:5px 0 0;">–í—ã–±–µ—Ä–∏ 8 –∫–∞—Ä—Ç, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –ø—Ä–∞–≤–¥—É</p>
</div>

<div class="deck-grid" id="deck-view">
  <div class="slot" onclick="openPicker(0)" id="s0">–í–´–ë–†–ê–¢–¨</div>
  <div class="slot" onclick="openPicker(1)" id="s1">–í–´–ë–†–ê–¢–¨</div>
  <div class="slot" onclick="openPicker(2)" id="s2">–í–´–ë–†–ê–¢–¨</div>
  <div class="slot" onclick="openPicker(3)" id="s3">–í–´–ë–†–ê–¢–¨</div>
  <div class="slot" onclick="openPicker(4)" id="s4">–í–´–ë–†–ê–¢–¨</div>
  <div class="slot" onclick="openPicker(5)" id="s5">–í–´–ë–†–ê–¢–¨</div>
  <div class="slot" onclick="openPicker(6)" id="s6">–í–´–ë–†–ê–¢–¨</div>
  <div class="slot" onclick="openPicker(7)" id="s7">–í–´–ë–†–ê–¢–¨</div>
</div>

<div class="footer">
  <button class="rate-btn" onclick="analyze()">–û–¶–ï–ù–ò–¢–¨ –ì–û–í–ù–û–ü–ò–ö</button>
</div>

<div class="card-picker" id="picker">
  </div>

<div class="overlay" id="result-overlay">
  <div style="font-size: 60px;">ü§°</div>
  <h2 class="verdict-title" id="v-title">–ö–õ–û–£–ù</h2>
  <p class="verdict-text" id="v-text"></p>
  <button class="rate-btn" style="background:#444; box-shadow: 0 4px 0 #222;" onclick="closeResult()">–ü–û–ù–Ø–õ, –Ø –¢–£–ü–û–ô</button>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

const CARDS = [
  { n: "–ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—å", e: 7, t: "midladder" },
  { n: "–í—Å–∞–¥–Ω–∏–∫ –Ω–∞ –∫–∞–±–∞–Ω–µ", e: 4, t: "wincon" },
  { n: "–ü.–ï.–ö.–ö.–ê", e: 7, t: "heavy" },
  { n: "–ë—Ä–µ–≤–Ω–æ", e: 2, t: "spell" },
  { n: "–û–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä", e: 4, t: "spell" },
  { n: "–Ø–¥", e: 4, t: "spell" },
  { n: "–≠–ª–∏—Ç–Ω—ã–µ –≤–∞—Ä–≤–∞—Ä—ã", e: 6, t: "cancer" },
  { n: "–ì–æ–±–ª–∏–Ω—Å–∫–∞—è –±–æ—á–∫–∞", e: 3, t: "bait" },
  { n: "–ê–¥—Å–∫–∞—è –±–∞—à–Ω—è", e: 5, t: "def" },
  { n: "–ê—Ä–º–∏—è —Å–∫–µ–ª–µ—Ç–æ–≤", e: 3, t: "swarm" },
  { n: "–õ–µ–¥—è–Ω–æ–π –¥—É—Ö", e: 1, t: "cycle" },
  { n: "–ì–æ–ª–µ–º", e: 8, t: "heavy" },
  { n: "–®–∞—Ä", e: 5, t: "wincon" },
  { n: "–ú–∞–ª–µ–Ω—å–∫–∏–π –¥—Ä–∞–∫–æ–Ω", e: 4, t: "support" }
];

let selectedIndex = null;
let deck = [null, null, null, null, null, null, null, null];

function openPicker(index) {
  selectedIndex = index;
  const picker = document.getElementById('picker');
  picker.style.display = 'grid';
  picker.innerHTML = CARDS.map(c => `
    <div class="picker-card" onclick="selectCard('${c.n}')">
      ${c.n} <br> <span style="color:#f0f">${c.e}üíß</span>
    </div>
  `).join('');
}

function selectCard(cardName) {
  const card = CARDS.find(c => c.n === cardName);
  deck[selectedIndex] = card;
  
  const slot = document.getElementById(`s${selectedIndex}`);
  slot.innerHTML = `<div class="elixir-badge">${card.e}</div>${card.n}`;
  slot.classList.add('filled');
  
  document.getElementById('picker').style.display = 'none';
  tg.HapticFeedback.selectionChanged();
}

function analyze() {
  if (deck.includes(null)) {
    tg.showAlert("–¢—ã —á—ë, –¥–µ–±–∏–ª? –ó–∞–ø–æ–ª–Ω–∏ –≤—Å–µ 8 —Å–ª–æ—Ç–æ–≤!");
    return;
  }

  let avg = deck.reduce((a, b) => a + b.e, 0) / 8;
  let hasMidladder = deck.some(c => c.t === 'midladder' || c.t === 'cancer');
  let hasSpell = deck.some(c => c.t === 'spell');
  let wincons = deck.filter(c => c.t === 'wincon' || c.t === 'bait').length;

  let title = "";
  let text = "";
  let emoji = "ü§î";

  if (hasMidladder && avg > 4.2) {
    emoji = "ü§°";
    title = "–ö–£–°–û–ö –ú–ò–î–õ–ê–î–î–ï–†–ê";
    text = `–¢–≤–æ–π —Å—Ä–µ–¥–Ω–∏–π —ç–ª–∏–∫—Å–∏—Ä ${avg.toFixed(1)}, —Ç—ã —Ç–∞–º —á—ë, –ø–æ–¥ —Å–ø–∞–π—Å–æ–º? –ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—å –∏ –≠–ª–∏—Ç–∫–∏ ‚Äî —ç—Ç–æ –Ω–µ –∫–æ–ª–æ–¥–∞, —ç—Ç–æ –¥–∏–∞–≥–Ω–æ–∑. –¢–µ–±—è –ª—é–±–æ–π 2.6 —Ä–∞–∑–Ω–µ—Å–µ—Ç –≤ —Å—É—Ö—É—é, –ø–æ–∫–∞ —Ç—ã –±—É–¥–µ—à—å –∫–æ–ø–∏—Ç—å –Ω–∞ —Å–≤–æ–π –º—É—Å–æ—Ä.`;
  } else if (wincons === 0) {
    emoji = "ü§®";
    title = "–ê –ß–ï–ú –¢–´–ö–ê–¢–¨?";
    text = "–£ —Ç–µ–±—è –≤ –∫–æ–ª–æ–¥–µ 0 —É—Å–ª–æ–≤–∏–π –ø–æ–±–µ–¥—ã. –¢—ã –∫–∞–∫ —Å–æ–±—Ä–∞–ª—Å—è –±–∞—à–Ω–∏ —Å–Ω–æ—Å–∏—Ç—å? –ú–æ–ª–∏—Ç–≤–∞–º–∏? –î–æ–±–∞–≤—å –•–æ–≥–∞ –∏–ª–∏ –ë–æ—á–∫—É, –Ω–µ –ø–æ–∑–æ—Ä—å—Å—è.";
  } else if (!hasSpell) {
    emoji = "ü§¨";
    title = "–ì–î–ï –°–ü–ï–õ–õ–´?";
    text = "–ù–∏ –æ–¥–Ω–æ–≥–æ –∑–∞–∫–ª–∏–Ω–∞–Ω–∏—è. –ñ–µ–ª–∞—é —É–¥–∞—á–∏ —Å–º–æ—Ç—Ä–µ—Ç—å, –∫–∞–∫ —Ç–µ–±—è –¥–µ—Ñ–∞–µ—Ç –æ–¥–Ω–∞ –ø–∞—á–∫–∞ —Å–∫–µ–ª–µ—Ç–æ–≤, –∞ —Ç—ã –Ω–∏—á–µ–≥–æ –Ω–µ –º–æ–∂–µ—à—å —Å–¥–µ–ª–∞—Ç—å. –ë—Ä–µ–≤–Ω–æ —Ö–æ—Ç—è –±—ã –≤–æ–∑—å–º–∏, –æ–≤–æ—â.";
  } else if (avg < 3.0) {
    emoji = "‚ö°";
    title = "–ö–ò–ë–ï–†–ö–û–¢–õ–ï–¢–ê";
    text = `–°—Ä–µ–¥–Ω–∏–π —ç–ª–∏–∫—Å–∏—Ä ${avg.toFixed(1)}. –õ–∏–±–æ —Ç—ã –±–æ–≥ —Ü–∏–∫–ª–∞, –ª–∏–±–æ —Ç—ã –ø—Ä–æ—Å—Ç–æ –¥—Ä–æ—á–∏—à—å –∫–∞—Ä—Ç—É –∑–∞ –∫–∞—Ä—Ç–æ–π –±–µ–∑ —Å–º—ã—Å–ª–∞. –ï—Å–ª–∏ –Ω–µ —É–º–µ–µ—à—å –≤ —Å–∫–∏–ª–ª ‚Äî —ç—Ç–∞ –∫–æ–ª–æ–¥–∞ —Ç–µ–±—è –ø–æ—Ö–æ—Ä–æ–Ω–∏—Ç.`;
  } else {
    emoji = "üòé";
    title = "–ì–ò–ì–ê–ß–ê–î";
    text = "–°–ª—É—à–∞–π, –∞ —Ç—ã –Ω–µ–ø–ª–æ—Ö. –ë–∞–ª–∞–Ω—Å –µ—Å—Ç—å, –≤–∏–Ω–∫–æ–Ω –Ω–∞ –º–µ—Å—Ç–µ. –õ–∏–±–æ —Ç—ã —É–∫—Ä–∞–ª —ç—Ç—É –¥–µ–∫—É —É –ø—Ä–æ—Ñ–∏–∫–æ–≤, –ª–∏–±–æ —É —Ç–µ–±—è —Ä–µ–∞–ª—å–Ω–æ –µ—Å—Ç—å –º–æ–∑–≥. –ò–¥–∏ –∏ –ª–æ–º–∞–π –∫–∞–±–∏–Ω—ã.";
  }

  document.getElementById('v-title').innerText = title;
  document.getElementById('v-text').innerText = text;
  document.getElementById('result-overlay').querySelector('div').innerText = emoji;
  document.getElementById('result-overlay').style.display = 'flex';
  tg.HapticFeedback.notificationOccurred('warning');
}

function closeResult() {
  document.getElementById('result-overlay').style.display = 'none';
}
</script>
</body>
</html>
