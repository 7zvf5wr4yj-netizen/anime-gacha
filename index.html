<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ReseitCards: RNG</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #030308;
      --card-bg: rgba(15, 15, 25, 0.8);
      --neon-blue: #00f3ff;
      --neon-purple: #bc00ff;
      --neon-gold: #ffcc00;
      --neon-red: #ff004c;
    }

    body {
      background-color: var(--bg);
      color: #fff;
      font-family: 'Rajdhani', sans-serif;
      margin: 0; padding: 0;
      overflow: hidden;
      height: 100vh;
    }

    /* –§–æ–Ω–æ–≤—ã–µ —á–∞—Å—Ç–∏—Ü—ã (–∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ) */
    .bg-animation {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: radial-gradient(circle at center, #11112b 0%, #030308 100%);
      z-index: -1;
    }

    .app-container {
      display: flex; flex-direction: column; height: 100vh;
      padding: 20px; box-sizing: border-box;
    }

    /* –í–µ—Ä—Ö–Ω—è—è –ø–∞–Ω–µ–ª—å */
    .top-nav {
      display: flex; justify-content: space-between; align-items: center;
      background: var(--card-bg);
      padding: 15px; border-radius: 15px;
      border: 1px solid rgba(255,255,255,0.05);
      backdrop-filter: blur(10px);
    }

    .currency { display: flex; align-items: center; gap: 8px; font-family: 'Orbitron'; font-size: 18px; color: var(--neon-blue); text-shadow: 0 0 10px var(--neon-blue); }

    /* –ó–æ–Ω–∞ —Ä–æ–ª–ª–∞ (Sol's RNG Style) */
    .roll-area {
      flex-grow: 1;
      display: flex; flex-direction: column; align-items: center;
      justify-content: center; position: relative;
    }

    .chance-counter {
      font-family: 'Orbitron'; font-size: 14px; color: rgba(255,255,255,0.4);
      margin-bottom: 10px; text-transform: uppercase; letter-spacing: 2px;
    }

    #result-display {
      text-align: center; transition: 0.3s;
    }

    .hero-name {
      font-size: 42px; font-weight: 700; text-transform: uppercase;
      margin: 5px 0; letter-spacing: -1px; line-height: 1;
    }

    .rarity-label {
      font-size: 18px; font-family: 'Orbitron'; text-shadow: 0 0 15px currentColor;
    }

    /* –ê–Ω–∏–º–∞—Ü–∏—è —Ç—Ä—è—Å–∫–∏ —ç–∫—Ä–∞–Ω–∞ */
    .shake { animation: shakeAnim 0.1s infinite; }
    @keyframes shakeAnim {
      0% { transform: translate(1px, 1px) rotate(0deg); }
      50% { transform: translate(-1px, -2px) rotate(-1deg); }
      100% { transform: translate(1px, 2px) rotate(1deg); }
    }

    /* –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */
    .bottom-menu {
      display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: auto;
    }

    .menu-btn {
      background: var(--card-bg); border: 1px solid rgba(255,255,255,0.1);
      padding: 15px 5px; border-radius: 12px; color: #fff;
      font-family: 'Orbitron'; font-size: 11px; cursor: pointer;
      transition: 0.2s; text-align: center;
    }

    .menu-btn:active { transform: scale(0.9); border-color: var(--neon-blue); }

    .roll-btn {
      grid-column: span 3;
      background: linear-gradient(90deg, #004e92, #000428);
      border: 2px solid var(--neon-blue);
      box-shadow: 0 0 20px rgba(0, 243, 255, 0.4);
      font-size: 20px; font-weight: bold; margin-bottom: 10px;
    }

    /* –≠—Ñ—Ñ–µ–∫—Ç—ã —Ä–µ–¥–∫–æ—Å—Ç–µ–π */
    .rarity-COMMON { color: #ccc; }
    .rarity-RARE { color: #00f3ff; }
    .rarity-EPIC { color: #bc00ff; }
    .rarity-LEGENDARY { color: #ffcc00; animation: glowGold 1s infinite alternate; }
    .rarity-MYTHIC { color: #ff004c; animation: shakeAnim 0.2s infinite; }
    .rarity-DIVINE { background: linear-gradient(90deg, #ff00cc, #3333ff, #13ff62, #ffcc00); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 50px; }

    @keyframes glowGold { from { text-shadow: 0 0 10px #ffcc00; } to { text-shadow: 0 0 30px #ffcc00, 0 0 50px #ff8800; } }

    /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å Overlay */
    #inventory-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      background: var(--bg); z-index: 100; display: none; padding: 20px; box-sizing: border-box;
      overflow-y: auto;
    }
  </style>
</head>
<body>
  <div class="bg-animation"></div>
  
  <div class="app-container" id="main-ui">
    <div class="top-nav">
      <div class="currency">üíé <span id="diamonds">0</span></div>
      <div style="text-align: right">
        <div style="font-size: 10px; opacity: 0.5;">POWER</div>
        <div id="power-val" style="font-weight: bold;">0</div>
      </div>
    </div>

    <div class="roll-area" id="screen">
      <div class="chance-counter" id="chance-text">READY TO ROLL</div>
      <div id="result-display">
        <div class="rarity-label rarity-COMMON" id="res-rarity">...</div>
        <div class="hero-name" id="res-name">????</div>
      </div>
    </div>

    <div class="bottom-menu">
      <button class="menu-btn roll-btn" onclick="performRoll()">ROLL</button>
      <button class="menu-btn" onclick="toggleInv(true)">INVENTORY</button>
      <button class="menu-btn">ARENA</button>
      <button class="menu-btn">SHOP</button>
    </div>
  </div>

  <div id="inventory-overlay">
    <div style="display:flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h2 style="font-family: Orbitron;">STORAGE</h2>
      <button class="menu-btn" onclick="toggleInv(false)">CLOSE</button>
    </div>
    <div id="inv-list" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;"></div>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    // –ë–∞–∑–∞ –≥–µ—Ä–æ–µ–≤ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —à–∞–Ω—Å–∞–º–∏ (1 –∫ N)
    const HEROES = [
      { name: "Slime", chance: 2, rarity: "COMMON" },
      { name: "Ninja", chance: 10, rarity: "RARE" },
      { name: "Ichigo", chance: 50, rarity: "RARE" },
      { name: "Naruto", chance: 250, rarity: "EPIC" },
      { name: "Gojo", chance: 1000, rarity: "LEGENDARY" },
      { name: "Sukuna", chance: 5000, rarity: "LEGENDARY" },
      { name: "Saitama", chance: 50000, rarity: "MYTHIC" },
      { name: "Madara", chance: 250000, rarity: "MYTHIC" },
      { name: "Sung Jin-Woo", chance: 1000000, rarity: "DIVINE" }
    ];

    let state = JSON.parse(localStorage.getItem('reseit_rng_v2')) || {
      diamonds: 500,
      inventory: [],
      totalPower: 0
    };

    function save() { localStorage.setItem('reseit_rng_v2', JSON.stringify(state)); }

    function updateUI() {
      document.getElementById('diamonds').innerText = state.diamonds.toLocaleString();
      document.getElementById('power-val').innerText = state.totalPower.toLocaleString();
    }

    function toggleInv(show) {
      const el = document.getElementById('inventory-overlay');
      el.style.display = show ? 'block' : 'none';
      if(show) {
        const list = document.getElementById('inv-list');
        list.innerHTML = state.inventory.slice().reverse().map(item => `
          <div style="background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px; border-left: 3px solid #00f3ff">
            <div style="font-size: 12px; opacity: 0.6">1 –∫ ${item.chance.toLocaleString()}</div>
            <div style="font-weight: bold; font-size: 16px">${item.name}</div>
          </div>
        `).join('');
      }
    }

    function performRoll() {
      if(state.diamonds < 10) {
        tg.showAlert("Not enough diamonds!"); return;
      }

      state.diamonds -= 10;
      updateUI();
      
      const screen = document.getElementById('screen');
      const chanceText = document.getElementById('chance-text');
      const resName = document.getElementById('res-name');
      const resRarity = document.getElementById('res-rarity');
      
      // –ê–Ω–∏–º–∞—Ü–∏—è —Å—Ç–∞—Ä—Ç–∞
      tg.HapticFeedback.impactOccurred('medium');
      screen.classList.add('shake');
      chanceText.innerText = "ROLLING...";
      resName.innerText = "???";
      resName.style.opacity = "0.3";
      
      // –†–∞—Å—Å—á–µ—Ç –≤—ã–ø–∞–¥–µ–Ω–∏—è (–Ω–∞—á–∏–Ω–∞–µ–º —Å —Å–∞–º—ã—Ö —Ä–µ–¥–∫–∏—Ö)
      let rolledHero = HEROES[0];
      let rand = Math.random();
      
      const sortedHeroes = [...HEROES].sort((a,b) => b.chance - a.chance);
      for(let hero of sortedHeroes) {
        if(Math.random() < (1 / hero.chance)) {
          rolledHero = hero;
          break;
        }
      }

      // –ó–∞–¥–µ—Ä–∂–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ (–∫–∞–∫ –≤ Sol's RNG)
      setTimeout(() => {
        screen.classList.remove('shake');
        resName.style.opacity = "1";
        
        chanceText.innerText = `LUCK: 1 –∫ ${rolledHero.chance.toLocaleString()}`;
        resName.innerText = rolledHero.name;
        resName.className = `hero-name rarity-${rolledHero.rarity}`;
        resRarity.innerText = rolledHero.rarity;
        resRarity.className = `rarity-label rarity-${rolledHero.rarity}`;

        // –≠—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è —Ä–µ–¥–∫–∏—Ö
        if(rolledHero.chance >= 1000) {
          tg.HapticFeedback.notificationOccurred('success');
          // –î–æ–±–∞–≤–∏—Ç—å –≤—Å–ø—ã—à–∫—É —ç–∫—Ä–∞–Ω–∞ –º–æ–∂–Ω–æ —Ç—É—Ç
          screen.style.background = "radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%)";
          setTimeout(() => screen.style.background = "none", 500);
        }

        state.inventory.push(rolledHero);
        state.totalPower += Math.floor(rolledHero.chance / 10);
        save();
        updateUI();
      }, 800);
    }

    updateUI();
  </script>
</body>
</html>
