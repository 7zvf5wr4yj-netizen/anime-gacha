<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anime Gacha Empire</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: white;
  text-align: center;
}

button {
  padding: 10px 20px;
  margin: 10px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: bold;
  background: #2563eb;
  color: white;
}
.card {
  background: #1e293b;
  padding: 15px;
  margin: 10px;
  border-radius: 10px;
}
</style>
</head>

<body>
<div id="app"></div>

<script>

const RARITIES = {
  COMMON: { name: "–û–±—ã—á–Ω–∞—è", chance: 6000, mult: 1 },
  RARE: { name: "–†–µ–¥–∫–∞—è", chance: 3000, mult: 2.5 },
  EPIC: { name: "–≠–ø–∏—á–µ—Å–∫–∞—è", chance: 800, mult: 5 },
  LEGEND: { name: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è", chance: 180, mult: 8 },
  DIVINE: { name: "–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è", chance: 20, mult: 15 }
};

const UNIVERSES = {
  "JUJUTSU KAISEN": ["–ì–æ–¥–∑—ë", "–ì—ç—Ç–æ", "–ò—Ç–∞–¥–æ—Ä–∏", "–ù–æ–±–∞—Ä–∞"],
  "EVANGELION": ["–†—ç–π", "–ê—Å–∫–∞", "–°–∏–Ω–¥–∑–∏", "–ö–∞–≤–æ—Ä—É"]
};

let user = {
  diamonds: 1500,
  power: 0,
  universe: "JUJUTSU KAISEN",
  inventory: []
};

let currentView = "main";

function render() {
  const app = document.getElementById("app");

  if (currentView === "main") {
    app.innerHTML = `
      <h1>Anime Gacha Empire</h1>
      <p>üíé –ê–ª–º–∞–∑—ã: ${user.diamonds}</p>
      <p>‚ö° –ú–æ—â—å: ${user.power}</p>
      <button id="btnRoll">–ü—Ä–∏–∑—ã–≤</button>
      <button id="btnInventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
    `;

    document.getElementById("btnRoll").addEventListener("click", goRoll);
    document.getElementById("btnInventory").addEventListener("click", goInventory);
  }

  if (currentView === "roll") {
    app.innerHTML = `
      <h2>–ü—Ä–∏–∑—ã–≤ —Å—Ç–æ–∏—Ç 100 –∞–ª–º–∞–∑–æ–≤</h2>
      <button id="btnActivate">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
      <button id="btnBack">–ù–∞–∑–∞–¥</button>
    `;

    document.getElementById("btnActivate").addEventListener("click", performRoll);
    document.getElementById("btnBack").addEventListener("click", goMain);
  }

  if (currentView === "inventory") {
    let cardsHTML = "";

    if (user.inventory.length === 0) {
      cardsHTML = "<p>–ü—É—Å—Ç–æ</p>";
    } else {
      user.inventory.forEach(card => {
        cardsHTML += `
          <div class="card">
            <strong>${card.name}</strong><br>
            ${card.rarity}<br>
            ‚ö° ${card.power} | ‚ù§Ô∏è ${card.hp}
          </div>
        `;
      });
    }

    app.innerHTML = `
      <h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
      ${cardsHTML}
      <button id="btnBack">–ù–∞–∑–∞–¥</button>
    `;

    document.getElementById("btnBack").addEventListener("click", goMain);
  }
}

function performRoll() {
  if (user.diamonds < 100) {
    alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–ª–º–∞–∑–æ–≤");
    return;
  }

  user.diamonds -= 100;

  const rng = Math.floor(Math.random() * 10000);
  let cumulative = 0;
  let rarityKey = "COMMON";

  for (let key in RARITIES) {
    cumulative += RARITIES[key].chance;
    if (rng <= cumulative) {
      rarityKey = key;
      break;
    }
  }

  const names = UNIVERSES[user.universe];
  const name = names[Math.floor(Math.random() * names.length)];
  const rarity = RARITIES[rarityKey];

  const newCard = {
    id: Date.now(),
    name: name,
    rarity: rarity.name,
    power: Math.floor((Math.random() * 100 + 50) * rarity.mult),
    hp: Math.floor((Math.random() * 200 + 100) * rarity.mult)
  };

  user.inventory.push(newCard);
  user.power += newCard.power;

  alert("–í—ã–ø–∞–ª–∞ –∫–∞—Ä—Ç–∞: " + name + " (" + rarity.name + ")");
  render();
}

function goMain() {
  currentView = "main";
  render();
}

function goRoll() {
  currentView = "roll";
  render();
}

function goInventory() {
  currentView = "inventory";
  render();
}

if (window.Telegram && window.Telegram.WebApp) {
  Telegram.WebApp.ready();
  Telegram.WebApp.expand();
}

render();

</script>
</body>
</html>
