<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>CR: Master Analyst Pro</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #05070a;
      --accent: #00f2ff;
      --glass: rgba(255, 255, 255, 0.05);
      --border: rgba(255, 255, 255, 0.1);
    }

    body {
      background: var(--bg); color: #fff; font-family: 'Outfit', sans-serif;
      margin: 0; padding: 0; height: 100vh; overflow: hidden;
      background: radial-gradient(circle at 50% 0%, #111827 0%, #05070a 100%);
    }

    .app { display: flex; flex-direction: column; height: 100%; max-width: 500px; margin: 0 auto; }

    .header { padding: 20px; text-align: center; }
    .header h1 { margin: 0; font-size: 22px; font-weight: 900; background: linear-gradient(90deg, #00f2ff, #fff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .header p { font-size: 9px; opacity: 0.5; letter-spacing: 2px; margin-top: 5px; }

    /* GRID */
    .deck-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; padding: 10px 15px; }

    .slot {
      aspect-ratio: 1/1.25; background: var(--glass); border: 1px solid var(--border);
      border-radius: 14px; display: flex; align-items: center; justify-content: center;
      position: relative; transition: 0.2s; cursor: pointer;
    }
    .slot.filled { border-color: var(--accent); box-shadow: 0 0 15px rgba(0, 242, 255, 0.15); }
    .slot img { width: 90%; height: 90%; object-fit: contain; display: none; }
    .slot.filled img { display: block; animation: popIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }

    @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }

    .elixir-badge {
      position: absolute; top: -5px; right: -5px; background: linear-gradient(135deg, #f0f, #80f);
      color: #fff; border-radius: 6px; width: 20px; height: 20px; font-size: 10px;
      font-weight: 900; display: none; align-items: center; justify-content: center; border: 1px solid #fff;
    }
    .slot.filled .elixir-badge { display: flex; }

    /* MODAL */
    .modal {
      position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 1000;
      display: none; flex-direction: column; backdrop-filter: blur(10px);
    }
    .modal-content {
      margin-top: auto; background: #0f172a; border-top: 2px solid var(--accent);
      border-radius: 25px 25px 0 0; height: 80vh; display: flex; flex-direction: column;
    }
    .modal-header { padding: 20px; border-bottom: 1px solid var(--border); display: flex; gap: 10px; }
    #search { flex: 1; background: #1e293b; border: 1px solid var(--border); padding: 12px; border-radius: 10px; color: #fff; }

    .cards-list { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 20px; overflow-y: auto; }
    .card-item { transition: 0.2s; position: relative; }
    .card-item img { width: 100%; border-radius: 8px; }
    .card-item.selected { opacity: 0.3; pointer-events: none; }

    /* ACTION SHEET (–£–î–ê–õ–ï–ù–ò–ï) */
    .sheet {
      position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 2000;
      display: none; align-items: flex-end;
    }
    .sheet-body { background: #1e293b; width: 100%; border-radius: 20px 20px 0 0; padding: 20px; }
    .sheet-btn { width: 100%; padding: 15px; border-radius: 12px; border: none; font-weight: 700; margin-bottom: 10px; font-family: 'Outfit'; font-size: 16px; }

    .footer { padding: 20px; }
    .btn-analyze {
      width: 100%; padding: 18px; border-radius: 16px; border: none;
      background: linear-gradient(90deg, #3b82f6, #00f2ff);
      color: #fff; font-weight: 900; font-size: 16px; text-transform: uppercase;
    }

    /* RESULT */
    .result-view { position: fixed; inset: 0; background: var(--bg); z-index: 3000; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; text-align: center; }
  </style>
</head>
<body>

<div class="app">
  <div class="header">
    <h1>DECK MASTER</h1>
    <p>VERSION 4.0 ‚Ä¢ FULL ROSTER</p>
  </div>

  <div class="deck-grid" id="grid">
    <script>
      for(let i=0; i<8; i++) {
        document.write(`
          <div class="slot" id="s${i}" onclick="handleSlotClick(${i})">
            <span style="opacity:0.2" id="p${i}">Ôºã</span>
            <div class="elixir-badge" id="e${i}"></div>
            <img id="img${i}" src="">
          </div>
        `);
      }
    </script>
  </div>

  <div class="footer">
    <button class="btn-analyze" onclick="analyze()">–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –±–∏–ª–¥</button>
  </div>
</div>

<div id="modal" class="modal" onclick="closeModal()">
  <div class="modal-content" onclick="event.stopPropagation()">
    <div class="modal-header">
      <input type="text" id="search" placeholder="–ü–æ–∏—Å–∫ (–Ω–∞–ø—Ä. —Ö–æ–≥, –ø–µ–∫–∫–∞)..." oninput="renderCards()">
      <button onclick="closeModal()" style="background:none; border:none; color:#fff; font-size:20px;">‚úï</button>
    </div>
    <div class="cards-list" id="card-list"></div>
  </div>
</div>

<div id="sheet" class="sheet" onclick="closeSheet()">
  <div class="sheet-body" onclick="event.stopPropagation()">
    <button class="sheet-btn" style="background:var(--accent); color:#000;" onclick="openPicker(lastIdx)">–ó–∞–º–µ–Ω–∏—Ç—å –∫–∞—Ä—Ç—É</button>
    <button class="sheet-btn" style="background:#ef4444; color:#fff;" onclick="removeCard()">–û—á–∏—Å—Ç–∏—Ç—å —Å–ª–æ—Ç</button>
    <button class="sheet-btn" style="background:#334155; color:#fff;" onclick="closeSheet()">–û—Ç–º–µ–Ω–∞</button>
  </div>
</div>

<div id="result" class="result-view">
  <div id="res-grid" style="display:grid; grid-template-columns: repeat(8, 1fr); gap:4px; width:100%; margin-bottom:20px;"></div>
  <div style="background:var(--glass); padding:30px; border-radius:20px; border:1px solid var(--border); width:100%; box-sizing:border-box;">
    <div id="v-emoji" style="font-size:60px;"></div>
    <h2 id="v-title" style="color:var(--accent)"></h2>
    <p id="v-text"></p>
  </div>
  <button class="btn-analyze" style="margin-top:30px; background:#334155;" onclick="location.reload()">–ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å</button>
</div>

<script>
const tg = window.Telegram.WebApp;
tg.expand();

// –ë–ê–ó–ê –î–ê–ù–ù–´–• - –í–°–ï –ö–ê–†–¢–´ (110 —à—Ç—É–∫)
const ALL_CARDS = [
  {id:"hog-rider",n:"–•–æ–≥",e:4,t:"win"},{id:"balloon",n:"–®–∞—Ä",e:5,t:"win"},{id:"goblin-barrel",n:"–ë–æ—á–∫–∞",e:3,t:"win"},
  {id:"mega-knight",n:"–ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—å",e:7,t:"mid"},{id:"pekka",n:"–ü–ï–ö–ö–ê",e:7,t:"heavy"},{id:"mini-pekka",n:"–ú–∏–Ω–∏ –ü–ï–ö–ö–ê",e:4,t:"heavy"},
  {id:"the-log",n:"–ë—Ä–µ–≤–Ω–æ",e:2,t:"spell"},{id:"fireball",n:"–§–∞–π–µ—Ä–±–æ–ª",e:4,t:"spell"},{id:"arrows",n:"–°—Ç—Ä–µ–ª—ã",e:3,t:"spell"},
  {id:"zap",n:"–†–∞–∑—Ä—è–¥",e:2,t:"spell"},{id:"poison",n:"–Ø–¥",e:4,t:"spell"},{id:"rocket",n:"–†–∞–∫–µ—Ç–∞",e:6,t:"spell"},
  {id:"lightning",n:"–ú–æ–ª–Ω–∏—è",e:6,t:"spell"},{id:"earthquake",n:"–ó–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–µ",e:3,t:"spell"},{id:"tornado",n:"–¢–æ—Ä–Ω–∞–¥–æ",e:3,t:"spell"},
  {id:"valkyrie",n:"–í–∞–ª—å–∫–∏—Ä–∏—è",e:4,t:"def"},{id:"knight",n:"–†—ã—Ü–∞—Ä—å",e:3,t:"def"},{id:"ice-golem",n:"–õ–µ–¥—è–Ω–æ–π –≥–æ–ª–µ–º",e:2,t:"def"},
  {id:"giant",n:"–ì–∏–≥–∞–Ω—Ç",e:5,t:"win"},{id:"royal-giant",n:"–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∏–π –≥–∏–≥–∞–Ω—Ç",e:6,t:"win"},{id:"golem",n:"–ì–æ–ª–µ–º",e:8,t:"win"},
  {id:"electro-giant",n:"–≠–ª–µ–∫—Ç—Ä–æ–≥–∏–≥–∞–Ω—Ç",e:7,t:"win"},{id:"x-bow",n:"–ê—Ä–±–∞–ª–µ—Ç",e:6,t:"cancer"},{id:"mortar",n:"–ú–æ—Ä—Ç–∏—Ä–∞",e:4,t:"win"},
  {id:"wizard",n:"–ú–∞–≥",e:5,t:"mid"},{id:"ice-wizard",n:"–õ–µ–¥—è–Ω–æ–π –º–∞–≥",e:3,t:"sup"},{id:"electro-wizard",n:"–≠–ª–µ–∫—Ç—Ä–æ–º–∞–≥",e:4,t:"sup"},
  {id:"musketeer",n:"–ú—É—à–∫–µ—Ç–µ—Ä",e:4,t:"sup"},{id:"three-musketeers",n:"–¢—Ä–∏ –º—É—à–∫–µ—Ç–µ—Ä–∞",e:9,t:"heavy"},{id:"witch",n:"–í–µ–¥—å–º–∞",e:5,t:"mid"},
  {id:"night-witch",n:"–ù–æ—á–Ω–∞—è –≤–µ–¥—å–º–∞",e:4,t:"sup"},{id:"bandit",n:"–ë–∞–Ω–¥–∏—Ç–∫–∞",e:3,t:"sup"},{id:"ghost",n:"–ü—Ä–∏–∑—Ä–∞–∫",e:3,t:"sup"},
  {id:"lumberjack",n:"–î—Ä–æ–≤–æ—Å–µ–∫",e:4,t:"heavy"},{id:"inferno-dragon",n:"–ü–ª–∞–º–µ–Ω–Ω—ã–π",e:4,t:"def"},{id:"baby-dragon",n:"–î—Ä–∞–∫–æ–Ω—á–∏–∫",e:4,t:"sup"},
  {id:"executioner",n:"–ü–∞–ª–∞—á",e:5,t:"def"},{id:"bowler",n:"–í—ã—à–∏–±–∞–ª–∞",e:5,t:"def"},{id:"sparky",n:"–°–ø–∞—Ä–∫–∏",e:6,t:"win"},
  {id:"miner",n:"–®–∞—Ö—Ç–µ—Ä",e:3,t:"win"},{id:"princess",n:"–ü—Ä–∏–Ω—Ü–µ—Å—Å–∞",e:3,t:"win"},{id:"ram-rider",n:"–í—Å–∞–¥–Ω–∏—Ü–∞",e:5,t:"win"},
  {id:"battle-ram",n:"–¢–∞—Ä–∞–Ω",e:4,t:"win"},{id:"elite-barbarians",n:"–≠–ª–∏—Ç–∫–∏",e:6,t:"mid"},{id:"royal-recruits",n:"–†–µ–∫—Ä—É—Ç—ã",e:7,t:"def"},
  {id:"little-prince",n:"–ú–∞–ª–µ–Ω—å–∫–∏–π –ø—Ä–∏–Ω—Ü",e:3,t:"sup"},{id:"monk",n:"–ú–æ–Ω–∞—Ö",e:5,t:"sup"},{id:"archer-queen",n:"–ö–æ—Ä–æ–ª–µ–≤–∞",e:5,t:"sup"},
  {id:"mighty-miner",n:"–ú–æ–≥—É—á–∏–π —à–∞—Ö—Ç–µ—Ä",e:4,t:"def"},{id:"golden-knight",n:"–ó–æ–ª–æ—Ç–æ–π —Ä—ã—Ü–∞—Ä—å",e:4,t:"def"},
  {id:"phoenix",n:"–§–µ–Ω–∏–∫—Å",e:4,t:"sup"},{id:"electro-spirit",n:"–≠–ª–µ–∫—Ç—Ä–æ–¥—É—Ö",e:1,t:"cycle"},{id:"ice-spirit",n:"–õ–µ–¥—è–Ω–æ–π –¥—É—Ö",e:1,t:"cycle"},
  {id:"fire-spirit",n:"–û–≥–Ω–µ–Ω–Ω—ã–π –¥—É—Ö",e:1,t:"cycle"},{id:"skeletons",n:"–°–∫–µ–ª–µ—Ç—ã",e:1,t:"cycle"},{id:"bats",n:"–õ–µ—Ç—É—á–∏–µ –º—ã—à–∏",e:2,t:"cycle"},
  {id:"minions",n:"–ú–∏–Ω—å–æ–Ω—ã",e:3,t:"swarm"},{id:"minion-horde",n:"–û—Ä–¥–∞",e:5,t:"swarm"},{id:"skeleton-army",n:"–ê—Ä–º–∏—è",e:3,t:"swarm"},
  {id:"guards",n:"–°—Ç—Ä–∞–∂–∏",e:3,t:"def"},{id:"tesla",n:"–¢–µ—Å–ª–∞",e:4,t:"def"},{id:"inferno-tower",n:"–ò–Ω—Ñ–µ—Ä–Ω–æ",e:5,t:"def"},
  {id:"cannon",n:"–ü—É—à–∫–∞",e:3,t:"def"},{id:"bomb-tower",n:"–ë–æ–º–±–µ–∂–∫–∞",e:4,t:"def"},{id:"elixir-collector",n:"–°–±–æ—Ä—â–∏–∫",e:6,t:"def"},
  {id:"freeze",n:"–ó–∞–º–æ—Ä–æ–∑–∫–∞",e:4,t:"spell"},{id:"graveyard",n:"–ö–ª–∞–¥–±–∏—â–µ",e:5,t:"win"},{id:"clone",n:"–ö–ª–æ–Ω",e:3,t:"spell"}
];

let deck = Array(8).fill(null);
let lastIdx = 0;

function handleSlotClick(i) {
  lastIdx = i;
  if(deck[i]) {
    document.getElementById('sheet').style.display = 'flex';
  } else {
    openPicker(i);
  }
}

function openPicker(i) {
  lastIdx = i;
  closeSheet();
  document.getElementById('modal').style.display = 'flex';
  renderCards();
}

function closeModal() { document.getElementById('modal').style.display = 'none'; }
function closeSheet() { document.getElementById('sheet').style.display = 'none'; }

function removeCard() {
  deck[lastIdx] = null;
  const s = document.getElementById(`s${lastIdx}`);
  s.classList.remove('filled');
  document.getElementById(`img${lastIdx}`).src = "";
  document.getElementById(`p${lastIdx}`).style.display = "block";
  closeSheet();
  tg.HapticFeedback.impactOccurred('light');
}

function renderCards() {
  const q = document.getElementById('search').value.toLowerCase();
  const list = document.getElementById('card-list');
  const used = deck.filter(c => c).map(c => c.id);

  list.innerHTML = ALL_CARDS.filter(c => c.n.toLowerCase().includes(q)).map(c => `
    <div class="card-item ${used.includes(c.id) ? 'selected' : ''}" onclick="selectCard('${c.id}')">
      <img src="https://royaleapi.github.io/cr-api-assets/cards/${c.id}.png">
    </div>
  `).join('');
}

function selectCard(id) {
  const card = ALL_CARDS.find(c => c.id === id);
  deck[lastIdx] = card;
  const s = document.getElementById(`s${lastIdx}`);
  document.getElementById(`img${lastIdx}`).src = `https://royaleapi.github.io/cr-api-assets/cards/${id}.png`;
  document.getElementById(`e${lastIdx}`).innerText = card.e;
  document.getElementById(`p${lastIdx}`).style.display = "none";
  s.classList.add('filled');
  closeModal();
  tg.HapticFeedback.notificationOccurred('success');
}

function analyze() {
  if(deck.includes(null)) return tg.showAlert("–°–Ω–∞—á–∞–ª–∞ —Å–æ–±–µ—Ä–∏ –ø–æ–ª–Ω—É—é –ø–∞—á–∫—É (8 –∫–∞—Ä—Ç)!");

  const avg = (deck.reduce((a,b)=>a+b.e,0)/8).toFixed(1);
  const spells = deck.filter(c => c.t==='spell').length;
  const wins = deck.filter(c => c.t==='win' || c.t==='cancer').length;
  const mid = deck.filter(c => c.t==='mid' || c.e >= 7).length;

  let e, t, d;
  if(mid >= 3 && avg > 4.2) {
    e="ü§°"; t="–õ–ï–ì–ï–ù–î–ê –ú–ò–î–õ–ê–î–î–ï–†–ê"; d=`–°—Ä. —ç–ª–∏–∫—Å–∏—Ä: ${avg}. –ù—É —á—Ç–æ —Å–∫–∞–∑–∞—Ç—å... –¢–≤–æ—è —Ç–∞–∫—Ç–∏–∫–∞ ‚Äî –∑–∞–≤–∞–ª–∏—Ç—å –≤—Ä–∞–≥–∞ –º—è—Å–æ–º. –ï—Å–ª–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫ —É–º–µ–µ—Ç –¥–µ—Ñ–∞—Ç—å –ú–µ–≥–∞—Ä—ã—Ü–∞—Ä—è, —Ç–µ–±–µ –∫–æ–Ω–µ—Ü. –ù–æ –¥–ª—è —Ñ–∞–Ω–∞ –ø–æ–π–¥–µ—Ç!`;
  } else if(spells >= 2 && wins >= 1 && avg >= 3.0 && avg <= 4.0) {
    e="üî•"; t="–ì–ò–ì–ê–ß–ê–î-–ë–ò–õ–î"; d=`–°–ª—É—à–∞–π, –∞ —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –≥—Ä–∞–º–æ—Ç–Ω–∞—è –∫–æ–ª–æ–¥–∞. –ë–∞–ª–∞–Ω—Å ${avg}, —Å–ø–µ–ª–ª—ã –Ω–∞ –º–µ—Å—Ç–µ. –¢—ã –ª–∏–±–æ –ø—Ä–æ—Ñ–∏, –ª–∏–±–æ —É–¥–∞—á–Ω–æ –ø–æ–¥—Å–º–æ—Ç—Ä–µ–ª —É —Ç–æ–ø–∞. –ò–¥–∏ –ª–æ–º–∞–π –±–∞—à–Ω–∏!`;
  } else if(wins === 0) {
    e="ü§®"; t="–¢–ï–†–ü–ò–õ–ê"; d="–ó–∞—â–∏—Ç–∞ ‚Äî —ç—Ç–æ –∫—Ä—É—Ç–æ, –Ω–æ –∫–∞–∫ —Ç—ã –ø–ª–∞–Ω–∏—Ä—É–µ—à—å –ø–æ–±–µ–∂–¥–∞—Ç—å? –ñ–¥–∞—Ç—å, –ø–æ–∫–∞ —É –≤—Ä–∞–≥–∞ —Å–¥–∞–¥—É—Ç –Ω–µ—Ä–≤—ã? –î–æ–±–∞–≤—å –•–æ–≥–∞ –∏–ª–∏ –ì–∏–≥–∞–Ω—Ç–∞, –Ω–µ –ø–æ–∑–æ—Ä—å—Å—è.";
  } else {
    e="üßê"; t="–ù–û–†–ú–ê–°"; d=`–î–µ–∫–∞ –Ω–∞ ${avg} —ç–ª–∏–∫—Å–∏—Ä–∞ –≤–ø–æ–ª–Ω–µ –∂–∏–≤–∞—è. –ï—Å—Ç—å —Å–ª–∞–±—ã–µ –º–µ—Å—Ç–∞, –Ω–æ –∏–≥—Ä–∞—Ç—å –º–æ–∂–Ω–æ. –ì–ª–∞–≤–Ω–æ–µ ‚Äî –Ω–µ –º–∏—Å–∫–ª–∏–∫–∞–π –ë—Ä–µ–≤–Ω–æ–º –≤ –ø—É—Å—Ç–æ—Ç—É.`;
  }

  document.getElementById('v-emoji').innerText = e;
  document.getElementById('v-title').innerText = t;
  document.getElementById('v-text').innerText = d;
  document.getElementById('res-grid').innerHTML = deck.map(c => `<img src="https://royaleapi.github.io/cr-api-assets/cards/${c.id}.png" style="width:100%">`).join('');
  document.getElementById('result').style.display = 'flex';
}
</script>
</body>
</html>
