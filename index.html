diff --git a/index.html b/index.html
index 988791cd3ae21a6d7ddf17b58c515421c5e8c7dc..cc06296b00ff3fdbcca0a2750323bc2542b3192b 100644
--- a/index.html
+++ b/index.html
@@ -1,182 +1,917 @@
 <!DOCTYPE html>
 <html lang="ru">
 <head>
-<meta charset="UTF-8">
-<meta name="viewport" content="width=device-width, initial-scale=1.0">
-<title>Anime Gacha Empire</title>
-
-<script src="https://telegram.org/js/telegram-web-app.js"></script>
-
-<style>
-body {
-  margin: 0;
-  font-family: Arial, sans-serif;
-  background: #0f172a;
-  color: white;
-  text-align: center;
-}
-
-button {
-  padding: 10px 20px;
-  margin: 10px;
-  border: none;
-  border-radius: 8px;
-  cursor: pointer;
-  font-weight: bold;
-  background: #2563eb;
-  color: white;
-}
-.card {
-  background: #1e293b;
-  padding: 15px;
-  margin: 10px;
-  border-radius: 10px;
-}
-</style>
-</head>
+  <meta charset="UTF-8" />
+  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
+  <title>Anime Gacha Empire</title>
+  <script src="https://telegram.org/js/telegram-web-app.js"></script>
+  <style>
+    :root {
+      --bg: #060a1f;
+      --panel: rgba(18, 25, 56, 0.75);
+      --panel-strong: rgba(28, 38, 84, 0.92);
+      --text: #ecf2ff;
+      --muted: #8ea3d8;
+      --primary: #6f7bff;
+      --accent: #00d0ff;
+      --success: #16c47f;
+      --warning: #f5b100;
+      --danger: #ff5d86;
+      --border: rgba(151, 177, 255, 0.22);
+      --shadow: 0 12px 40px rgba(0, 0, 0, 0.35);
+    }
+
+    * {
+      box-sizing: border-box;
+    }
+
+    body {
+      margin: 0;
+      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
+      color: var(--text);
+      min-height: 100vh;
+      background:
+        radial-gradient(circle at 10% -10%, #1f2b74 0%, transparent 35%),
+        radial-gradient(circle at 110% 0%, #5f1f7f 0%, transparent 28%),
+        radial-gradient(circle at 50% 110%, #063d63 0%, transparent 30%),
+        var(--bg);
+    }
+
+    .shell {
+      width: min(1080px, 100% - 20px);
+      margin: 16px auto 24px;
+      display: grid;
+      grid-template-columns: 320px 1fr;
+      gap: 14px;
+    }
+
+    .panel {
+      background: var(--panel);
+      border: 1px solid var(--border);
+      border-radius: 18px;
+      box-shadow: var(--shadow);
+      backdrop-filter: blur(8px);
+    }
+
+    .sidebar {
+      padding: 14px;
+      display: flex;
+      flex-direction: column;
+      gap: 12px;
+      height: fit-content;
+      position: sticky;
+      top: 12px;
+    }
+
+    .brand {
+      padding: 12px;
+      border-radius: 14px;
+      background: linear-gradient(130deg, rgba(111, 123, 255, 0.35), rgba(0, 208, 255, 0.2));
+      border: 1px solid rgba(174, 196, 255, 0.27);
+    }
+
+    .brand h1 {
+      margin: 0;
+      font-size: 22px;
+      letter-spacing: 0.4px;
+    }
+
+    .brand p {
+      margin: 6px 0 0;
+      color: var(--muted);
+      font-size: 13px;
+    }
+
+    .user-head {
+      display: flex;
+      gap: 10px;
+      align-items: center;
+      padding: 10px;
+      border-radius: 12px;
+      background: rgba(255, 255, 255, 0.03);
+      border: 1px solid rgba(255, 255, 255, 0.09);
+    }
+
+    .avatar {
+      width: 56px;
+      height: 56px;
+      border-radius: 14px;
+      object-fit: cover;
+      background: linear-gradient(145deg, #4c5bcb, #2a7fb1);
+      border: 1px solid rgba(255, 255, 255, 0.2);
+    }
+
+    .nav {
+      display: grid;
+      gap: 8px;
+    }
+
+    button,
+    .btn {
+      border: 0;
+      border-radius: 12px;
+      padding: 10px 12px;
+      color: white;
+      cursor: pointer;
+      font-weight: 700;
+      transition: transform 0.12s ease, filter 0.12s ease;
+      background: linear-gradient(130deg, #4e63ff, #3396ff);
+    }
+
+    button:hover,
+    .btn:hover {
+      transform: translateY(-1px);
+      filter: brightness(1.07);
+    }
+
+    button:disabled {
+      opacity: 0.55;
+      cursor: not-allowed;
+    }
+
+    .nav button {
+      text-align: left;
+      background: rgba(255, 255, 255, 0.05);
+      border: 1px solid rgba(255, 255, 255, 0.14);
+    }
+
+    .nav button.active {
+      background: linear-gradient(130deg, rgba(111, 123, 255, 0.58), rgba(0, 208, 255, 0.35));
+      border-color: rgba(205, 226, 255, 0.5);
+    }
+
+    .stats {
+      display: grid;
+      gap: 8px;
+    }
+
+    .stat-row {
+      display: flex;
+      justify-content: space-between;
+      padding: 8px 10px;
+      border-radius: 10px;
+      background: rgba(255, 255, 255, 0.04);
+      color: var(--muted);
+      font-size: 14px;
+    }
+
+    .stat-row b {
+      color: var(--text);
+    }
+
+    .content {
+      min-height: 86vh;
+      padding: 16px;
+    }
+
+    .page-title {
+      display: flex;
+      justify-content: space-between;
+      align-items: center;
+      gap: 8px;
+      flex-wrap: wrap;
+      margin-bottom: 12px;
+    }
+
+    .page-title h2 {
+      margin: 0;
+      font-size: 24px;
+    }
+
+    .page-title p {
+      margin: 4px 0 0;
+      color: var(--muted);
+    }
+
+    .grid {
+      display: grid;
+      grid-template-columns: repeat(auto-fit, minmax(210px, 1fr));
+      gap: 10px;
+    }
+
+    .card {
+      background: var(--panel-strong);
+      border: 1px solid rgba(180, 199, 255, 0.18);
+      border-radius: 15px;
+      padding: 12px;
+      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.03);
+    }
+
+    .rarity {
+      display: inline-block;
+      padding: 3px 8px;
+      border-radius: 999px;
+      font-size: 11px;
+      font-weight: 800;
+      margin-bottom: 8px;
+      text-transform: uppercase;
+      letter-spacing: 0.4px;
+    }
+
+    .rarity.common { background: rgba(185, 195, 223, 0.22); }
+    .rarity.rare { background: rgba(79, 125, 255, 0.25); }
+    .rarity.epic { background: rgba(176, 80, 255, 0.24); }
+    .rarity.legend { background: rgba(255, 164, 46, 0.24); }
+    .rarity.divine { background: rgba(255, 81, 143, 0.25); }
+
+    .summon-stage {
+      display: grid;
+      gap: 10px;
+      justify-items: center;
+      text-align: center;
+      padding: 18px;
+      border-radius: 18px;
+      background: linear-gradient(140deg, rgba(57, 77, 174, 0.42), rgba(95, 41, 113, 0.3));
+      border: 1px solid rgba(198, 217, 255, 0.26);
+      overflow: hidden;
+      position: relative;
+      min-height: 250px;
+    }
+
+    .orb {
+      width: 120px;
+      height: 120px;
+      border-radius: 50%;
+      background: radial-gradient(circle at 30% 30%, #fff, #81beff 18%, #5a54f5 50%, #25165e 80%);
+      box-shadow: 0 0 35px rgba(95, 137, 255, 0.75), 0 0 80px rgba(174, 66, 255, 0.45);
+      animation: pulse 2.2s infinite;
+    }
+
+    @keyframes pulse {
+      0%, 100% { transform: scale(1); }
+      50% { transform: scale(1.08); }
+    }
+
+    .rng-stream {
+      font-weight: 800;
+      letter-spacing: 0.5px;
+      min-height: 24px;
+      color: #cddaff;
+      text-shadow: 0 0 12px rgba(126, 170, 255, 0.8);
+    }
+
+    .log {
+      background: rgba(0, 0, 0, 0.26);
+      border-radius: 12px;
+      padding: 10px;
+      max-height: 160px;
+      overflow: auto;
+      border: 1px solid rgba(255, 255, 255, 0.14);
+      font-size: 13px;
+      color: #d7e4ff;
+    }
+
+    input,
+    textarea,
+    select {
+      width: 100%;
+      border: 1px solid rgba(255, 255, 255, 0.2);
+      background: rgba(255, 255, 255, 0.03);
+      color: white;
+      padding: 10px;
+      border-radius: 10px;
+      font: inherit;
+    }
+
+    textarea { min-height: 92px; resize: vertical; }
 
+    .row {
+      display: grid;
+      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
+      gap: 10px;
+    }
+
+    .muted {
+      color: var(--muted);
+      font-size: 13px;
+    }
+
+    .section {
+      margin-top: 10px;
+    }
+
+    .pill {
+      display: inline-flex;
+      align-items: center;
+      gap: 6px;
+      background: rgba(255, 255, 255, 0.09);
+      border: 1px solid rgba(255, 255, 255, 0.15);
+      border-radius: 999px;
+      padding: 4px 10px;
+      font-size: 12px;
+      color: #d8e2ff;
+    }
+
+    @media (max-width: 880px) {
+      .shell {
+        grid-template-columns: 1fr;
+      }
+
+      .sidebar {
+        position: static;
+      }
+    }
+  </style>
+</head>
 <body>
-<div id="app"></div>
-
-<script>
-
-const RARITIES = {
-  COMMON: { name: "–û–±—ã—á–Ω–∞—è", chance: 6000, mult: 1 },
-  RARE: { name: "–†–µ–¥–∫–∞—è", chance: 3000, mult: 2.5 },
-  EPIC: { name: "–≠–ø–∏—á–µ—Å–∫–∞—è", chance: 800, mult: 5 },
-  LEGEND: { name: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è", chance: 180, mult: 8 },
-  DIVINE: { name: "–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è", chance: 20, mult: 15 }
-};
-
-const UNIVERSES = {
-  "JUJUTSU KAISEN": ["–ì–æ–¥–∑—ë", "–ì—ç—Ç–æ", "–ò—Ç–∞–¥–æ—Ä–∏", "–ù–æ–±–∞—Ä–∞"],
-  "EVANGELION": ["–†—ç–π", "–ê—Å–∫–∞", "–°–∏–Ω–¥–∑–∏", "–ö–∞–≤–æ—Ä—É"]
-};
-
-let user = {
-  diamonds: 1500,
-  power: 0,
-  universe: "JUJUTSU KAISEN",
-  inventory: []
-};
-
-let currentView = "main";
-
-function render() {
-  const app = document.getElementById("app");
-
-  if (currentView === "main") {
-    app.innerHTML = `
-      <h1>Anime Gacha Empire</h1>
-      <p>üíé –ê–ª–º–∞–∑—ã: ${user.diamonds}</p>
-      <p>‚ö° –ú–æ—â—å: ${user.power}</p>
-      <button id="btnRoll">–ü—Ä–∏–∑—ã–≤</button>
-      <button id="btnInventory">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</button>
-    `;
-
-    document.getElementById("btnRoll").addEventListener("click", goRoll);
-    document.getElementById("btnInventory").addEventListener("click", goInventory);
-  }
-
-  if (currentView === "roll") {
-    app.innerHTML = `
-      <h2>–ü—Ä–∏–∑—ã–≤ —Å—Ç–æ–∏—Ç 100 –∞–ª–º–∞–∑–æ–≤</h2>
-      <button id="btnActivate">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
-      <button id="btnBack">–ù–∞–∑–∞–¥</button>
-    `;
-
-    document.getElementById("btnActivate").addEventListener("click", performRoll);
-    document.getElementById("btnBack").addEventListener("click", goMain);
-  }
-
-  if (currentView === "inventory") {
-    let cardsHTML = "";
-
-    if (user.inventory.length === 0) {
-      cardsHTML = "<p>–ü—É—Å—Ç–æ</p>";
-    } else {
-      user.inventory.forEach(card => {
-        cardsHTML += `
+  <div id="app"></div>
+
+  <script>
+    const RARITIES = {
+      COMMON: { key: "common", name: "–û–±—ã—á–Ω–∞—è", chance: 6000, mult: 1 },
+      RARE: { key: "rare", name: "–†–µ–¥–∫–∞—è", chance: 3000, mult: 2.2 },
+      EPIC: { key: "epic", name: "–≠–ø–∏—á–µ—Å–∫–∞—è", chance: 800, mult: 4.5 },
+      LEGEND: { key: "legend", name: "–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω–∞—è", chance: 180, mult: 7.5 },
+      DIVINE: { key: "divine", name: "–ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è", chance: 20, mult: 13 }
+    };
+
+    const UNIVERSES = {
+      "JUJUTSU KAISEN": ["–ì–æ–¥–∑—ë", "–ì—ç—Ç–æ", "–ò—Ç–∞–¥–æ—Ä–∏", "–ù–æ–±–∞—Ä–∞", "–ú–∞–∫–∏", "–¢–æ–¥–∑–∏"],
+      "EVANGELION": ["–†—ç–π", "–ê—Å–∫–∞", "–°–∏–Ω–¥–∑–∏", "–ö–∞–≤–æ—Ä—É", "–ú–∏—Å–∞—Ç–æ", "–ö–∞–æ—Ä—É"],
+      "NARUTO": ["–ù–∞—Ä—É—Ç–æ", "–°–∞—Å–∫–µ", "–°–∞–∫—É—Ä–∞", "–ò—Ç–∞—á–∏", "–ú–∏–Ω–∞—Ç–æ", "–ö–∞–∫–∞—à–∏"]
+    };
+
+    const botLeaders = [
+      { nickname: "Akira", title: "Storm", power: 8100, wins: 41, clan: "Moonlit" },
+      { nickname: "Yoru", title: "Blade", power: 7200, wins: 35, clan: "Nova" },
+      { nickname: "MikasaX", title: "Vanguard", power: 6500, wins: 28, clan: "Eclipse" },
+      { nickname: "Ren", title: "Shogun", power: 5800, wins: 22, clan: "Solo" }
+    ];
+
+    const appState = {
+      currentView: "main",
+      rolling: false,
+      rollTimer: null,
+      rngText: "–ù–∞–∂–º–∏ \"–≠–ø–∏—á–Ω—ã–π –ø—Ä–∏–∑—ã–≤\", —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å.",
+      profileForm: null,
+      log: [],
+      user: {
+        diamonds: 1500,
+        power: 0,
+        universe: "JUJUTSU KAISEN",
+        inventory: [],
+        pvpWins: 0,
+        pvpLosses: 0,
+        clan: null,
+        profile: {
+          nickname: "Player",
+          title: "–ù–æ–≤–∏—á–æ–∫",
+          avatar: "https://i.imgur.com/f4Q3QW5.png",
+          description: "–ü–æ–∫–æ—Ä—è—é RNG –∏ —Å–æ–±–∏—Ä–∞—é –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã—Ö –≥–µ—Ä–æ–µ–≤."
+        }
+      },
+      clans: [
+        { id: "moonlit", name: "Moonlit", members: 24, power: 48200, desc: "–ù–æ—á–Ω—ã–µ —Ä–µ–π–¥—ã –∏ —Ç—É—Ä–Ω–∏—Ä—ã." },
+        { id: "nova", name: "Nova", members: 17, power: 37450, desc: "–ù–æ–≤–∏—á–∫–∏ –∏ –ø—Ä–æ—Ñ–∏ –≤ –æ–¥–Ω–æ–º —Å–æ—Å—Ç–∞–≤–µ." },
+        { id: "eclipse", name: "Eclipse", members: 30, power: 61880, desc: "–¢–æ–ø-–∫–ª–∞–Ω —Ä–µ–π—Ç–∏–Ω–≥–∞ PvP." }
+      ],
+      pvpHistory: []
+    };
+
+    function rarityFromRng() {
+      const rng = Math.floor(Math.random() * 10000);
+      let cumulative = 0;
+      for (const key in RARITIES) {
+        cumulative += RARITIES[key].chance;
+        if (rng < cumulative) return key;
+      }
+      return "COMMON";
+    }
+
+    function createCard() {
+      const rarityKey = rarityFromRng();
+      const rarity = RARITIES[rarityKey];
+      const names = UNIVERSES[appState.user.universe];
+      const name = names[Math.floor(Math.random() * names.length)];
+
+      return {
+        id: Date.now() + Math.random(),
+        name,
+        rarityKey,
+        rarity: rarity.name,
+        power: Math.floor((Math.random() * 90 + 60) * rarity.mult),
+        hp: Math.floor((Math.random() * 140 + 120) * rarity.mult)
+      };
+    }
+
+    function userTitle() {
+      return `${appState.user.profile.title} ${appState.user.profile.nickname}`.trim();
+    }
+
+    function pushLog(message) {
+      appState.log.unshift(`${new Date().toLocaleTimeString()} ‚Ä¢ ${message}`);
+      appState.log = appState.log.slice(0, 20);
+    }
+
+    function navButton(view, label) {
+      const active = appState.currentView === view ? "active" : "";
+      return `<button data-nav="${view}" class="${active}">${label}</button>`;
+    }
+
+    function sidebarHtml() {
+      const user = appState.user;
+      return `
+        <aside class="panel sidebar">
+          <div class="brand">
+            <h1>Anime Gacha Empire</h1>
+            <p>–≠–ø–∏—á–Ω—ã–π WebApp c RNG –ø—Ä–∏–∑—ã–≤–æ–º, PvP, –∫–ª–∞–Ω–∞–º–∏ –∏ —Ä–µ–π—Ç–∏–Ω–≥–∞–º–∏.</p>
+          </div>
+
+          <div class="user-head">
+            <img class="avatar" src="${user.profile.avatar}" alt="avatar" onerror="this.src='https://i.imgur.com/f4Q3QW5.png'" />
+            <div>
+              <div style="font-size:13px;color:var(--muted)">${user.profile.title}</div>
+              <b>${user.profile.nickname}</b>
+            </div>
+          </div>
+
+          <div class="stats">
+            <div class="stat-row"><span>üíé –ê–ª–º–∞–∑—ã</span><b>${user.diamonds}</b></div>
+            <div class="stat-row"><span>‚ö° –ú–æ—â—å</span><b>${user.power}</b></div>
+            <div class="stat-row"><span>üèÜ PvP</span><b>${user.pvpWins}W / ${user.pvpLosses}L</b></div>
+          </div>
+
+          <nav class="nav">
+            ${navButton("main", "–ì–ª–∞–≤–Ω–∞—è")}
+            ${navButton("roll", "–ü—Ä–∏–∑—ã–≤")}
+            ${navButton("inventory", "–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å")}
+            ${navButton("profile", "–ü—Ä–æ—Ñ–∏–ª—å")}
+            ${navButton("clan", "–ö–ª–∞–Ω—ã")}
+            ${navButton("pvp", "PvP")}
+            ${navButton("fusion", "–°–ª–∏—è–Ω–∏–µ")}
+            ${navButton("ranking", "–†–µ–π—Ç–∏–Ω–≥–∏")}
+          </nav>
+        </aside>
+      `;
+    }
+
+    function mainView() {
+      const user = appState.user;
+      return `
+        <div class="page-title">
+          <div>
+            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${userTitle()}!</h2>
+            <p>${user.profile.description}</p>
+          </div>
+          <span class="pill">üåå –ú–∏—Ä: ${user.universe}</span>
+        </div>
+
+        <div class="grid">
+          <article class="card">
+            <h3>–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç</h3>
+            <p class="muted">–°–¥–µ–ª–∞–π 10 –ø—Ä–∏–∑—ã–≤–æ–≤, —Å–æ–±–µ—Ä–∏ –∫–æ–º–∞–Ω–¥—É –∏ –≤—ã–π–¥–∏ –≤ PvP –∞—Ä–µ–Ω—É.</p>
+            <button id="goRollNow">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–∏–∑—ã–≤—É</button>
+          </article>
+          <article class="card">
+            <h3>–ö–ª–∞–Ω</h3>
+            <p class="muted">${user.clan ? `–¢—ã –≤ –∫–ª–∞–Ω–µ: ${user.clan}` : "–¢—ã –ø–æ–∫–∞ –±–µ–∑ –∫–ª–∞–Ω–∞."}</p>
+            <button id="goClanNow">–û—Ç–∫—Ä—ã—Ç—å –∫–ª–∞–Ω—ã</button>
+          </article>
+          <article class="card">
+            <h3>–†–µ–π—Ç–∏–Ω–≥</h3>
+            <p class="muted">–¢–≤–æ—è –º–æ—â—å: <b>${user.power}</b>. –ü—Ä–æ–¥–≤–∏–≥–∞–π—Å—è –≤ —Ç–æ–ø!</p>
+            <button id="goRankNow">–°–º–æ—Ç—Ä–µ—Ç—å —Ç–∞–±–ª–∏—Ü—É</button>
+          </article>
+        </div>
+
+        <div class="section card">
+          <h3>–õ–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏–π</h3>
+          <div class="log">${appState.log.length ? appState.log.map(item => `<div>${item}</div>`).join("") : "–ü–æ–∫–∞ –ø—É—Å—Ç–æ."}</div>
+        </div>
+      `;
+    }
+
+    function rollView() {
+      return `
+        <div class="page-title">
+          <div>
+            <h2>–≠–ø–∏—á–Ω—ã–π –ø—Ä–∏–∑—ã–≤</h2>
+            <p>–°—Ç–æ–∏–º–æ—Å—Ç—å: 100 üíé. RNG-–∞–Ω–∏–º–∞—Ü–∏—è —Å–Ω–∞—á–∞–ª–∞ –¥—Ä–∞–∑–Ω–∏—Ç, –ø–æ—Ç–æ–º —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—É.</p>
+          </div>
+          <span class="pill">–®–∞–Ω—Å DIVINE: 0.2%</span>
+        </div>
+
+        <div class="summon-stage">
+          <div class="orb"></div>
+          <div class="rng-stream" id="rngStream">${appState.rngText}</div>
+          <div class="row" style="width:100%;max-width:560px;">
+            <select id="universeSelect">
+              ${Object.keys(UNIVERSES).map(name => `<option value="${name}" ${appState.user.universe === name ? "selected" : ""}>${name}</option>`).join("")}
+            </select>
+            <button id="summonBtn" ${appState.rolling ? "disabled" : ""}>‚ö° –≠–ø–∏—á–Ω—ã–π –ø—Ä–∏–∑—ã–≤</button>
+          </div>
+        </div>
+
+        <div class="section card">
+          <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–π –¥—Ä–æ–ø</h3>
+          <div id="lastDrop" class="muted">${appState.user.inventory.length ? `${appState.user.inventory[appState.user.inventory.length - 1].name} (${appState.user.inventory[appState.user.inventory.length - 1].rarity})` : "–ï—â–µ –Ω–µ –±—ã–ª–æ –ø—Ä–∏–∑—ã–≤–æ–≤."}</div>
+        </div>
+      `;
+    }
+
+    function inventoryView() {
+      const cards = appState.user.inventory;
+      return `
+        <div class="page-title">
+          <div>
+            <h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
+            <p>–í—Å–µ–≥–æ –∫–∞—Ä—Ç: ${cards.length}</p>
+          </div>
+        </div>
+
+        <div class="grid">
+          ${cards.length ? cards.map(card => `
+            <article class="card">
+              <span class="rarity ${RARITIES[card.rarityKey].key}">${card.rarity}</span>
+              <h3 style="margin:0 0 8px;">${card.name}</h3>
+              <div class="muted">‚ö° –°–∏–ª–∞: <b>${card.power}</b></div>
+              <div class="muted">‚ù§Ô∏è HP: <b>${card.hp}</b></div>
+            </article>
+          `).join("") : "<div class='card'>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç. –°–¥–µ–ª–∞–π –ø—Ä–∏–∑—ã–≤!</div>"}
+        </div>
+      `;
+    }
+
+    function profileView() {
+      const p = appState.profileForm || { ...appState.user.profile };
+      return `
+        <div class="page-title">
+          <div>
+            <h2>–ü—Ä–æ—Ñ–∏–ª—å</h2>
+            <p>–ù–∞—Å—Ç—Ä–æ–π —Ç–∏—Ç—É–ª, —Ñ–æ—Ç–æ –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞.</p>
+          </div>
+        </div>
+
+        <div class="row">
           <div class="card">
-            <strong>${card.name}</strong><br>
-            ${card.rarity}<br>
-            ‚ö° ${card.power} | ‚ù§Ô∏è ${card.hp}
+            <label>–ù–∏–∫–Ω–µ–π–º</label>
+            <input id="profileNick" value="${p.nickname}" maxlength="20" />
           </div>
-        `;
-      });
+          <div class="card">
+            <label>–¢–∏—Ç—É–ª</label>
+            <input id="profileTitle" value="${p.title}" maxlength="20" />
+          </div>
+        </div>
+
+        <div class="section card">
+          <label>URL —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è</label>
+          <input id="profileAvatar" value="${p.avatar}" />
+        </div>
+
+        <div class="section card">
+          <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
+          <textarea id="profileDesc">${p.description}</textarea>
+        </div>
+
+        <div class="section row">
+          <button id="saveProfile">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
+          <button id="resetProfile" style="background:linear-gradient(130deg,#5e6480,#8890ad)">–°–±—Ä–æ—Å–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
+        </div>
+      `;
     }
 
-    app.innerHTML = `
-      <h2>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h2>
-      ${cardsHTML}
-      <button id="btnBack">–ù–∞–∑–∞–¥</button>
-    `;
+    function clanView() {
+      return `
+        <div class="page-title">
+          <div>
+            <h2>–ö–ª–∞–Ω—ã</h2>
+            <p>${appState.user.clan ? `–¢—ã —Å–æ—Å—Ç–æ–∏—à—å –≤ –∫–ª–∞–Ω–µ ${appState.user.clan}.` : "–í—Å—Ç—É–ø–∏ –≤ –∫–ª–∞–Ω –¥–ª—è –±–æ–Ω—É—Å–æ–≤ –∏ –∫–æ–æ–ø–µ—Ä–∞—Ç–∏–≤–∞."}</p>
+          </div>
+        </div>
 
-    document.getElementById("btnBack").addEventListener("click", goMain);
-  }
-}
+        <div class="section card">
+          <div class="row">
+            <input id="newClanName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –∫–ª–∞–Ω–∞" maxlength="18" />
+            <button id="createClan">–°–æ–∑–¥–∞—Ç—å –∫–ª–∞–Ω</button>
+          </div>
+        </div>
+
+        <div class="grid section">
+          ${appState.clans.map(clan => `
+            <article class="card">
+              <h3 style="margin-top:0">${clan.name}</h3>
+              <div class="muted">üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏: ${clan.members}</div>
+              <div class="muted">‚ö° –°–∏–ª–∞ –∫–ª–∞–Ω–∞: ${clan.power}</div>
+              <p class="muted">${clan.desc}</p>
+              <button data-join-clan="${clan.id}">${appState.user.clan === clan.name ? "–¢—ã –≤ –∫–ª–∞–Ω–µ" : "–í—Å—Ç—É–ø–∏—Ç—å"}</button>
+            </article>
+          `).join("")}
+        </div>
+      `;
+    }
 
-function performRoll() {
-  if (user.diamonds < 100) {
-    alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–ª–º–∞–∑–æ–≤");
-    return;
-  }
+    function pvpView() {
+      const history = appState.pvpHistory;
+      return `
+        <div class="page-title">
+          <div>
+            <h2>PvP –ê—Ä–µ–Ω–∞</h2>
+            <p>–†–µ–∂–∏–º –¥—É—ç–ª–∏ –ø—Ä–æ—Ç–∏–≤ —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –∏–∑ —Ä–µ–π—Ç–∏–Ω–≥–∞.</p>
+          </div>
+          <button id="fightBtn">‚öîÔ∏è –ù–∞–π—Ç–∏ –±–æ–π</button>
+        </div>
+
+        <div class="card">
+          <h3>–ò—Å—Ç–æ—Ä–∏—è –±–æ–µ–≤</h3>
+          <div class="log">${history.length ? history.map(item => `<div>${item}</div>`).join("") : "–ï—â–µ –Ω–µ—Ç –±–æ–µ–≤."}</div>
+        </div>
+      `;
+    }
 
-  user.diamonds -= 100;
+    function fusionView() {
+      const options = appState.user.inventory.map(card => `<option value="${card.id}">${card.name} ‚Ä¢ ${card.rarity} ‚Ä¢ ${card.power}‚ö°</option>`).join("");
+      return `
+        <div class="page-title">
+          <div>
+            <h2>–°–ª–∏—è–Ω–∏–µ –∫–∞—Ä—Ç</h2>
+            <p>–û–±—ä–µ–¥–∏–Ω–∏ 2 –∫–∞—Ä—Ç—ã –∏ –ø–æ–ª—É—á–∏ —É—Å–∏–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é.</p>
+          </div>
+        </div>
+
+        <div class="card">
+          ${appState.user.inventory.length < 2 ? "–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 2 –∫–∞—Ä—Ç—ã –¥–ª—è —Å–ª–∏—è–Ω–∏—è." : `
+            <div class="row">
+              <select id="fusionA">${options}</select>
+              <select id="fusionB">${options}</select>
+            </div>
+            <div class="section">
+              <button id="fusionBtn">üîß –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–ª–∏—è–Ω–∏–µ</button>
+            </div>
+          `}
+        </div>
+      `;
+    }
 
-  const rng = Math.floor(Math.random() * 10000);
-  let cumulative = 0;
-  let rarityKey = "COMMON";
+    function rankingView() {
+      const userRecord = {
+        nickname: appState.user.profile.nickname,
+        title: appState.user.profile.title,
+        power: appState.user.power,
+        wins: appState.user.pvpWins,
+        clan: appState.user.clan || "Solo"
+      };
+
+      const rows = [...botLeaders, userRecord]
+        .sort((a, b) => (b.power + b.wins * 30) - (a.power + a.wins * 30))
+        .map((entry, i) => `
+          <tr>
+            <td>#${i + 1}</td>
+            <td>${entry.title} ${entry.nickname}</td>
+            <td>${entry.clan}</td>
+            <td>${entry.power}</td>
+            <td>${entry.wins}</td>
+          </tr>
+        `)
+        .join("");
+
+      return `
+        <div class="page-title">
+          <div>
+            <h2>–†–µ–π—Ç–∏–Ω–≥–∏</h2>
+            <p>–ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ –º–æ—â–Ω–æ—Å—Ç–∏ –∏ –ø–æ–±–µ–¥–∞–º.</p>
+          </div>
+        </div>
+
+        <div class="card" style="overflow:auto;">
+          <table style="width:100%;border-collapse:collapse;min-width:520px;">
+            <thead>
+              <tr style="text-align:left;color:#b7c7f7;">
+                <th>–ü–æ–∑–∏—Ü–∏—è</th><th>–ò–≥—Ä–æ–∫</th><th>–ö–ª–∞–Ω</th><th>–ú–æ—â—å</th><th>–ü–æ–±–µ–¥—ã</th>
+              </tr>
+            </thead>
+            <tbody>
+              ${rows}
+            </tbody>
+          </table>
+        </div>
+      `;
+    }
 
-  for (let key in RARITIES) {
-    cumulative += RARITIES[key].chance;
-    if (rng <= cumulative) {
-      rarityKey = key;
-      break;
+    function renderView() {
+      switch (appState.currentView) {
+        case "main": return mainView();
+        case "roll": return rollView();
+        case "inventory": return inventoryView();
+        case "profile": return profileView();
+        case "clan": return clanView();
+        case "pvp": return pvpView();
+        case "fusion": return fusionView();
+        case "ranking": return rankingView();
+        default: return mainView();
+      }
     }
-  }
 
-  const names = UNIVERSES[user.universe];
-  const name = names[Math.floor(Math.random() * names.length)];
-  const rarity = RARITIES[rarityKey];
+    function render() {
+      const app = document.getElementById("app");
+      app.innerHTML = `
+        <div class="shell">
+          ${sidebarHtml()}
+          <main class="panel content">${renderView()}</main>
+        </div>
+      `;
+      bindEvents();
+    }
 
-  const newCard = {
-    id: Date.now(),
-    name: name,
-    rarity: rarity.name,
-    power: Math.floor((Math.random() * 100 + 50) * rarity.mult),
-    hp: Math.floor((Math.random() * 200 + 100) * rarity.mult)
-  };
+    function setView(view) {
+      appState.currentView = view;
+      render();
+    }
 
-  user.inventory.push(newCard);
-  user.power += newCard.power;
+    function bindEvents() {
+      document.querySelectorAll("[data-nav]").forEach(btn => {
+        btn.addEventListener("click", () => setView(btn.dataset.nav));
+      });
 
-  alert("–í—ã–ø–∞–ª–∞ –∫–∞—Ä—Ç–∞: " + name + " (" + rarity.name + ")");
-  render();
-}
+      const goRollNow = document.getElementById("goRollNow");
+      if (goRollNow) goRollNow.addEventListener("click", () => setView("roll"));
+
+      const goClanNow = document.getElementById("goClanNow");
+      if (goClanNow) goClanNow.addEventListener("click", () => setView("clan"));
+
+      const goRankNow = document.getElementById("goRankNow");
+      if (goRankNow) goRankNow.addEventListener("click", () => setView("ranking"));
+
+      const universeSelect = document.getElementById("universeSelect");
+      if (universeSelect) {
+        universeSelect.addEventListener("change", (e) => {
+          appState.user.universe = e.target.value;
+        });
+      }
+
+      const summonBtn = document.getElementById("summonBtn");
+      if (summonBtn) summonBtn.addEventListener("click", performRollAnimation);
+
+      const saveProfile = document.getElementById("saveProfile");
+      if (saveProfile) {
+        saveProfile.addEventListener("click", () => {
+          const nickname = document.getElementById("profileNick").value.trim();
+          const title = document.getElementById("profileTitle").value.trim();
+          const avatar = document.getElementById("profileAvatar").value.trim();
+          const desc = document.getElementById("profileDesc").value.trim();
+
+          appState.user.profile.nickname = nickname || "Player";
+          appState.user.profile.title = title || "–ù–æ–≤–∏—á–æ–∫";
+          appState.user.profile.avatar = avatar || "https://i.imgur.com/f4Q3QW5.png";
+          appState.user.profile.description = desc || "–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è";
+          appState.profileForm = null;
+          pushLog("–ü—Ä–æ—Ñ–∏–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω.");
+          render();
+        });
+      }
+
+      ["profileNick", "profileTitle", "profileAvatar", "profileDesc"].forEach(id => {
+        const input = document.getElementById(id);
+        if (input) {
+          input.addEventListener("input", () => {
+            appState.profileForm = {
+              nickname: document.getElementById("profileNick").value,
+              title: document.getElementById("profileTitle").value,
+              avatar: document.getElementById("profileAvatar").value,
+              description: document.getElementById("profileDesc").value
+            };
+          });
+        }
+      });
 
-function goMain() {
-  currentView = "main";
-  render();
-}
+      const resetProfile = document.getElementById("resetProfile");
+      if (resetProfile) {
+        resetProfile.addEventListener("click", () => {
+          appState.profileForm = { ...appState.user.profile };
+          render();
+        });
+      }
+
+      const createClan = document.getElementById("createClan");
+      if (createClan) {
+        createClan.addEventListener("click", () => {
+          const nameInput = document.getElementById("newClanName");
+          const name = nameInput.value.trim();
+          if (!name) return alert("–£–∫–∞–∂–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∞–Ω–∞");
+          const id = name.toLowerCase().replace(/\s+/g, "-");
+          appState.clans.unshift({ id, name, members: 1, power: appState.user.power, desc: "–ù–æ–≤—ã–π –∫–ª–∞–Ω –∏–≥—Ä–æ–∫–∞." });
+          appState.user.clan = name;
+          pushLog(`–°–æ–∑–¥–∞–Ω –∫–ª–∞–Ω ${name}.`);
+          render();
+        });
+      }
+
+      document.querySelectorAll("[data-join-clan]").forEach(btn => {
+        btn.addEventListener("click", () => {
+          const clan = appState.clans.find(c => c.id === btn.dataset.joinClan);
+          if (!clan) return;
+          appState.user.clan = clan.name;
+          clan.members += 1;
+          pushLog(`–í—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ –∫–ª–∞–Ω ${clan.name}.`);
+          render();
+        });
+      });
 
-function goRoll() {
-  currentView = "roll";
-  render();
-}
+      const fightBtn = document.getElementById("fightBtn");
+      if (fightBtn) {
+        fightBtn.addEventListener("click", () => {
+          if (appState.user.power < 100) {
+            alert("–°–Ω–∞—á–∞–ª–∞ —É—Å–∏–ª–∏—Å—å –ø—Ä–∏–∑—ã–≤–∞–º–∏. –ù—É–∂–Ω–æ —Ö–æ—Ç—è –±—ã 100 –º–æ—â–∏.");
+            return;
+          }
+          const rival = botLeaders[Math.floor(Math.random() * botLeaders.length)];
+          const userScore = appState.user.power + Math.floor(Math.random() * 260);
+          const rivalScore = rival.power + Math.floor(Math.random() * 260);
+          const won = userScore >= rivalScore;
+
+          if (won) {
+            appState.user.pvpWins += 1;
+            appState.user.diamonds += 70;
+          } else {
+            appState.user.pvpLosses += 1;
+            appState.user.diamonds += 25;
+          }
+
+          const text = `${won ? "‚úÖ –ü–æ–±–µ–¥–∞" : "‚ùå –ü–æ—Ä–∞–∂–µ–Ω–∏–µ"} –ø—Ä–æ—Ç–∏–≤ ${rival.nickname} (${userScore} vs ${rivalScore})`;
+          appState.pvpHistory.unshift(text);
+          appState.pvpHistory = appState.pvpHistory.slice(0, 18);
+          pushLog(text);
+          render();
+        });
+      }
+
+      const fusionBtn = document.getElementById("fusionBtn");
+      if (fusionBtn) {
+        fusionBtn.addEventListener("click", () => {
+          const first = Number(document.getElementById("fusionA").value);
+          const second = Number(document.getElementById("fusionB").value);
+          if (first === second) return alert("–í—ã–±–µ—Ä–∏ –¥–≤–µ —Ä–∞–∑–Ω—ã–µ –∫–∞—Ä—Ç—ã.");
+
+          const firstCard = appState.user.inventory.find(c => c.id === first);
+          const secondCard = appState.user.inventory.find(c => c.id === second);
+          if (!firstCard || !secondCard) return alert("–ö–∞—Ä—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.");
+
+          appState.user.inventory = appState.user.inventory.filter(c => c.id !== first && c.id !== second);
+
+          const rarityOrder = ["COMMON", "RARE", "EPIC", "LEGEND", "DIVINE"];
+          const bestIndex = Math.max(rarityOrder.indexOf(firstCard.rarityKey), rarityOrder.indexOf(secondCard.rarityKey));
+          const upgraded = Math.min(bestIndex + (Math.random() < 0.4 ? 1 : 0), rarityOrder.length - 1);
+          const newRarityKey = rarityOrder[upgraded];
+
+          const fused = {
+            id: Date.now() + Math.random(),
+            name: `${firstCard.name}-${secondCard.name}`,
+            rarityKey: newRarityKey,
+            rarity: RARITIES[newRarityKey].name,
+            power: Math.floor((firstCard.power + secondCard.power) * 0.68),
+            hp: Math.floor((firstCard.hp + secondCard.hp) * 0.68)
+          };
+
+          appState.user.inventory.push(fused);
+          recalculatePower();
+          pushLog(`–°–ª–∏—è–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ: ${fused.name} (${fused.rarity}).`);
+          render();
+        });
+      }
+    }
 
-function goInventory() {
-  currentView = "inventory";
-  render();
-}
+    function recalculatePower() {
+      appState.user.power = appState.user.inventory.reduce((acc, item) => acc + item.power, 0);
+    }
 
-if (window.Telegram && window.Telegram.WebApp) {
-  Telegram.WebApp.ready();
-  Telegram.WebApp.expand();
-}
+    function performRollAnimation() {
+      if (appState.rolling) return;
+      if (appState.user.diamonds < 100) {
+        alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∞–ª–º–∞–∑–æ–≤.");
+        return;
+      }
+
+      appState.rolling = true;
+      appState.user.diamonds -= 100;
+
+      const stream = document.getElementById("rngStream");
+      const rarityKeys = Object.keys(RARITIES);
+      let tick = 0;
+
+      appState.rollTimer = setInterval(() => {
+        const randomRarity = RARITIES[rarityKeys[Math.floor(Math.random() * rarityKeys.length)]].name;
+        stream.textContent = `RNG –∫—Ä—É—Ç–∏—Ç—Å—è... ${randomRarity}`;
+        tick += 1;
+
+        if (tick > 14) {
+          clearInterval(appState.rollTimer);
+          const card = createCard();
+          appState.user.inventory.push(card);
+          recalculatePower();
+          appState.rngText = `‚ú® ${card.name} ‚Ä¢ ${card.rarity} | ‚ö° ${card.power} | ‚ù§Ô∏è ${card.hp}`;
+          appState.rolling = false;
+          pushLog(`–ü–æ–ª—É—á–µ–Ω–∞ –∫–∞—Ä—Ç–∞ ${card.name} (${card.rarity}).`);
+          render();
+        }
+      }, 120);
+    }
 
-render();
+    if (window.Telegram && window.Telegram.WebApp) {
+      Telegram.WebApp.ready();
+      Telegram.WebApp.expand();
+    }
 
-</script>
+    pushLog("–°–∏—Å—Ç–µ–º–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞.");
+    render();
+  </script>
 </body>
 </html>
